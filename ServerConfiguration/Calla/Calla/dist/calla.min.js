var Calla=function(t){"use strict";function e(t,e,n){return typeof t===e||t instanceof n}function n(t){return e(t,"function",Function)}function i(t){return e(t,"string",String)}function s(t){return e(t,"boolean",Boolean)}function r(t){return e(t,"number",Number)}function o(t){return e(t,"object",Object)}function a(t){return t instanceof HTMLElement}function A(t){throw new Error("Unexpected object: "+t)}function c(t){return r(t)&&!Number.isNaN(t)}function h(t){return null==t}const u=n(HTMLAudioElement.prototype.setSinkId);var l,d,f=(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=function(t){function e(e,n){var i=this,s=this.constructor.prototype;return(i=t.call(this,e)||this).statusCode=n,i.__proto__=s,i}return f(e,t),e}(Error),g=function(t){function e(e){void 0===e&&(e="A timeout occurred.");var n=this,i=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=i,n}return f(e,t),e}(Error),v=function(t){function e(e){void 0===e&&(e="An abort occurred.");var n=this,i=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=i,n}return f(e,t),e}(Error),w=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},m=function(t,e,n){this.statusCode=t,this.statusText=e,this.content=n},D=function(){function t(){}return t.prototype.get=function(t,e){return this.send(w({},e,{method:"GET",url:t}))},t.prototype.post=function(t,e){return this.send(w({},e,{method:"POST",url:t}))},t.prototype.delete=function(t,e){return this.send(w({},e,{method:"DELETE",url:t}))},t.prototype.getCookieString=function(t){return""},t}();!function(t){t[t.Trace=0]="Trace",t[t.Debug=1]="Debug",t[t.Information=2]="Information",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",t[t.None=6]="None"}(d||(d={}));var y=function(){function t(){}return t.prototype.log=function(t,e){},t.instance=new t,t}(),b=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},P=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{A(i.next(t))}catch(t){r(t)}}function a(t){try{A(i.throw(t))}catch(t){r(t)}}function A(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(o,a)}A((i=i.apply(t,e||[])).next())}))},C=function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},E=function(){function t(){}return t.isRequired=function(t,e){if(null==t)throw new Error("The '"+e+"' argument is required.")},t.isNotEmpty=function(t,e){if(!t||t.match(/^\s*$/))throw new Error("The '"+e+"' argument should not be empty.")},t.isIn=function(t,e,n){if(!(t in e))throw new Error("Unknown "+n+" value: "+t+".")},t}(),I=function(){function t(){}return Object.defineProperty(t,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),t}();function B(t,e){var n="";return _(t)?(n="Binary data of length "+t.byteLength,e&&(n+=". Content: '"+function(t){var e=new Uint8Array(t),n="";return e.forEach((function(t){n+="0x"+(t<16?"0":"")+t.toString(16)+" "})),n.substr(0,n.length-1)}(t)+"'")):"string"==typeof t&&(n="String data of length "+t.length,e&&(n+=". Content: '"+t+"'")),n}function _(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function M(t,e,n,i,s,r,o,a,A){return P(this,void 0,void 0,(function(){var c,h,u,l,f,p,g,v;return C(this,(function(w){switch(w.label){case 0:return h={},s?[4,s()]:[3,2];case 1:(u=w.sent())&&((c={}).Authorization="Bearer "+u,h=c),w.label=2;case 2:return l=O(),f=l[0],p=l[1],h[f]=p,t.log(d.Trace,"("+e+" transport) sending data. "+B(r,o)+"."),g=_(r)?"arraybuffer":"text",[4,n.post(i,{content:r,headers:b({},h,A),responseType:g,withCredentials:a})];case 3:return v=w.sent(),t.log(d.Trace,"("+e+" transport) request complete. Response status: "+v.statusCode+"."),[2]}}))}))}var x=function(){function t(t,e){this.subject=t,this.observer=e}return t.prototype.dispose=function(){var t=this.subject.observers.indexOf(this.observer);t>-1&&this.subject.observers.splice(t,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch((function(t){}))},t}(),S=function(){function t(t){this.minimumLogLevel=t,this.outputConsole=console}return t.prototype.log=function(t,e){if(t>=this.minimumLogLevel)switch(t){case d.Critical:case d.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+d[t]+": "+e);break;case d.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+d[t]+": "+e);break;case d.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+d[t]+": "+e);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+d[t]+": "+e)}},t}();function O(){var t="X-SignalR-User-Agent";return I.isNode&&(t="User-Agent"),[t,Q("5.0.1",k(),L(),T())]}function Q(t,e,n,i){var s="Microsoft SignalR/",r=t.split(".");return s+=r[0]+"."+r[1],s+=" ("+t+"; ",s+=e&&""!==e?e+"; ":"Unknown OS; ",s+=""+n,s+=i?"; "+i:"; Unknown Runtime Version",s+=")"}function k(){if(!I.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function T(){if(I.isNode)return process.versions.node}function L(){return I.isNode?"NodeJS":"Browser"}var R=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),U=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},j=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{A(i.next(t))}catch(t){r(t)}}function a(t){try{A(i.throw(t))}catch(t){r(t)}}function A(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(o,a)}A((i=i.apply(t,e||[])).next())}))},F=function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},N=function(t){function e(e){var n=t.call(this)||this;if(n.logger=e,"undefined"==typeof fetch){var i="function"==typeof __webpack_require__?__non_webpack_require__:require;n.jar=new(i("tough-cookie").CookieJar),n.fetchType=i("node-fetch"),n.fetchType=i("fetch-cookie")(n.fetchType,n.jar),n.abortControllerType=i("abort-controller")}else n.fetchType=fetch.bind(self),n.abortControllerType=AbortController;return n}return R(e,t),e.prototype.send=function(t){return j(this,void 0,void 0,(function(){var e,n,i,s,r,o,a,A=this;return F(this,(function(c){switch(c.label){case 0:if(t.abortSignal&&t.abortSignal.aborted)throw new v;if(!t.method)throw new Error("No method defined.");if(!t.url)throw new Error("No url defined.");e=new this.abortControllerType,t.abortSignal&&(t.abortSignal.onabort=function(){e.abort(),n=new v}),i=null,t.timeout&&(s=t.timeout,i=setTimeout((function(){e.abort(),A.logger.log(d.Warning,"Timeout from HTTP request."),n=new g}),s)),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,this.fetchType(t.url,{body:t.content,cache:"no-cache",credentials:!0===t.withCredentials?"include":"same-origin",headers:U({"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest"},t.headers),method:t.method,mode:"cors",redirect:"manual",signal:e.signal})];case 2:return r=c.sent(),[3,5];case 3:if(o=c.sent(),n)throw n;throw this.logger.log(d.Warning,"Error from HTTP request. "+o+"."),o;case 4:return i&&clearTimeout(i),t.abortSignal&&(t.abortSignal.onabort=null),[7];case 5:if(!r.ok)throw new p(r.statusText,r.status);return[4,function(t,e){var n;switch(e){case"arraybuffer":n=t.arrayBuffer();break;case"text":n=t.text();break;case"blob":case"document":case"json":throw new Error(e+" is not supported.");default:n=t.text()}return n}(r,t.responseType)];case 6:return a=c.sent(),[2,new m(r.status,r.statusText,a)]}}))}))},e.prototype.getCookieString=function(t){var e="";return I.isNode&&this.jar&&this.jar.getCookies(t,(function(t,n){return e=n.join("; ")})),e},e}(D);var H,z=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),G=function(t){function e(e){var n=t.call(this)||this;return n.logger=e,n}return z(e,t),e.prototype.send=function(t){var e=this;return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new v):t.method?t.url?new Promise((function(n,i){var s=new XMLHttpRequest;s.open(t.method,t.url,!0),s.withCredentials=void 0===t.withCredentials||t.withCredentials,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var r=t.headers;r&&Object.keys(r).forEach((function(t){s.setRequestHeader(t,r[t])})),t.responseType&&(s.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=function(){s.abort(),i(new v)}),t.timeout&&(s.timeout=t.timeout),s.onload=function(){t.abortSignal&&(t.abortSignal.onabort=null),s.status>=200&&s.status<300?n(new m(s.status,s.statusText,s.response||s.responseText)):i(new p(s.statusText,s.status))},s.onerror=function(){e.logger.log(d.Warning,"Error from HTTP request. "+s.status+": "+s.statusText+"."),i(new p(s.statusText,s.status))},s.ontimeout=function(){e.logger.log(d.Warning,"Timeout from HTTP request."),i(new g)},s.send(t.content||"")})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e}(D),X=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Y=function(t){function e(e){var n=t.call(this)||this;if("undefined"!=typeof fetch||I.isNode)n.httpClient=new N(e);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");n.httpClient=new G(e)}return n}return X(e,t),e.prototype.send=function(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new v):t.method?t.url?this.httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},e.prototype.getCookieString=function(t){return this.httpClient.getCookieString(t)},e}(D),W=function(){function t(){}return t.write=function(e){return""+e+t.RecordSeparator},t.parse=function(e){if(e[e.length-1]!==t.RecordSeparator)throw new Error("Message is incomplete.");var n=e.split(t.RecordSeparator);return n.pop(),n},t.RecordSeparatorCode=30,t.RecordSeparator=String.fromCharCode(t.RecordSeparatorCode),t}(),Z=function(){function t(){}return t.prototype.writeHandshakeRequest=function(t){return W.write(JSON.stringify(t))},t.prototype.parseHandshakeResponse=function(t){var e,n;if(_(t)||"undefined"!=typeof Buffer&&t instanceof Buffer){var i=new Uint8Array(t);if(-1===(r=i.indexOf(W.RecordSeparatorCode)))throw new Error("Message is incomplete.");var s=r+1;e=String.fromCharCode.apply(null,i.slice(0,s)),n=i.byteLength>s?i.slice(s).buffer:null}else{var r,o=t;if(-1===(r=o.indexOf(W.RecordSeparator)))throw new Error("Message is incomplete.");s=r+1;e=o.substring(0,s),n=o.length>s?o.substring(s):null}var a=W.parse(e),A=JSON.parse(a[0]);if(A.type)throw new Error("Expected a handshake response from the server.");return[n,A]},t}();!function(t){t[t.Invocation=1]="Invocation",t[t.StreamItem=2]="StreamItem",t[t.Completion=3]="Completion",t[t.StreamInvocation=4]="StreamInvocation",t[t.CancelInvocation=5]="CancelInvocation",t[t.Ping=6]="Ping",t[t.Close=7]="Close"}(H||(H={}));var J,V=function(){function t(){this.observers=[]}return t.prototype.next=function(t){for(var e=0,n=this.observers;e<n.length;e++){n[e].next(t)}},t.prototype.error=function(t){for(var e=0,n=this.observers;e<n.length;e++){var i=n[e];i.error&&i.error(t)}},t.prototype.complete=function(){for(var t=0,e=this.observers;t<e.length;t++){var n=e[t];n.complete&&n.complete()}},t.prototype.subscribe=function(t){return this.observers.push(t),new x(this,t)},t}(),q=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{A(i.next(t))}catch(t){r(t)}}function a(t){try{A(i.throw(t))}catch(t){r(t)}}function A(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(o,a)}A((i=i.apply(t,e||[])).next())}))},K=function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};!function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting"}(J||(J={}));var $,tt,et=function(){function t(t,e,n,i){var s=this;E.isRequired(t,"connection"),E.isRequired(e,"logger"),E.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=e,this.protocol=n,this.connection=t,this.reconnectPolicy=i,this.handshakeProtocol=new Z,this.connection.onreceive=function(t){return s.processIncomingData(t)},this.connection.onclose=function(t){return s.connectionClosed(t)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=J.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:H.Ping})}return t.create=function(e,n,i,s){return new t(e,n,i,s)},Object.defineProperty(t.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(t){if(this.connectionState!==J.Disconnected&&this.connectionState!==J.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t},enumerable:!0,configurable:!0}),t.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},t.prototype.startWithStateTransitions=function(){return q(this,void 0,void 0,(function(){var t;return K(this,(function(e){switch(e.label){case 0:if(this.connectionState!==J.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=J.Connecting,this.logger.log(d.Debug,"Starting HubConnection."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return e.sent(),this.connectionState=J.Connected,this.connectionStarted=!0,this.logger.log(d.Debug,"HubConnection connected successfully."),[3,4];case 3:return t=e.sent(),this.connectionState=J.Disconnected,this.logger.log(d.Debug,"HubConnection failed to start successfully because of error '"+t+"'."),[2,Promise.reject(t)];case 4:return[2]}}))}))},t.prototype.startInternal=function(){return q(this,void 0,void 0,(function(){var t,e,n,i=this;return K(this,(function(s){switch(s.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,t=new Promise((function(t,e){i.handshakeResolver=t,i.handshakeRejecter=e})),[4,this.connection.start(this.protocol.transferFormat)];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,5,,7]),e={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(d.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(e))];case 3:return s.sent(),this.logger.log(d.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 4:if(s.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return n=s.sent(),this.logger.log(d.Debug,"Hub handshake failed with error '"+n+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(n)];case 6:throw s.sent(),n;case 7:return[2]}}))}))},t.prototype.stop=function(){return q(this,void 0,void 0,(function(){var t;return K(this,(function(e){switch(e.label){case 0:return t=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,t];case 3:case 4:return e.sent(),[3,5];case 5:return[2]}}))}))},t.prototype.stopInternal=function(t){return this.connectionState===J.Disconnected?(this.logger.log(d.Debug,"Call to HubConnection.stop("+t+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===J.Disconnecting?(this.logger.log(d.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=J.Disconnecting,this.logger.log(d.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(d.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=t||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))},t.prototype.stream=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s,r=this.replaceStreamingParams(n),o=r[0],a=r[1],A=this.createStreamInvocation(t,n,a),c=new V;return c.cancelCallback=function(){var t=e.createCancelInvocation(A.invocationId);return delete e.callbacks[A.invocationId],s.then((function(){return e.sendWithProtocol(t)}))},this.callbacks[A.invocationId]=function(t,e){e?c.error(e):t&&(t.type===H.Completion?t.error?c.error(new Error(t.error)):c.complete():c.next(t.item))},s=this.sendWithProtocol(A).catch((function(t){c.error(t),delete e.callbacks[A.invocationId]})),this.launchStreams(o,s),c},t.prototype.sendMessage=function(t){return this.resetKeepAliveInterval(),this.connection.send(t)},t.prototype.sendWithProtocol=function(t){return this.sendMessage(this.protocol.writeMessage(t))},t.prototype.send=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this.replaceStreamingParams(e),s=i[0],r=i[1],o=this.sendWithProtocol(this.createInvocation(t,e,!0,r));return this.launchStreams(s,o),o},t.prototype.invoke=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=this.replaceStreamingParams(n),r=s[0],o=s[1],a=this.createInvocation(t,n,!1,o),A=new Promise((function(t,n){e.callbacks[a.invocationId]=function(e,i){i?n(i):e&&(e.type===H.Completion?e.error?n(new Error(e.error)):t(e.result):n(new Error("Unexpected message type: "+e.type)))};var i=e.sendWithProtocol(a).catch((function(t){n(t),delete e.callbacks[a.invocationId]}));e.launchStreams(r,i)}));return A},t.prototype.on=function(t,e){t&&e&&(t=t.toLowerCase(),this.methods[t]||(this.methods[t]=[]),-1===this.methods[t].indexOf(e)&&this.methods[t].push(e))},t.prototype.off=function(t,e){if(t){t=t.toLowerCase();var n=this.methods[t];if(n)if(e){var i=n.indexOf(e);-1!==i&&(n.splice(i,1),0===n.length&&delete this.methods[t])}else delete this.methods[t]}},t.prototype.onclose=function(t){t&&this.closedCallbacks.push(t)},t.prototype.onreconnecting=function(t){t&&this.reconnectingCallbacks.push(t)},t.prototype.onreconnected=function(t){t&&this.reconnectedCallbacks.push(t)},t.prototype.processIncomingData=function(t){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(t=this.processHandshakeResponse(t),this.receivedHandshakeResponse=!0),t)for(var e=0,n=this.protocol.parseMessages(t,this.logger);e<n.length;e++){var i=n[e];switch(i.type){case H.Invocation:this.invokeClientMethod(i);break;case H.StreamItem:case H.Completion:var s=this.callbacks[i.invocationId];s&&(i.type===H.Completion&&delete this.callbacks[i.invocationId],s(i));break;case H.Ping:break;case H.Close:this.logger.log(d.Information,"Close message received from server.");var r=i.error?new Error("Server returned an error on close: "+i.error):void 0;!0===i.allowReconnect?this.connection.stop(r):this.stopPromise=this.stopInternal(r);break;default:this.logger.log(d.Warning,"Invalid message type: "+i.type+".")}}this.resetTimeoutPeriod()},t.prototype.processHandshakeResponse=function(t){var e,n,i;try{i=(e=this.handshakeProtocol.parseHandshakeResponse(t))[0],n=e[1]}catch(t){var s="Error parsing handshake response: "+t;this.logger.log(d.Error,s);var r=new Error(s);throw this.handshakeRejecter(r),r}if(n.error){s="Server returned handshake error: "+n.error;this.logger.log(d.Error,s);r=new Error(s);throw this.handshakeRejecter(r),r}return this.logger.log(d.Debug,"Server handshake complete."),this.handshakeResolver(),i},t.prototype.resetKeepAliveInterval=function(){var t=this;this.connection.features.inherentKeepAlive||(this.cleanupPingTimer(),this.pingServerHandle=setTimeout((function(){return q(t,void 0,void 0,(function(){return K(this,(function(t){switch(t.label){case 0:if(this.connectionState!==J.Connected)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return t.sent(),[3,4];case 3:return t.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}}))}))}),this.keepAliveIntervalInMilliseconds))},t.prototype.resetTimeoutPeriod=function(){var t=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout((function(){return t.serverTimeout()}),this.serverTimeoutInMilliseconds))},t.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},t.prototype.invokeClientMethod=function(t){var e=this,n=this.methods[t.target.toLowerCase()];if(n){try{n.forEach((function(n){return n.apply(e,t.arguments)}))}catch(e){this.logger.log(d.Error,"A callback for the method "+t.target.toLowerCase()+" threw error '"+e+"'.")}if(t.invocationId){var i="Server requested a response, which is not supported in this version of the client.";this.logger.log(d.Error,i),this.stopPromise=this.stopInternal(new Error(i))}}else this.logger.log(d.Warning,"No client method with the name '"+t.target+"' found.")},t.prototype.connectionClosed=function(t){this.logger.log(d.Debug,"HubConnection.connectionClosed("+t+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||t||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===J.Disconnecting?this.completeClose(t):this.connectionState===J.Connected&&this.reconnectPolicy?this.reconnect(t):this.connectionState===J.Connected&&this.completeClose(t)},t.prototype.completeClose=function(t){var e=this;if(this.connectionStarted){this.connectionState=J.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach((function(n){return n.apply(e,[t])}))}catch(e){this.logger.log(d.Error,"An onclose callback called with error '"+t+"' threw error '"+e+"'.")}}},t.prototype.reconnect=function(t){return q(this,void 0,void 0,(function(){var e,n,i,s,r,o=this;return K(this,(function(a){switch(a.label){case 0:if(e=Date.now(),n=0,i=void 0!==t?t:new Error("Attempting to reconnect due to a unknown error."),null===(s=this.getNextRetryDelay(n++,0,i)))return this.logger.log(d.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(t),[2];if(this.connectionState=J.Reconnecting,t?this.logger.log(d.Information,"Connection reconnecting because of error '"+t+"'."):this.logger.log(d.Information,"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach((function(e){return e.apply(o,[t])}))}catch(e){this.logger.log(d.Error,"An onreconnecting callback called with error '"+t+"' threw error '"+e+"'.")}if(this.connectionState!==J.Reconnecting)return this.logger.log(d.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}a.label=1;case 1:return null===s?[3,7]:(this.logger.log(d.Information,"Reconnect attempt number "+n+" will start in "+s+" ms."),[4,new Promise((function(t){o.reconnectDelayHandle=setTimeout(t,s)}))]);case 2:if(a.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==J.Reconnecting)return this.logger.log(d.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(a.sent(),this.connectionState=J.Connected,this.logger.log(d.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach((function(t){return t.apply(o,[o.connection.connectionId])}))}catch(t){this.logger.log(d.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+t+"'.")}return[2];case 5:return r=a.sent(),this.logger.log(d.Information,"Reconnect attempt failed because of error '"+r+"'."),this.connectionState!==J.Reconnecting?(this.logger.log(d.Debug,"Connection left the reconnecting state during reconnect attempt. Done reconnecting."),[2]):(i=r instanceof Error?r:new Error(r.toString()),s=this.getNextRetryDelay(n++,Date.now()-e,i),[3,6]);case 6:return[3,1];case 7:return this.logger.log(d.Information,"Reconnect retries have been exhausted after "+(Date.now()-e)+" ms and "+n+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}}))}))},t.prototype.getNextRetryDelay=function(t,e,n){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:n})}catch(n){return this.logger.log(d.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+t+", "+e+") threw error '"+n+"'."),null}},t.prototype.cancelCallbacksWithError=function(t){var e=this.callbacks;this.callbacks={},Object.keys(e).forEach((function(n){(0,e[n])(null,t)}))},t.prototype.cleanupPingTimer=function(){this.pingServerHandle&&clearTimeout(this.pingServerHandle)},t.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},t.prototype.createInvocation=function(t,e,n,i){if(n)return 0!==i.length?{arguments:e,streamIds:i,target:t,type:H.Invocation}:{arguments:e,target:t,type:H.Invocation};var s=this.invocationId;return this.invocationId++,0!==i.length?{arguments:e,invocationId:s.toString(),streamIds:i,target:t,type:H.Invocation}:{arguments:e,invocationId:s.toString(),target:t,type:H.Invocation}},t.prototype.launchStreams=function(t,e){var n=this;if(0!==t.length){e||(e=Promise.resolve());var i=function(i){t[i].subscribe({complete:function(){e=e.then((function(){return n.sendWithProtocol(n.createCompletionMessage(i))}))},error:function(t){var s;s=t instanceof Error?t.message:t&&t.toString?t.toString():"Unknown error",e=e.then((function(){return n.sendWithProtocol(n.createCompletionMessage(i,s))}))},next:function(t){e=e.then((function(){return n.sendWithProtocol(n.createStreamItemMessage(i,t))}))}})};for(var s in t)i(s)}},t.prototype.replaceStreamingParams=function(t){for(var e=[],n=[],i=0;i<t.length;i++){var s=t[i];if(this.isObservable(s)){var r=this.invocationId;this.invocationId++,e[r]=s,n.push(r.toString()),t.splice(i,1)}}return[e,n]},t.prototype.isObservable=function(t){return t&&t.subscribe&&"function"==typeof t.subscribe},t.prototype.createStreamInvocation=function(t,e,n){var i=this.invocationId;return this.invocationId++,0!==n.length?{arguments:e,invocationId:i.toString(),streamIds:n,target:t,type:H.StreamInvocation}:{arguments:e,invocationId:i.toString(),target:t,type:H.StreamInvocation}},t.prototype.createCancelInvocation=function(t){return{invocationId:t,type:H.CancelInvocation}},t.prototype.createStreamItemMessage=function(t,e){return{invocationId:t,item:e,type:H.StreamItem}},t.prototype.createCompletionMessage=function(t,e,n){return e?{error:e,invocationId:t,type:H.Completion}:{invocationId:t,result:n,type:H.Completion}},t}(),nt=[0,2e3,1e4,3e4,null],it=function(){function t(t){this.retryDelays=void 0!==t?t.concat([null]):nt}return t.prototype.nextRetryDelayInMilliseconds=function(t){return this.retryDelays[t.previousRetryCount]},t}();!function(t){t[t.None=0]="None",t[t.WebSockets=1]="WebSockets",t[t.ServerSentEvents=2]="ServerSentEvents",t[t.LongPolling=4]="LongPolling"}($||($={})),function(t){t[t.Text=1]="Text",t[t.Binary=2]="Binary"}(tt||(tt={}));var st=function(){function t(){this.isAborted=!1,this.onabort=null}return t.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(t.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),t}(),rt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},ot=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{A(i.next(t))}catch(t){r(t)}}function a(t){try{A(i.throw(t))}catch(t){r(t)}}function A(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(o,a)}A((i=i.apply(t,e||[])).next())}))},at=function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},At=function(){function t(t,e,n,i,s,r){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.pollAbort=new st,this.logMessageContent=i,this.withCredentials=s,this.headers=r,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(t.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),t.prototype.connect=function(t,e){return ot(this,void 0,void 0,(function(){var n,i,s,r,o,a,A,c,h;return at(this,(function(u){switch(u.label){case 0:if(E.isRequired(t,"url"),E.isRequired(e,"transferFormat"),E.isIn(e,tt,"transferFormat"),this.url=t,this.logger.log(d.Trace,"(LongPolling transport) Connecting."),e===tt.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return i=O(),s=i[0],r=i[1],o=rt(((n={})[s]=r,n),this.headers),a={abortSignal:this.pollAbort.signal,headers:o,timeout:1e5,withCredentials:this.withCredentials},e===tt.Binary&&(a.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return A=u.sent(),this.updateHeaderToken(a,A),c=t+"&_="+Date.now(),this.logger.log(d.Trace,"(LongPolling transport) polling: "+c+"."),[4,this.httpClient.get(c,a)];case 2:return 200!==(h=u.sent()).statusCode?(this.logger.log(d.Error,"(LongPolling transport) Unexpected response code: "+h.statusCode+"."),this.closeError=new p(h.statusText||"",h.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,a),[2]}}))}))},t.prototype.getAccessToken=function(){return ot(this,void 0,void 0,(function(){return at(this,(function(t){switch(t.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,null]}}))}))},t.prototype.updateHeaderToken=function(t,e){t.headers||(t.headers={}),e?t.headers.Authorization="Bearer "+e:t.headers.Authorization&&delete t.headers.Authorization},t.prototype.poll=function(t,e){return ot(this,void 0,void 0,(function(){var n,i,s,r;return at(this,(function(o){switch(o.label){case 0:o.trys.push([0,,8,9]),o.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:n=o.sent(),this.updateHeaderToken(e,n),o.label=3;case 3:return o.trys.push([3,5,,6]),i=t+"&_="+Date.now(),this.logger.log(d.Trace,"(LongPolling transport) polling: "+i+"."),[4,this.httpClient.get(i,e)];case 4:return 204===(s=o.sent()).statusCode?(this.logger.log(d.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==s.statusCode?(this.logger.log(d.Error,"(LongPolling transport) Unexpected response code: "+s.statusCode+"."),this.closeError=new p(s.statusText||"",s.statusCode),this.running=!1):s.content?(this.logger.log(d.Trace,"(LongPolling transport) data received. "+B(s.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(s.content)):this.logger.log(d.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return r=o.sent(),this.running?r instanceof g?this.logger.log(d.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=r,this.running=!1):this.logger.log(d.Trace,"(LongPolling transport) Poll errored after shutdown: "+r.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(d.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}}))}))},t.prototype.send=function(t){return ot(this,void 0,void 0,(function(){return at(this,(function(e){return this.running?[2,M(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},t.prototype.stop=function(){return ot(this,void 0,void 0,(function(){var t,e,n,i,s,r;return at(this,(function(o){switch(o.label){case 0:this.logger.log(d.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),o.label=1;case 1:return o.trys.push([1,,5,6]),[4,this.receiving];case 2:return o.sent(),this.logger.log(d.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={},e=O(),n=e[0],i=e[1],t[n]=i,s={headers:rt({},t,this.headers),withCredentials:this.withCredentials},[4,this.getAccessToken()];case 3:return r=o.sent(),this.updateHeaderToken(s,r),[4,this.httpClient.delete(this.url,s)];case 4:return o.sent(),this.logger.log(d.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(d.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}}))}))},t.prototype.raiseOnClose=function(){if(this.onclose){var t="(LongPolling transport) Firing onclose event.";this.closeError&&(t+=" Error: "+this.closeError),this.logger.log(d.Trace,t),this.onclose(this.closeError)}},t}(),ct=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},ht=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{A(i.next(t))}catch(t){r(t)}}function a(t){try{A(i.throw(t))}catch(t){r(t)}}function A(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(o,a)}A((i=i.apply(t,e||[])).next())}))},ut=function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},lt=function(){function t(t,e,n,i,s,r,o){this.httpClient=t,this.accessTokenFactory=e,this.logger=n,this.logMessageContent=i,this.withCredentials=r,this.eventSourceConstructor=s,this.headers=o,this.onreceive=null,this.onclose=null}return t.prototype.connect=function(t,e){return ht(this,void 0,void 0,(function(){var n,i=this;return ut(this,(function(s){switch(s.label){case 0:return E.isRequired(t,"url"),E.isRequired(e,"transferFormat"),E.isIn(e,tt,"transferFormat"),this.logger.log(d.Trace,"(SSE transport) Connecting."),this.url=t,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=s.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),s.label=2;case 2:return[2,new Promise((function(n,s){var r=!1;if(e===tt.Text){var o;if(I.isBrowser||I.isWebWorker)o=new i.eventSourceConstructor(t,{withCredentials:i.withCredentials});else{var a=i.httpClient.getCookieString(t),A={};A.Cookie=a;var c=O(),h=c[0],u=c[1];A[h]=u,o=new i.eventSourceConstructor(t,{withCredentials:i.withCredentials,headers:ct({},A,i.headers)})}try{o.onmessage=function(t){if(i.onreceive)try{i.logger.log(d.Trace,"(SSE transport) data received. "+B(t.data,i.logMessageContent)+"."),i.onreceive(t.data)}catch(t){return void i.close(t)}},o.onerror=function(t){var e=new Error(t.data||"Error occurred");r?i.close(e):s(e)},o.onopen=function(){i.logger.log(d.Information,"SSE connected to "+i.url),i.eventSource=o,r=!0,n()}}catch(t){return void s(t)}}else s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))]}}))}))},t.prototype.send=function(t){return ht(this,void 0,void 0,(function(){return ut(this,(function(e){return this.eventSource?[2,M(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},t.prototype.stop=function(){return this.close(),Promise.resolve()},t.prototype.close=function(t){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(t))},t}(),dt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},ft=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{A(i.next(t))}catch(t){r(t)}}function a(t){try{A(i.throw(t))}catch(t){r(t)}}function A(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(o,a)}A((i=i.apply(t,e||[])).next())}))},pt=function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},gt=function(){function t(t,e,n,i,s,r){this.logger=n,this.accessTokenFactory=e,this.logMessageContent=i,this.webSocketConstructor=s,this.httpClient=t,this.onreceive=null,this.onclose=null,this.headers=r}return t.prototype.connect=function(t,e){return ft(this,void 0,void 0,(function(){var n,i=this;return pt(this,(function(s){switch(s.label){case 0:return E.isRequired(t,"url"),E.isRequired(e,"transferFormat"),E.isIn(e,tt,"transferFormat"),this.logger.log(d.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=s.sent())&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),s.label=2;case 2:return[2,new Promise((function(n,s){var r;t=t.replace(/^http/,"ws");var o=i.httpClient.getCookieString(t),a=!1;if(I.isNode){var A={},c=O(),h=c[0],u=c[1];A[h]=u,o&&(A.Cookie=""+o),r=new i.webSocketConstructor(t,void 0,{headers:dt({},A,i.headers)})}r||(r=new i.webSocketConstructor(t)),e===tt.Binary&&(r.binaryType="arraybuffer"),r.onopen=function(e){i.logger.log(d.Information,"WebSocket connected to "+t+"."),i.webSocket=r,a=!0,n()},r.onerror=function(t){var e=null;e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),s(e)},r.onmessage=function(t){if(i.logger.log(d.Trace,"(WebSockets transport) data received. "+B(t.data,i.logMessageContent)+"."),i.onreceive)try{i.onreceive(t.data)}catch(t){return void i.close(t)}},r.onclose=function(t){if(a)i.close(t);else{var e=null;e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:new Error("There was an error with the transport."),s(e)}}}))]}}))}))},t.prototype.send=function(t){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(d.Trace,"(WebSockets transport) sending data. "+B(t,this.logMessageContent)+"."),this.webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},t.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},t.prototype.close=function(t){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(d.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.isCloseEvent(t)||!1!==t.wasClean&&1e3===t.code?t instanceof Error?this.onclose(t):this.onclose():this.onclose(new Error("WebSocket closed with status code: "+t.code+" ("+t.reason+").")))},t.prototype.isCloseEvent=function(t){return t&&"boolean"==typeof t.wasClean&&"number"==typeof t.code},t}(),vt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},wt=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{A(i.next(t))}catch(t){r(t)}}function a(t){try{A(i.throw(t))}catch(t){r(t)}}function A(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(o,a)}A((i=i.apply(t,e||[])).next())}))},mt=function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},Dt=function(){function t(t,e){var n;if(void 0===e&&(e={}),this.features={},this.negotiateVersion=1,E.isRequired(t,"url"),this.logger=void 0===(n=e.logger)?new S(d.Information):null===n?y.instance:n.log?n:new S(n),this.baseUrl=this.resolveUrl(t),(e=e||{}).logMessageContent=void 0!==e.logMessageContent&&e.logMessageContent,"boolean"!=typeof e.withCredentials&&void 0!==e.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");e.withCredentials=void 0===e.withCredentials||e.withCredentials;var i=null,s=null;if(I.isNode&&"undefined"!=typeof require){var r="function"==typeof __webpack_require__?__non_webpack_require__:require;i=r("ws"),s=r("eventsource")}I.isNode||"undefined"==typeof WebSocket||e.WebSocket?I.isNode&&!e.WebSocket&&i&&(e.WebSocket=i):e.WebSocket=WebSocket,I.isNode||"undefined"==typeof EventSource||e.EventSource?I.isNode&&!e.EventSource&&void 0!==s&&(e.EventSource=s):e.EventSource=EventSource,this.httpClient=e.httpClient||new Y(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=e,this.onreceive=null,this.onclose=null}return t.prototype.start=function(t){return wt(this,void 0,void 0,(function(){var e;return mt(this,(function(n){switch(n.label){case 0:return t=t||tt.Binary,E.isIn(t,tt,"transferFormat"),this.logger.log(d.Debug,"Starting connection with transfer format '"+tt[t]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting",this.startInternalPromise=this.startInternal(t),[4,this.startInternalPromise]);case 1:return n.sent(),"Disconnecting"!==this.connectionState?[3,3]:(e="Failed to start the HttpConnection before stop() was called.",this.logger.log(d.Error,e),[4,this.stopPromise]);case 2:return n.sent(),[2,Promise.reject(new Error(e))];case 3:if("Connected"!==this.connectionState)return e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",this.logger.log(d.Error,e),[2,Promise.reject(new Error(e))];n.label=4;case 4:return this.connectionStarted=!0,[2]}}))}))},t.prototype.send=function(t){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new yt(this.transport)),this.sendQueue.send(t))},t.prototype.stop=function(t){return wt(this,void 0,void 0,(function(){var e=this;return mt(this,(function(n){switch(n.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(d.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(d.Debug,"Call to HttpConnection.stop("+t+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise((function(t){e.stopPromiseResolver=t})),[4,this.stopInternal(t)]);case 1:return n.sent(),[4,this.stopPromise];case 2:return n.sent(),[2]}}))}))},t.prototype.stopInternal=function(t){return wt(this,void 0,void 0,(function(){var e;return mt(this,(function(n){switch(n.label){case 0:this.stopError=t,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:case 3:return n.sent(),[3,4];case 4:if(!this.transport)return[3,9];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return n.sent(),[3,8];case 7:return e=n.sent(),this.logger.log(d.Error,"HttpConnection.transport.stop() threw error '"+e+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(d.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),this.stopConnection(),n.label=10;case 10:return[2]}}))}))},t.prototype.startInternal=function(t){return wt(this,void 0,void 0,(function(){var e,n,i,s,r,o;return mt(this,(function(a){switch(a.label){case 0:e=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,a.label=1;case 1:return a.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==$.WebSockets?[3,3]:(this.transport=this.constructTransport($.WebSockets),[4,this.startTransport(e,t)]):[3,5];case 2:return a.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,i=0,s=function(){var t;return mt(this,(function(s){switch(s.label){case 0:return[4,r.getNegotiationResponse(e)];case 1:if(n=s.sent(),"Disconnecting"===r.connectionState||"Disconnected"===r.connectionState)throw new Error("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return n.url&&(e=n.url),n.accessToken&&(t=n.accessToken,r.accessTokenFactory=function(){return t}),i++,[2]}}))},r=this,a.label=6;case 6:return[5,s()];case 7:a.sent(),a.label=8;case 8:if(n.url&&i<100)return[3,6];a.label=9;case 9:if(100===i&&n.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(e,this.options.transport,n,t)];case 10:a.sent(),a.label=11;case 11:return this.transport instanceof At&&(this.features.inherentKeepAlive=!0),"Connecting"===this.connectionState&&(this.logger.log(d.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return o=a.sent(),this.logger.log(d.Error,"Failed to start the connection: "+o),this.connectionState="Disconnected",this.transport=void 0,[2,Promise.reject(o)];case 13:return[2]}}))}))},t.prototype.getNegotiationResponse=function(t){return wt(this,void 0,void 0,(function(){var e,n,i,s,r,o,a,A,c;return mt(this,(function(h){switch(h.label){case 0:return e={},this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=h.sent())&&(e.Authorization="Bearer "+n),h.label=2;case 2:i=O(),s=i[0],r=i[1],e[s]=r,o=this.resolveNegotiateUrl(t),this.logger.log(d.Debug,"Sending negotiation request: "+o+"."),h.label=3;case 3:return h.trys.push([3,5,,6]),[4,this.httpClient.post(o,{content:"",headers:vt({},e,this.options.headers),withCredentials:this.options.withCredentials})];case 4:return 200!==(a=h.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate '"+a.statusCode+"'"))]:((!(A=JSON.parse(a.content)).negotiateVersion||A.negotiateVersion<1)&&(A.connectionToken=A.connectionId),[2,A]);case 5:return c=h.sent(),this.logger.log(d.Error,"Failed to complete negotiation with the server: "+c),[2,Promise.reject(c)];case 6:return[2]}}))}))},t.prototype.createConnectUrl=function(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+"id="+e:t},t.prototype.createTransport=function(t,e,n,i){return wt(this,void 0,void 0,(function(){var s,r,o,a,A,c,h,u,l,f,p;return mt(this,(function(g){switch(g.label){case 0:return s=this.createConnectUrl(t,n.connectionToken),this.isITransport(e)?(this.logger.log(d.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,[4,this.startTransport(s,i)]):[3,2];case 1:return g.sent(),this.connectionId=n.connectionId,[2];case 2:r=[],o=n.availableTransports||[],a=n,A=0,c=o,g.label=3;case 3:return A<c.length?(h=c[A],(u=this.resolveTransportOrError(h,e,i))instanceof Error?(r.push(h.transport+" failed: "+u),[3,12]):[3,4]):[3,13];case 4:if(!this.isITransport(u))return[3,12];if(this.transport=u,a)return[3,9];g.label=5;case 5:return g.trys.push([5,7,,8]),[4,this.getNegotiationResponse(t)];case 6:return a=g.sent(),[3,8];case 7:return l=g.sent(),[2,Promise.reject(l)];case 8:s=this.createConnectUrl(t,a.connectionToken),g.label=9;case 9:return g.trys.push([9,11,,12]),[4,this.startTransport(s,i)];case 10:return g.sent(),this.connectionId=a.connectionId,[2];case 11:return f=g.sent(),this.logger.log(d.Error,"Failed to start the transport '"+h.transport+"': "+f),a=void 0,r.push(h.transport+" failed: "+f),"Connecting"!==this.connectionState?(p="Failed to select transport before stop() was called.",this.logger.log(d.Debug,p),[2,Promise.reject(new Error(p))]):[3,12];case 12:return A++,[3,3];case 13:return r.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+r.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}}))}))},t.prototype.constructTransport=function(t){switch(t){case $.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new gt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket,this.options.headers||{});case $.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new lt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource,this.options.withCredentials,this.options.headers||{});case $.LongPolling:return new At(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.withCredentials,this.options.headers||{});default:throw new Error("Unknown transport: "+t+".")}},t.prototype.startTransport=function(t,e){var n=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(t){return n.stopConnection(t)},this.transport.connect(t,e)},t.prototype.resolveTransportOrError=function(t,e,n){var i=$[t.transport];if(null==i)return this.logger.log(d.Debug,"Skipping transport '"+t.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+t.transport+"' because it is not supported by this client.");if(!function(t,e){return!t||0!=(e&t)}(e,i))return this.logger.log(d.Debug,"Skipping transport '"+$[i]+"' because it was disabled by the client."),new Error("'"+$[i]+"' is disabled by the client.");if(!(t.transferFormats.map((function(t){return tt[t]})).indexOf(n)>=0))return this.logger.log(d.Debug,"Skipping transport '"+$[i]+"' because it does not support the requested transfer format '"+tt[n]+"'."),new Error("'"+$[i]+"' does not support "+tt[n]+".");if(i===$.WebSockets&&!this.options.WebSocket||i===$.ServerSentEvents&&!this.options.EventSource)return this.logger.log(d.Debug,"Skipping transport '"+$[i]+"' because it is not supported in your environment.'"),new Error("'"+$[i]+"' is not supported in your environment.");this.logger.log(d.Debug,"Selecting transport '"+$[i]+"'.");try{return this.constructTransport(i)}catch(t){return t}},t.prototype.isITransport=function(t){return t&&"object"==typeof t&&"connect"in t},t.prototype.stopConnection=function(t){var e=this;if(this.logger.log(d.Debug,"HttpConnection.stopConnection("+t+") called while in state "+this.connectionState+"."),this.transport=void 0,t=this.stopError||t,this.stopError=void 0,"Disconnected"!==this.connectionState){if("Connecting"===this.connectionState)throw this.logger.log(d.Warning,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is still in the connecting state."),new Error("HttpConnection.stopConnection("+t+") was called while the connection is still in the connecting state.");if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),t?this.logger.log(d.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(d.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch((function(t){e.logger.log(d.Error,"TransportSendQueue.stop() threw error '"+t+"'.")})),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(e){this.logger.log(d.Error,"HttpConnection.onclose("+t+") threw error '"+e+"'.")}}}else this.logger.log(d.Debug,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is already in the disconnected state.")},t.prototype.resolveUrl=function(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!I.isBrowser||!window.document)throw new Error("Cannot resolve '"+t+"'.");var e=window.document.createElement("a");return e.href=t,this.logger.log(d.Information,"Normalizing '"+t+"' to '"+e.href+"'."),e.href},t.prototype.resolveNegotiateUrl=function(t){var e=t.indexOf("?"),n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",-1===(n+=-1===e?"":t.substring(e)).indexOf("negotiateVersion")&&(n+=-1===e?"?":"&",n+="negotiateVersion="+this.negotiateVersion),n},t}();var yt=function(){function t(t){this.transport=t,this.buffer=[],this.executing=!0,this.sendBufferedData=new bt,this.transportResult=new bt,this.sendLoopPromise=this.sendLoop()}return t.prototype.send=function(t){return this.bufferData(t),this.transportResult||(this.transportResult=new bt),this.transportResult.promise},t.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},t.prototype.bufferData=function(t){if(this.buffer.length&&typeof this.buffer[0]!=typeof t)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof t);this.buffer.push(t),this.sendBufferedData.resolve()},t.prototype.sendLoop=function(){return wt(this,void 0,void 0,(function(){var e,n,i;return mt(this,(function(s){switch(s.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(s.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new bt,e=this.transportResult,this.transportResult=void 0,n="string"==typeof this.buffer[0]?this.buffer.join(""):t.concatBuffers(this.buffer),this.buffer.length=0,s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.transport.send(n)];case 3:return s.sent(),e.resolve(),[3,5];case 4:return i=s.sent(),e.reject(i),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},t.concatBuffers=function(t){for(var e=t.map((function(t){return t.byteLength})).reduce((function(t,e){return t+e})),n=new Uint8Array(e),i=0,s=0,r=t;s<r.length;s++){var o=r[s];n.set(new Uint8Array(o),i),i+=o.byteLength}return n.buffer},t}(),bt=function(){function t(){var t=this;this.promise=new Promise((function(e,n){var i;return i=[e,n],t.resolver=i[0],t.rejecter=i[1],i}))}return t.prototype.resolve=function(){this.resolver()},t.prototype.reject=function(t){this.rejecter(t)},t}(),Pt=function(){function t(){this.name="json",this.version=1,this.transferFormat=tt.Text}return t.prototype.parseMessages=function(t,e){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===e&&(e=y.instance);for(var n=[],i=0,s=W.parse(t);i<s.length;i++){var r=s[i],o=JSON.parse(r);if("number"!=typeof o.type)throw new Error("Invalid payload.");switch(o.type){case H.Invocation:this.isInvocationMessage(o);break;case H.StreamItem:this.isStreamItemMessage(o);break;case H.Completion:this.isCompletionMessage(o);break;case H.Ping:case H.Close:break;default:e.log(d.Information,"Unknown message type '"+o.type+"' ignored.");continue}n.push(o)}return n},t.prototype.writeMessage=function(t){return W.write(JSON.stringify(t))},t.prototype.isInvocationMessage=function(t){this.assertNotEmptyString(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this.assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")},t.prototype.isStreamItemMessage=function(t){if(this.assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")},t.prototype.isCompletionMessage=function(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.assertNotEmptyString(t.error,"Invalid payload for Completion message."),this.assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")},t.prototype.assertNotEmptyString=function(t,e){if("string"!=typeof t||""===t)throw new Error(e)},t}(),Ct=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},Et={trace:d.Trace,debug:d.Debug,info:d.Information,information:d.Information,warn:d.Warning,warning:d.Warning,error:d.Error,critical:d.Critical,none:d.None};var It,Bt,_t,Mt=function(){function t(){}return t.prototype.configureLogging=function(t){if(E.isRequired(t,"logging"),void 0!==t.log)this.logger=t;else if("string"==typeof t){var e=function(t){var e=Et[t.toLowerCase()];if(void 0!==e)return e;throw new Error("Unknown log level: "+t)}(t);this.logger=new S(e)}else this.logger=new S(t);return this},t.prototype.withUrl=function(t,e){return E.isRequired(t,"url"),E.isNotEmpty(t,"url"),this.url=t,this.httpConnectionOptions=Ct({},this.httpConnectionOptions,"object"==typeof e?e:{transport:e}),this},t.prototype.withHubProtocol=function(t){return E.isRequired(t,"protocol"),this.protocol=t,this},t.prototype.withAutomaticReconnect=function(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new it(t):this.reconnectPolicy=t:this.reconnectPolicy=new it,this},t.prototype.build=function(){var t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var e=new Dt(this.url,t);return et.create(e,this.logger||y.instance,this.protocol||new Pt,this.reconnectPolicy)},t}();function xt(t){return new Promise((e=>{const n=setInterval((()=>{t()&&(clearInterval(n),e())}),100)}))}class St{constructor(t,e,n=null){this.value=t,this.desc=e,this.value=t,this.desc=e,this.props=n||{}}contains(t){return t instanceof St?this.contains(t.value):this.value.indexOf(t)>=0}}class Ot extends Event{constructor(t){super(t),this.eventType=t}}class Qt extends Ot{constructor(){super("serverConnected")}}class kt extends Ot{constructor(){super("serverDisconnected")}}class Tt extends Ot{constructor(){super("serverFailed")}}class Lt extends Ot{constructor(t,e){super(t),this.id=e}}class Rt extends Lt{constructor(t,e,n){super(t,e),this.displayName=n}}class Ut extends Lt{constructor(t,e){super("conferenceJoined",t),this.pose=e}}class jt extends Lt{constructor(t){super("conferenceLeft",t)}}class Ft extends Ot{constructor(){super("conferenceFailed")}}class Nt extends Rt{constructor(t,e,n){super("participantJoined",t,e),this.source=n}}class Ht extends Lt{constructor(t){super("participantLeft",t)}}class zt extends Rt{constructor(t,e){super("userNameChanged",t,e)}}class Gt extends Lt{constructor(t,e,n){super(t,e),this.muted=n}}class Xt extends Gt{constructor(t,e){super("audioMuteStatusChanged",t,e)}}class Yt extends Gt{constructor(t,e){super("videoMuteStatusChanged",t,e)}}!function(t){t.Audio="audio",t.Video="video"}(It||(It={})),function(t){t.Added="added",t.Removed="removed",t.Changed="changed"}(Bt||(Bt={}));class Wt extends Lt{constructor(t,e,n,i,s){super(t,i),this.kind=e,this.op=n,this.stream=s}}class Zt extends Wt{constructor(t,e,n,i){super(t,e,Bt.Added,n,i)}}class Jt extends Wt{constructor(t,e,n,i){super(t,e,Bt.Removed,n,i)}}class Vt extends Zt{constructor(t,e){super("audioAdded",It.Audio,t,e)}}class qt extends Jt{constructor(t,e){super("audioRemoved",It.Audio,t,e)}}class Kt extends Zt{constructor(t,e){super("videoAdded",It.Video,t,e)}}class $t extends Jt{constructor(t,e){super("videoRemoved",It.Video,t,e)}}class te extends Lt{constructor(t,e,n,i,s,r,o,a,A,c,h){super(t,e),this.px=n,this.py=i,this.pz=s,this.fx=r,this.fy=o,this.fz=a,this.ux=A,this.uy=c,this.uz=h}set(t,e,n,i,s,r,o,a,A){this.px=t,this.py=e,this.pz=n,this.fx=i,this.fy=s,this.fz=r,this.ux=o,this.uy=a,this.uz=A}}class ee extends te{constructor(t,e,n,i,s,r,o,a,A,c){super("userPosed",t,e,n,i,s,r,o,a,A,c)}}class ne extends te{constructor(t,e,n,i,s,r,o,a,A,c,h){super("userPointer",t,n,i,s,r,o,a,A,c,h),this.name=e}}class ie extends Lt{constructor(t,e,n){super(t,e),this.emoji=n instanceof St?n.value:n}}class se extends ie{constructor(t,e){super("emote",t,e)}}class re extends ie{constructor(t,e){super("setAvatarEmoji",t,e)}}class oe extends Lt{constructor(t,e){super("avatarChanged",t),this.url=e}}class ae extends Lt{constructor(t,e){super("chat",t),this.text=e}}function Ae(t,e){return t.splice(e,1)[0]}!function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting"}(_t||(_t={}));class ce extends Event{constructor(t){super(t)}}class he extends class{constructor(){this.listeners=new Map,this.listenerOptions=new Map}addEventListener(t,e,i){if(n(e)){let n=this.listeners.get(t);n||(n=new Array,this.listeners.set(t,n)),n.find((t=>t===e))||(n.push(e),i&&this.listenerOptions.set(e,i))}}removeEventListener(t,e){if(n(e)){const n=this.listeners.get(t);n&&this.removeListener(n,e)}}removeListener(t,e){const n=t.findIndex((t=>t===e));n>=0&&(Ae(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){const e=this.listeners.get(t.type);if(e)for(const n of e){const i=this.listenerOptions.get(n);i&&i.once&&this.removeListener(e,n),n.call(this,t)}return!t.defaultPrevented}}{constructor(){super(...arguments),this.mappedCallbacks=new Map}addEventListener(t,e,n){let i=this.mappedCallbacks.get(e);null==i&&(i=t=>e(t),this.mappedCallbacks.set(e,i)),super.addEventListener(t,i,n)}removeEventListener(t,e){const n=this.mappedCallbacks.get(e);n&&super.removeEventListener(t,n)}}class ue extends he{constructor(t){super(),this.sleepTime=t,this.tasks=new Map}async getNext(t,e){return new Promise((n=>{const i=s=>{s instanceof Lt&&s.id===e&&(this.removeEventListener(t,i),n(s))};this.addEventListener(t,i)}))}get isConnected(){return this.metadataState===_t.Connected}async callThrottled(t,e,...n){if(!this.tasks.has(t)){const s=performance.now(),r=this.callInternal(e,...n);this.tasks.set(t,r),await r;const o=performance.now()-s;this.sleepTime-o>0&&await(i=this.sleepTime,new Promise((t=>{setTimeout(t,i)}))),this.tasks.delete(t)}var i}async callImmediate(t,...e){await this.callInternal(t,...e)}setLocalPose(t,e,n,i,s,r,o,a,A){this.callThrottled("userPosed","userPosed",t,e,n,i,s,r,o,a,A)}setLocalPoseImmediate(t,e,n,i,s,r,o,a,A){this.callImmediate("userPosed",t,e,n,i,s,r,o,a,A)}setLocalPointer(t,e,n,i,s,r,o,a,A,c){this.callThrottled("userPointer"+t,"userPointer",t,e,n,i,s,r,o,a,A,c)}setAvatarEmoji(t){this.callImmediate("setAvatarEmoji",t)}setAvatarURL(t){this.callImmediate("avatarChanged",t)}emote(t){this.callImmediate("emote",t)}chat(t){this.callImmediate("chat",t)}}function le(t,...e){for(const n of e)for(const e of t)if(n(e))return e;return null}"chrome"in globalThis&&navigator.userAgent.match("CriOS"),/^((?!chrome|android).)*safari/i.test(navigator.userAgent),/Opera/.test(navigator.userAgent),/Android/.test(navigator.userAgent),/iPad|iPhone|iPod/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints,/BlackBerry/.test(navigator.userAgent),/(UC Browser |UCWEB)/.test(navigator.userAgent),/Mobile VR/.test(navigator.userAgent);const de=/oculus/.test(navigator.userAgent),fe=(de&&/pacific/.test(navigator.userAgent),de&&/quest/.test(navigator.userAgent));class pe{constructor(t,e,...n){this.key=t,this.value=e,this.tags=n.map((t=>t.toLocaleUpperCase())),Object.freeze(this)}apply(t){if(a(t)){0===this.tags.length||this.tags.indexOf(t.tagName)>-1?"style"===this.key?Object.assign(t.style,this.value):this.key in t?t[this.key]=this.value:!1===this.value?t.removeAttribute(this.key):!0===this.value?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value):console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`)}else t[this.key]=this.value}}function ge(t){return new pe("autoplay",t,"audio","video")}function ve(t){return new pe("playsInline",t,"audio","video")}function we(t){return new pe("srcObject",t,"audio","video")}class me{constructor(...t){this.set=new Map;const e=(t,e)=>{e||s(e)?this.set.set(t,e):this.set.has(t)&&this.set.delete(t)};for(const n of t)if(n instanceof pe){const{key:t,value:i}=n;e(t,i)}else for(const[t,i]of n.set.entries())e(t,i)}apply(t){const e=a(t)?t.style:t;for(const t of this.set.entries()){const[n,i]=t;e[n]=i}}}function De(...t){return new me(...t)}function ye(t){return new pe("display",t)}function be(t){return!h(t)&&!i(t)&&!r(t)&&!s(t)&&!function(t){return t instanceof Date}(t)&&"element"in t&&t.element instanceof Node}function Pe(t,...e){let n=null;for(const t of e)if(t instanceof pe&&"id"===t.key){n=document.getElementById(t.value);break}null==n&&(n=document.createElement(t));for(let t of e)null!=t&&(i(t)||r(t)||s(t)||t instanceof Date||t instanceof Node||be(t)?(be(t)?t=t.element:t instanceof Node||(t=document.createTextNode(t.toLocaleString())),n.appendChild(t)):(t instanceof Function&&(t=t(!0)),t.apply(n)));return n}function Ce(...t){return Pe("audio",...t)}function Ee(t){const e=function(...t){return Pe("script",...t)}(new pe("src",t,"audio","embed","iframe","img","input","script","source","track","video"));document.body.appendChild(e)}class Ie{async getResponse(t,e){const n={};if(e instanceof Map)for(const t of e.entries())n[t[0]]=t[1];return await this.readRequestResponse(t,fetch(t,{headers:n}))}async postObjectForResponse(t,e,n){const i={"Content-Type":e instanceof FormData?"multipart/form-data":"application/json"};if(n instanceof Map)for(const t of n.entries())i[t[0]]=t[1];const s=e instanceof FormData?e:JSON.stringify(e);return await this.readRequestResponse(t,fetch(t,{method:"POST",headers:i,body:s}))}async readRequestResponse(t,e){const n=await e;if(!n.ok){let e=n.statusText;throw n.body&&(e+=" ",e+=await n.text(),e=e.trim()),new Error(`[${n.status}] - ${e} . Path ${t}`)}return n}async readResponseBuffer(t,e,n){const i=e.headers.get("Content-Type");if(!i)throw new Error("Server did not provide a content type");let s=1;const r=e.headers.get("Content-Length");r?(s=parseInt(r,10),c(s)||(console.warn(`Server did not provide a valid content length header. Value: ${r}, Path: ${t}`),s=1)):console.warn(`Server did not provide a content length header. Path: ${t}`);if(c(s)||(s=1),!e.body)throw new Error("No response body!");const o=e.body.getReader(),a=[];let A=0;for(;;){const{done:e,value:i}=await o.read();if(e)break;i&&(a.push(i),A+=i.length,n&&n(A,Math.max(A,s),t))}const h=new ArrayBuffer(A),u=new Uint8Array(h);A=0;for(const t of a)u.set(t,A),A+=t.length;return n&&n(1,1,t),{buffer:h,contentType:i}}async _getBuffer(t,e,n){h(e)||e instanceof Map||(n=e,e=void 0);const i=await this.getResponse(t,e);return await this.readResponseBuffer(t,i,n)}async getBuffer(t,e,n){return await this._getBuffer(t,e,n)}async _postObjectForBuffer(t,e,n,i){h(n)||n instanceof Map||(i=n,n=void 0);const s=await this.postObjectForResponse(t,e,n);return await this.readResponseBuffer(t,s,i)}async postObjectForBuffer(t,e,n,i){return await this._postObjectForBuffer(t,e,n,i)}async _getBlob(t,e,n){h(e)||e instanceof Map||(n=e,e=void 0);const{buffer:i,contentType:s}=await this._getBuffer(t,e,n);return new Blob([i],{type:s})}async getBlob(t,e,n){return this._getBlob(t,e,n)}async _postObjectForBlob(t,e,n,i){h(n)||n instanceof Map||(i=n,n=void 0);const{buffer:s,contentType:r}=await this._postObjectForBuffer(t,e,n,i);return new Blob([s],{type:r})}async postObjectForBlob(t,e,n,i){return this._postObjectForBlob(t,e,n,i)}async _getFile(t,e,n){h(e)||e instanceof Map||(n=e,e=void 0);const i=await this._getBlob(t,e,n);return URL.createObjectURL(i)}async getFile(t,e,n){return await this._getFile(t,e,n)}async _postObjectForFile(t,e,n,i){h(n)||n instanceof Map||(i=n,n=void 0);const s=await this._postObjectForBlob(t,e,n,i);return URL.createObjectURL(s)}async postObjectForFile(t,e,n,i){return await this._postObjectForFile(t,e,n,i)}readBufferText(t){return new TextDecoder("utf-8").decode(t)}async _getText(t,e,n){h(e)||e instanceof Map||(n=e,e=void 0);const{buffer:i}=await this._getBuffer(t,e,n);return this.readBufferText(i)}async getText(t,e,n){return await this._getText(t,e,n)}async _postObjectForText(t,e,n,i){h(n)||n instanceof Map||(i=n,n=void 0);const{buffer:s}=await this._postObjectForBuffer(t,e,n,i);return this.readBufferText(s)}async postObjectForText(t,e,n,i){return await this._postObjectForText(t,e,n,i)}async _getObject(t,e,n){h(e)||e instanceof Map||(n=e,e=void 0);const i=await this._getText(t,e,n);return JSON.parse(i)}async getObject(t,e,n){return await this._getObject(t,e,n)}async _postObjectForObject(t,e,n,i){h(n)||n instanceof Map||(i=n,n=void 0);const s=await this._postObjectForText(t,e,n,i);return JSON.parse(s)}async postObjectForObject(t,e,n,i){return await this._postObjectForObject(t,e,n,i)}async postObject(t,e,n){await this.postObjectForResponse(t,e,n)}readTextXml(t){return(new DOMParser).parseFromString(t,"text/xml").documentElement}async _getXml(t,e,n){h(e)||e instanceof Map||(n=e,e=void 0);const i=await this._getText(t,e,n);return this.readTextXml(i)}async getXml(t,e,n){return await this._getXml(t,e,n)}async postObjectForXml(t,e,n,i){const s=await this._postObjectForText(t,e,n,i);return this.readTextXml(s)}async loadScript(t,e,n){if(e())n&&n(1,1,"skip");else{const i=xt(e);Ee(await this.getFile(t,n)),await i}}}function Be(t,e){const n=t.indexOf(e);return n>-1&&(Ae(t,n),!0)}function _e(t,e,n=!0){let i=function(t,e){let n=0,i=t.length,s=Math.floor((n+i)/2),r=!1;for(;n<i&&s<t.length;){const o=t[s];!h(o)&&e<o?i=s:(e===o&&(r=!0),n=s+1),s=Math.floor((n+i)/2)}return r||(s+=.5),s}(t,e);const s=i%1==0;return i|=0,s&&!n||t.splice(i,0,e),i}const Me=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function xe(){return Promise.resolve()}function Se(t){var e;o(e=t)&&"dispose"in e&&n(e.dispose)?t.dispose():function(t){return o(t)&&"close"in t&&n(t.close)}(t)&&t.close()}function Oe(t,e){try{return e(t)}finally{Se(t)}}function Qe(t,e,n){return Math.min(n,Math.max(e,t))}class ke extends Event{constructor(){super("audioActivity"),this.id=null,this.isActive=!1,Object.seal(this)}set(t,e){this.id=t,this.isActive=e}}function Te(t){return t.splice(0)}function Le(t,e){return async n=>{await t(n),await e(n)}}function Re(t,e,n,s){null==s&&c(n)&&(s=n,n=void 0);const r=i(e),o=i(n),a=null!=s;return new Promise(((i,A)=>{if(r){const n=()=>{t.removeEventListener(e,i)};i=Le(n,i),A=Le(n,A)}if(o){const e=()=>{t.removeEventListener(n,A)};i=Le(e,i),A=Le(e,A)}if(a){const t=setTimeout(A,s,`'${e}' has timed out.`),n=()=>clearTimeout(t);i=Le(n,i),A=Le(n,A)}r&&t.addEventListener(e,i),o&&t.addEventListener(n,(()=>{A("Rejection event found")}))}))}class Ue{constructor(t){this.audioContext=t,this.gain=null,this.minDistance=1,this.maxDistance=10,this.rolloff=1,this.algorithm="logarithmic",this.transitionTime=.1,this.gain=t.createGain()}setAudioProperties(t,e,n,i,s){this.minDistance=t,this.maxDistance=e,this.rolloff=n,this.algorithm=i,this.transitionTime=s}dispose(){this.gain&&(this.gain.disconnect(),this.gain=null)}get volume(){return this.gain.gain.value}set volume(t){this.gain.gain.value=t}play(){return Promise.resolve()}stop(){}}class je extends Ue{constructor(t,e,n){super(n),this.id=t,this.source=e,this.source instanceof AudioBufferSourceNode?this.playingSources=new Array:this.source.connect(this.gain)}dispose(){this.source&&(this.source.disconnect(),this.source=null),super.dispose()}get isPlaying(){return this.playingSources.length>0}async play(){if(this.source instanceof AudioBufferSourceNode){const t=this.source.context.createBufferSource();this.playingSources.push(t),t.buffer=this.source.buffer,t.loop=this.source.loop,t.connect(this.gain),t.start(),this.source.loop||(await Re(t,"ended"),this.playingSources.indexOf(t)>=0&&(t.stop(),t.disconnect(this.gain),Be(this.playingSources,t)))}}stop(){if(this.source instanceof AudioBufferSourceNode){for(const t of this.playingSources)t.stop(),t.disconnect(this.gain);Te(this.playingSources)}}}const Fe=new ke;function Ne(t,e,n){const i=e/2;return Qe(Math.round(t/i*n),0,n)}class He extends he{constructor(t,e,n){if(super(),this.wasActive=!1,this.analyser=null,!c(n)||n<=0)throw new Error("Buffer size must be greater than 0");this.id=t.id,this.bufferSize=n,this.buffer=new Float32Array(this.bufferSize),this.wasActive=!1,this.activityCounter=0;const i=()=>{t.spatializer instanceof je&&t.spatializer.source?(this.analyser=e.createAnalyser(),this.analyser.fftSize=2*this.bufferSize,this.analyser.smoothingTimeConstant=.2,t.spatializer.source.connect(this.analyser)):setTimeout(i,0)};i()}dispose(){this.analyser&&(this.analyser.disconnect(),this.analyser=null),this.buffer=null}update(){if(this.analyser){this.analyser.getFloatFrequencyData(this.buffer);const t=1.1+function(t,e,n,i,s){const r=t.context.sampleRate,o=Ne(n,r,s),a=Ne(i,r,s),A=a-o;let c=0;for(let t=o;t<a;++t)c+=e[t];return 0===A?0:c/A}(this.analyser,this.buffer,85,255,this.bufferSize)/100;t>=.5&&this.activityCounter<60?this.activityCounter++:t<.5&&this.activityCounter>0&&this.activityCounter--;const e=this.activityCounter>5;this.wasActive!==e&&(this.wasActive=e,Fe.id=this.id,Fe.isActive=e,this.dispatchEvent(Fe))}}}var ze="undefined"!=typeof Float32Array?Float32Array:Array;function Ge(){var t=new ze(9);return ze!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Xe(t,e,n,i,s,r,o,a,A,c){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=r,t[5]=o,t[6]=a,t[7]=A,t[8]=c,t}function Ye(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function We(){var t=new ze(16);return ze!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ze(t,e,n,i,s,r,o,a,A,c,h,u,l,d,f,p,g){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=r,t[5]=o,t[6]=a,t[7]=A,t[8]=c,t[9]=h,t[10]=u,t[11]=l,t[12]=d,t[13]=f,t[14]=p,t[15]=g,t}function Je(){var t=new ze(3);return ze!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ve(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function qe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ke(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function $e(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function tn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function en(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function nn(t,e){var n=e[0],i=e[1],s=e[2],r=n*n+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function sn(t,e,n){var i=e[0],s=e[1],r=e[2],o=n[0],a=n[1],A=n[2];return t[0]=s*A-r*a,t[1]=r*o-i*A,t[2]=i*a-s*o,t}function rn(t,e,n,i){var s=e[0],r=e[1],o=e[2];return t[0]=s+i*(n[0]-s),t[1]=r+i*(n[1]-r),t[2]=o+i*(n[2]-o),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var on,an=tn;on=Je();function An(t,e,n){const i=n-e;return 0===i?0:(t-e)/i}class cn{constructor(){this.t=0,this.p=Je(),this.f=Ke(Je(),0,0,-1),this.u=Ke(Je(),0,1,0),Object.seal(this)}set(t,e,n,i,s,r,o,a,A){Ke(this.p,t,e,n),Ke(this.f,i,s,r),Ke(this.u,o,a,A)}copy(t){qe(this.p,t.p),qe(this.f,t.f),qe(this.u,t.u)}interpolate(t,e,n){if(n<=t.t)this.copy(t);else if(e.t<=n)this.copy(e);else if(t.t<n){const i=An(n,t.t,e.t);this.copy(t),rn(this.p,this.p,e.p,i),rn(this.f,this.f,e.f,i),rn(this.u,this.u,e.u,i),nn(this.f,this.f),nn(this.u,this.u),this.t=n}}}const hn=Je();class un{constructor(){this.start=new cn,this.current=new cn,this.end=new cn,this.offset=Je()}setOffset(t,e,n){Ke(hn,t,e,n),an(hn,hn,this.offset),$e(this.start.p,this.start.p,hn),$e(this.current.p,this.current.p,hn),$e(this.end.p,this.end.p,hn),en(this.start.f,this.start.f,2),$e(this.start.f,this.start.f,hn),nn(this.start.f,this.start.f),en(this.current.f,this.current.f,2),$e(this.current.f,this.current.f,hn),nn(this.current.f,this.current.f),en(this.end.f,this.end.f,2),$e(this.end.f,this.end.f,hn),nn(this.end.f,this.end.f),Ke(this.offset,t,e,n)}setTarget(t,e,n,i,s,r,o,a,A,c,h){const u=this.offset[0],l=this.offset[1],d=this.offset[2];this.end.set(t+u,e+l,n+d,i,s,r,o,a,A),this.end.t=c+h,h>0?(this.start.copy(this.current),this.start.t=c):(this.start.copy(this.end),this.start.t=c,this.current.copy(this.end),this.current.t=c)}setTargetPosition(t,e,n,i,s){this.setTarget(t,e,n,this.end.f[0],this.end.f[1],this.end.f[2],this.end.u[0],this.end.u[1],this.end.u[2],i,s)}setTargetOrientation(t,e,n,i,s,r,o,a){this.setTarget(this.end.p[0],this.end.p[1],this.end.p[2],t,e,n,i,s,r,o,a)}update(t){this.current.interpolate(this.start,this.end,t)}}class ln{constructor(t){this.id=t,this.pose=new un,this.streams=new Map,this._spatializer=null}get spatializer(){return this._spatializer}set spatializer(t){this.spatializer!==t&&(this._spatializer&&this._spatializer.dispose(),this._spatializer=t)}dispose(){this.spatializer=null}update(t){this.pose.update(t),this.spatializer&&this.spatializer.update(this.pose.current,t)}}var dn;!function(t){t.Ambisonic="ambisonic",t.Bypass="bypass",t.None="off"}(dn||(dn={}));const fn=[[[0,0,0,1,1,1],[.052336,.034899,.017452,.999848,.999391,.99863],[.104528,.069756,.034899,.999391,.997564,.994522],[.156434,.104528,.052336,.99863,.994522,.987688],[.207912,.139173,.069756,.997564,.990268,.978148],[.258819,.173648,.087156,.996195,.984808,.965926],[.309017,.207912,.104528,.994522,.978148,.951057],[.358368,.241922,.121869,.992546,.970296,.93358],[.406737,.275637,.139173,.990268,.961262,.913545],[.45399,.309017,.156434,.987688,.951057,.891007],[.5,.34202,.173648,.984808,.939693,.866025],[.544639,.374607,.190809,.981627,.927184,.838671],[.587785,.406737,.207912,.978148,.913545,.809017],[.62932,.438371,.224951,.97437,.898794,.777146],[.669131,.469472,.241922,.970296,.882948,.743145],[.707107,.5,.258819,.965926,.866025,.707107],[.743145,.529919,.275637,.961262,.848048,.669131],[.777146,.559193,.292372,.956305,.829038,.62932],[.809017,.587785,.309017,.951057,.809017,.587785],[.838671,.615661,.325568,.945519,.788011,.544639],[.866025,.642788,.34202,.939693,.766044,.5],[.891007,.669131,.358368,.93358,.743145,.45399],[.913545,.694658,.374607,.927184,.71934,.406737],[.93358,.71934,.390731,.920505,.694658,.358368],[.951057,.743145,.406737,.913545,.669131,.309017],[.965926,.766044,.422618,.906308,.642788,.258819],[.978148,.788011,.438371,.898794,.615661,.207912],[.987688,.809017,.45399,.891007,.587785,.156434],[.994522,.829038,.469472,.882948,.559193,.104528],[.99863,.848048,.48481,.87462,.529919,.052336],[1,.866025,.5,.866025,.5,0],[.99863,.882948,.515038,.857167,.469472,-.052336],[.994522,.898794,.529919,.848048,.438371,-.104528],[.987688,.913545,.544639,.838671,.406737,-.156434],[.978148,.927184,.559193,.829038,.374607,-.207912],[.965926,.939693,.573576,.819152,.34202,-.258819],[.951057,.951057,.587785,.809017,.309017,-.309017],[.93358,.961262,.601815,.798636,.275637,-.358368],[.913545,.970296,.615661,.788011,.241922,-.406737],[.891007,.978148,.62932,.777146,.207912,-.45399],[.866025,.984808,.642788,.766044,.173648,-.5],[.838671,.990268,.656059,.75471,.139173,-.544639],[.809017,.994522,.669131,.743145,.104528,-.587785],[.777146,.997564,.681998,.731354,.069756,-.62932],[.743145,.999391,.694658,.71934,.034899,-.669131],[.707107,1,.707107,.707107,0,-.707107],[.669131,.999391,.71934,.694658,-.034899,-.743145],[.62932,.997564,.731354,.681998,-.069756,-.777146],[.587785,.994522,.743145,.669131,-.104528,-.809017],[.544639,.990268,.75471,.656059,-.139173,-.838671],[.5,.984808,.766044,.642788,-.173648,-.866025],[.45399,.978148,.777146,.62932,-.207912,-.891007],[.406737,.970296,.788011,.615661,-.241922,-.913545],[.358368,.961262,.798636,.601815,-.275637,-.93358],[.309017,.951057,.809017,.587785,-.309017,-.951057],[.258819,.939693,.819152,.573576,-.34202,-.965926],[.207912,.927184,.829038,.559193,-.374607,-.978148],[.156434,.913545,.838671,.544639,-.406737,-.987688],[.104528,.898794,.848048,.529919,-.438371,-.994522],[.052336,.882948,.857167,.515038,-.469472,-.99863],[0,.866025,.866025,.5,-.5,-1],[-.052336,.848048,.87462,.48481,-.529919,-.99863],[-.104528,.829038,.882948,.469472,-.559193,-.994522],[-.156434,.809017,.891007,.45399,-.587785,-.987688],[-.207912,.788011,.898794,.438371,-.615661,-.978148],[-.258819,.766044,.906308,.422618,-.642788,-.965926],[-.309017,.743145,.913545,.406737,-.669131,-.951057],[-.358368,.71934,.920505,.390731,-.694658,-.93358],[-.406737,.694658,.927184,.374607,-.71934,-.913545],[-.45399,.669131,.93358,.358368,-.743145,-.891007],[-.5,.642788,.939693,.34202,-.766044,-.866025],[-.544639,.615661,.945519,.325568,-.788011,-.838671],[-.587785,.587785,.951057,.309017,-.809017,-.809017],[-.62932,.559193,.956305,.292372,-.829038,-.777146],[-.669131,.529919,.961262,.275637,-.848048,-.743145],[-.707107,.5,.965926,.258819,-.866025,-.707107],[-.743145,.469472,.970296,.241922,-.882948,-.669131],[-.777146,.438371,.97437,.224951,-.898794,-.62932],[-.809017,.406737,.978148,.207912,-.913545,-.587785],[-.838671,.374607,.981627,.190809,-.927184,-.544639],[-.866025,.34202,.984808,.173648,-.939693,-.5],[-.891007,.309017,.987688,.156434,-.951057,-.45399],[-.913545,.275637,.990268,.139173,-.961262,-.406737],[-.93358,.241922,.992546,.121869,-.970296,-.358368],[-.951057,.207912,.994522,.104528,-.978148,-.309017],[-.965926,.173648,.996195,.087156,-.984808,-.258819],[-.978148,.139173,.997564,.069756,-.990268,-.207912],[-.987688,.104528,.99863,.052336,-.994522,-.156434],[-.994522,.069756,.999391,.034899,-.997564,-.104528],[-.99863,.034899,.999848,.017452,-.999391,-.052336],[-1,0,1,0,-1,-0],[-.99863,-.034899,.999848,-.017452,-.999391,.052336],[-.994522,-.069756,.999391,-.034899,-.997564,.104528],[-.987688,-.104528,.99863,-.052336,-.994522,.156434],[-.978148,-.139173,.997564,-.069756,-.990268,.207912],[-.965926,-.173648,.996195,-.087156,-.984808,.258819],[-.951057,-.207912,.994522,-.104528,-.978148,.309017],[-.93358,-.241922,.992546,-.121869,-.970296,.358368],[-.913545,-.275637,.990268,-.139173,-.961262,.406737],[-.891007,-.309017,.987688,-.156434,-.951057,.45399],[-.866025,-.34202,.984808,-.173648,-.939693,.5],[-.838671,-.374607,.981627,-.190809,-.927184,.544639],[-.809017,-.406737,.978148,-.207912,-.913545,.587785],[-.777146,-.438371,.97437,-.224951,-.898794,.62932],[-.743145,-.469472,.970296,-.241922,-.882948,.669131],[-.707107,-.5,.965926,-.258819,-.866025,.707107],[-.669131,-.529919,.961262,-.275637,-.848048,.743145],[-.62932,-.559193,.956305,-.292372,-.829038,.777146],[-.587785,-.587785,.951057,-.309017,-.809017,.809017],[-.544639,-.615661,.945519,-.325568,-.788011,.838671],[-.5,-.642788,.939693,-.34202,-.766044,.866025],[-.45399,-.669131,.93358,-.358368,-.743145,.891007],[-.406737,-.694658,.927184,-.374607,-.71934,.913545],[-.358368,-.71934,.920505,-.390731,-.694658,.93358],[-.309017,-.743145,.913545,-.406737,-.669131,.951057],[-.258819,-.766044,.906308,-.422618,-.642788,.965926],[-.207912,-.788011,.898794,-.438371,-.615661,.978148],[-.156434,-.809017,.891007,-.45399,-.587785,.987688],[-.104528,-.829038,.882948,-.469472,-.559193,.994522],[-.052336,-.848048,.87462,-.48481,-.529919,.99863],[-0,-.866025,.866025,-.5,-.5,1],[.052336,-.882948,.857167,-.515038,-.469472,.99863],[.104528,-.898794,.848048,-.529919,-.438371,.994522],[.156434,-.913545,.838671,-.544639,-.406737,.987688],[.207912,-.927184,.829038,-.559193,-.374607,.978148],[.258819,-.939693,.819152,-.573576,-.34202,.965926],[.309017,-.951057,.809017,-.587785,-.309017,.951057],[.358368,-.961262,.798636,-.601815,-.275637,.93358],[.406737,-.970296,.788011,-.615661,-.241922,.913545],[.45399,-.978148,.777146,-.62932,-.207912,.891007],[.5,-.984808,.766044,-.642788,-.173648,.866025],[.544639,-.990268,.75471,-.656059,-.139173,.838671],[.587785,-.994522,.743145,-.669131,-.104528,.809017],[.62932,-.997564,.731354,-.681998,-.069756,.777146],[.669131,-.999391,.71934,-.694658,-.034899,.743145],[.707107,-1,.707107,-.707107,-0,.707107],[.743145,-.999391,.694658,-.71934,.034899,.669131],[.777146,-.997564,.681998,-.731354,.069756,.62932],[.809017,-.994522,.669131,-.743145,.104528,.587785],[.838671,-.990268,.656059,-.75471,.139173,.544639],[.866025,-.984808,.642788,-.766044,.173648,.5],[.891007,-.978148,.62932,-.777146,.207912,.45399],[.913545,-.970296,.615661,-.788011,.241922,.406737],[.93358,-.961262,.601815,-.798636,.275637,.358368],[.951057,-.951057,.587785,-.809017,.309017,.309017],[.965926,-.939693,.573576,-.819152,.34202,.258819],[.978148,-.927184,.559193,-.829038,.374607,.207912],[.987688,-.913545,.544639,-.838671,.406737,.156434],[.994522,-.898794,.529919,-.848048,.438371,.104528],[.99863,-.882948,.515038,-.857167,.469472,.052336],[1,-.866025,.5,-.866025,.5,0],[.99863,-.848048,.48481,-.87462,.529919,-.052336],[.994522,-.829038,.469472,-.882948,.559193,-.104528],[.987688,-.809017,.45399,-.891007,.587785,-.156434],[.978148,-.788011,.438371,-.898794,.615661,-.207912],[.965926,-.766044,.422618,-.906308,.642788,-.258819],[.951057,-.743145,.406737,-.913545,.669131,-.309017],[.93358,-.71934,.390731,-.920505,.694658,-.358368],[.913545,-.694658,.374607,-.927184,.71934,-.406737],[.891007,-.669131,.358368,-.93358,.743145,-.45399],[.866025,-.642788,.34202,-.939693,.766044,-.5],[.838671,-.615661,.325568,-.945519,.788011,-.544639],[.809017,-.587785,.309017,-.951057,.809017,-.587785],[.777146,-.559193,.292372,-.956305,.829038,-.62932],[.743145,-.529919,.275637,-.961262,.848048,-.669131],[.707107,-.5,.258819,-.965926,.866025,-.707107],[.669131,-.469472,.241922,-.970296,.882948,-.743145],[.62932,-.438371,.224951,-.97437,.898794,-.777146],[.587785,-.406737,.207912,-.978148,.913545,-.809017],[.544639,-.374607,.190809,-.981627,.927184,-.838671],[.5,-.34202,.173648,-.984808,.939693,-.866025],[.45399,-.309017,.156434,-.987688,.951057,-.891007],[.406737,-.275637,.139173,-.990268,.961262,-.913545],[.358368,-.241922,.121869,-.992546,.970296,-.93358],[.309017,-.207912,.104528,-.994522,.978148,-.951057],[.258819,-.173648,.087156,-.996195,.984808,-.965926],[.207912,-.139173,.069756,-.997564,.990268,-.978148],[.156434,-.104528,.052336,-.99863,.994522,-.987688],[.104528,-.069756,.034899,-.999391,.997564,-.994522],[.052336,-.034899,.017452,-.999848,.999391,-.99863],[0,-0,0,-1,1,-1],[-.052336,.034899,-.017452,-.999848,.999391,-.99863],[-.104528,.069756,-.034899,-.999391,.997564,-.994522],[-.156434,.104528,-.052336,-.99863,.994522,-.987688],[-.207912,.139173,-.069756,-.997564,.990268,-.978148],[-.258819,.173648,-.087156,-.996195,.984808,-.965926],[-.309017,.207912,-.104528,-.994522,.978148,-.951057],[-.358368,.241922,-.121869,-.992546,.970296,-.93358],[-.406737,.275637,-.139173,-.990268,.961262,-.913545],[-.45399,.309017,-.156434,-.987688,.951057,-.891007],[-.5,.34202,-.173648,-.984808,.939693,-.866025],[-.544639,.374607,-.190809,-.981627,.927184,-.838671],[-.587785,.406737,-.207912,-.978148,.913545,-.809017],[-.62932,.438371,-.224951,-.97437,.898794,-.777146],[-.669131,.469472,-.241922,-.970296,.882948,-.743145],[-.707107,.5,-.258819,-.965926,.866025,-.707107],[-.743145,.529919,-.275637,-.961262,.848048,-.669131],[-.777146,.559193,-.292372,-.956305,.829038,-.62932],[-.809017,.587785,-.309017,-.951057,.809017,-.587785],[-.838671,.615661,-.325568,-.945519,.788011,-.544639],[-.866025,.642788,-.34202,-.939693,.766044,-.5],[-.891007,.669131,-.358368,-.93358,.743145,-.45399],[-.913545,.694658,-.374607,-.927184,.71934,-.406737],[-.93358,.71934,-.390731,-.920505,.694658,-.358368],[-.951057,.743145,-.406737,-.913545,.669131,-.309017],[-.965926,.766044,-.422618,-.906308,.642788,-.258819],[-.978148,.788011,-.438371,-.898794,.615661,-.207912],[-.987688,.809017,-.45399,-.891007,.587785,-.156434],[-.994522,.829038,-.469472,-.882948,.559193,-.104528],[-.99863,.848048,-.48481,-.87462,.529919,-.052336],[-1,.866025,-.5,-.866025,.5,0],[-.99863,.882948,-.515038,-.857167,.469472,.052336],[-.994522,.898794,-.529919,-.848048,.438371,.104528],[-.987688,.913545,-.544639,-.838671,.406737,.156434],[-.978148,.927184,-.559193,-.829038,.374607,.207912],[-.965926,.939693,-.573576,-.819152,.34202,.258819],[-.951057,.951057,-.587785,-.809017,.309017,.309017],[-.93358,.961262,-.601815,-.798636,.275637,.358368],[-.913545,.970296,-.615661,-.788011,.241922,.406737],[-.891007,.978148,-.62932,-.777146,.207912,.45399],[-.866025,.984808,-.642788,-.766044,.173648,.5],[-.838671,.990268,-.656059,-.75471,.139173,.544639],[-.809017,.994522,-.669131,-.743145,.104528,.587785],[-.777146,.997564,-.681998,-.731354,.069756,.62932],[-.743145,.999391,-.694658,-.71934,.034899,.669131],[-.707107,1,-.707107,-.707107,0,.707107],[-.669131,.999391,-.71934,-.694658,-.034899,.743145],[-.62932,.997564,-.731354,-.681998,-.069756,.777146],[-.587785,.994522,-.743145,-.669131,-.104528,.809017],[-.544639,.990268,-.75471,-.656059,-.139173,.838671],[-.5,.984808,-.766044,-.642788,-.173648,.866025],[-.45399,.978148,-.777146,-.62932,-.207912,.891007],[-.406737,.970296,-.788011,-.615661,-.241922,.913545],[-.358368,.961262,-.798636,-.601815,-.275637,.93358],[-.309017,.951057,-.809017,-.587785,-.309017,.951057],[-.258819,.939693,-.819152,-.573576,-.34202,.965926],[-.207912,.927184,-.829038,-.559193,-.374607,.978148],[-.156434,.913545,-.838671,-.544639,-.406737,.987688],[-.104528,.898794,-.848048,-.529919,-.438371,.994522],[-.052336,.882948,-.857167,-.515038,-.469472,.99863],[-0,.866025,-.866025,-.5,-.5,1],[.052336,.848048,-.87462,-.48481,-.529919,.99863],[.104528,.829038,-.882948,-.469472,-.559193,.994522],[.156434,.809017,-.891007,-.45399,-.587785,.987688],[.207912,.788011,-.898794,-.438371,-.615661,.978148],[.258819,.766044,-.906308,-.422618,-.642788,.965926],[.309017,.743145,-.913545,-.406737,-.669131,.951057],[.358368,.71934,-.920505,-.390731,-.694658,.93358],[.406737,.694658,-.927184,-.374607,-.71934,.913545],[.45399,.669131,-.93358,-.358368,-.743145,.891007],[.5,.642788,-.939693,-.34202,-.766044,.866025],[.544639,.615661,-.945519,-.325568,-.788011,.838671],[.587785,.587785,-.951057,-.309017,-.809017,.809017],[.62932,.559193,-.956305,-.292372,-.829038,.777146],[.669131,.529919,-.961262,-.275637,-.848048,.743145],[.707107,.5,-.965926,-.258819,-.866025,.707107],[.743145,.469472,-.970296,-.241922,-.882948,.669131],[.777146,.438371,-.97437,-.224951,-.898794,.62932],[.809017,.406737,-.978148,-.207912,-.913545,.587785],[.838671,.374607,-.981627,-.190809,-.927184,.544639],[.866025,.34202,-.984808,-.173648,-.939693,.5],[.891007,.309017,-.987688,-.156434,-.951057,.45399],[.913545,.275637,-.990268,-.139173,-.961262,.406737],[.93358,.241922,-.992546,-.121869,-.970296,.358368],[.951057,.207912,-.994522,-.104528,-.978148,.309017],[.965926,.173648,-.996195,-.087156,-.984808,.258819],[.978148,.139173,-.997564,-.069756,-.990268,.207912],[.987688,.104528,-.99863,-.052336,-.994522,.156434],[.994522,.069756,-.999391,-.034899,-.997564,.104528],[.99863,.034899,-.999848,-.017452,-.999391,.052336],[1,0,-1,-0,-1,0],[.99863,-.034899,-.999848,.017452,-.999391,-.052336],[.994522,-.069756,-.999391,.034899,-.997564,-.104528],[.987688,-.104528,-.99863,.052336,-.994522,-.156434],[.978148,-.139173,-.997564,.069756,-.990268,-.207912],[.965926,-.173648,-.996195,.087156,-.984808,-.258819],[.951057,-.207912,-.994522,.104528,-.978148,-.309017],[.93358,-.241922,-.992546,.121869,-.970296,-.358368],[.913545,-.275637,-.990268,.139173,-.961262,-.406737],[.891007,-.309017,-.987688,.156434,-.951057,-.45399],[.866025,-.34202,-.984808,.173648,-.939693,-.5],[.838671,-.374607,-.981627,.190809,-.927184,-.544639],[.809017,-.406737,-.978148,.207912,-.913545,-.587785],[.777146,-.438371,-.97437,.224951,-.898794,-.62932],[.743145,-.469472,-.970296,.241922,-.882948,-.669131],[.707107,-.5,-.965926,.258819,-.866025,-.707107],[.669131,-.529919,-.961262,.275637,-.848048,-.743145],[.62932,-.559193,-.956305,.292372,-.829038,-.777146],[.587785,-.587785,-.951057,.309017,-.809017,-.809017],[.544639,-.615661,-.945519,.325568,-.788011,-.838671],[.5,-.642788,-.939693,.34202,-.766044,-.866025],[.45399,-.669131,-.93358,.358368,-.743145,-.891007],[.406737,-.694658,-.927184,.374607,-.71934,-.913545],[.358368,-.71934,-.920505,.390731,-.694658,-.93358],[.309017,-.743145,-.913545,.406737,-.669131,-.951057],[.258819,-.766044,-.906308,.422618,-.642788,-.965926],[.207912,-.788011,-.898794,.438371,-.615661,-.978148],[.156434,-.809017,-.891007,.45399,-.587785,-.987688],[.104528,-.829038,-.882948,.469472,-.559193,-.994522],[.052336,-.848048,-.87462,.48481,-.529919,-.99863],[0,-.866025,-.866025,.5,-.5,-1],[-.052336,-.882948,-.857167,.515038,-.469472,-.99863],[-.104528,-.898794,-.848048,.529919,-.438371,-.994522],[-.156434,-.913545,-.838671,.544639,-.406737,-.987688],[-.207912,-.927184,-.829038,.559193,-.374607,-.978148],[-.258819,-.939693,-.819152,.573576,-.34202,-.965926],[-.309017,-.951057,-.809017,.587785,-.309017,-.951057],[-.358368,-.961262,-.798636,.601815,-.275637,-.93358],[-.406737,-.970296,-.788011,.615661,-.241922,-.913545],[-.45399,-.978148,-.777146,.62932,-.207912,-.891007],[-.5,-.984808,-.766044,.642788,-.173648,-.866025],[-.544639,-.990268,-.75471,.656059,-.139173,-.838671],[-.587785,-.994522,-.743145,.669131,-.104528,-.809017],[-.62932,-.997564,-.731354,.681998,-.069756,-.777146],[-.669131,-.999391,-.71934,.694658,-.034899,-.743145],[-.707107,-1,-.707107,.707107,-0,-.707107],[-.743145,-.999391,-.694658,.71934,.034899,-.669131],[-.777146,-.997564,-.681998,.731354,.069756,-.62932],[-.809017,-.994522,-.669131,.743145,.104528,-.587785],[-.838671,-.990268,-.656059,.75471,.139173,-.544639],[-.866025,-.984808,-.642788,.766044,.173648,-.5],[-.891007,-.978148,-.62932,.777146,.207912,-.45399],[-.913545,-.970296,-.615661,.788011,.241922,-.406737],[-.93358,-.961262,-.601815,.798636,.275637,-.358368],[-.951057,-.951057,-.587785,.809017,.309017,-.309017],[-.965926,-.939693,-.573576,.819152,.34202,-.258819],[-.978148,-.927184,-.559193,.829038,.374607,-.207912],[-.987688,-.913545,-.544639,.838671,.406737,-.156434],[-.994522,-.898794,-.529919,.848048,.438371,-.104528],[-.99863,-.882948,-.515038,.857167,.469472,-.052336],[-1,-.866025,-.5,.866025,.5,-0],[-.99863,-.848048,-.48481,.87462,.529919,.052336],[-.994522,-.829038,-.469472,.882948,.559193,.104528],[-.987688,-.809017,-.45399,.891007,.587785,.156434],[-.978148,-.788011,-.438371,.898794,.615661,.207912],[-.965926,-.766044,-.422618,.906308,.642788,.258819],[-.951057,-.743145,-.406737,.913545,.669131,.309017],[-.93358,-.71934,-.390731,.920505,.694658,.358368],[-.913545,-.694658,-.374607,.927184,.71934,.406737],[-.891007,-.669131,-.358368,.93358,.743145,.45399],[-.866025,-.642788,-.34202,.939693,.766044,.5],[-.838671,-.615661,-.325568,.945519,.788011,.544639],[-.809017,-.587785,-.309017,.951057,.809017,.587785],[-.777146,-.559193,-.292372,.956305,.829038,.62932],[-.743145,-.529919,-.275637,.961262,.848048,.669131],[-.707107,-.5,-.258819,.965926,.866025,.707107],[-.669131,-.469472,-.241922,.970296,.882948,.743145],[-.62932,-.438371,-.224951,.97437,.898794,.777146],[-.587785,-.406737,-.207912,.978148,.913545,.809017],[-.544639,-.374607,-.190809,.981627,.927184,.838671],[-.5,-.34202,-.173648,.984808,.939693,.866025],[-.45399,-.309017,-.156434,.987688,.951057,.891007],[-.406737,-.275637,-.139173,.990268,.961262,.913545],[-.358368,-.241922,-.121869,.992546,.970296,.93358],[-.309017,-.207912,-.104528,.994522,.978148,.951057],[-.258819,-.173648,-.087156,.996195,.984808,.965926],[-.207912,-.139173,-.069756,.997564,.990268,.978148],[-.156434,-.104528,-.052336,.99863,.994522,.987688],[-.104528,-.069756,-.034899,.999391,.997564,.994522],[-.052336,-.034899,-.017452,.999848,.999391,.99863]],[[-1,-0,1,-0,0,-1,-0,0,-0],[-.999848,.017452,.999543,-.030224,264e-6,-.999086,.042733,-59e-5,4e-6],[-.999391,.034899,.998173,-.060411,.001055,-.996348,.085356,-.002357,34e-6],[-.99863,.052336,.995891,-.090524,.002372,-.991791,.127757,-.005297,113e-6],[-.997564,.069756,.992701,-.120527,.004214,-.985429,.169828,-.0094,268e-6],[-.996195,.087156,.988606,-.150384,.006578,-.977277,.21146,-.014654,523e-6],[-.994522,.104528,.983611,-.180057,.009462,-.967356,.252544,-.021043,903e-6],[-.992546,.121869,.977722,-.209511,.012862,-.955693,.292976,-.028547,.001431],[-.990268,.139173,.970946,-.238709,.016774,-.942316,.332649,-.037143,.002131],[-.987688,.156434,.963292,-.267617,.021193,-.927262,.371463,-.046806,.003026],[-.984808,.173648,.954769,-.296198,.026114,-.910569,.409317,-.057505,.00414],[-.981627,.190809,.945388,-.324419,.03153,-.892279,.446114,-.069209,.005492],[-.978148,.207912,.935159,-.352244,.037436,-.872441,.481759,-.08188,.007105],[-.97437,.224951,.924096,-.379641,.043823,-.851105,.516162,-.095481,.008999],[-.970296,.241922,.912211,-.406574,.050685,-.828326,.549233,-.109969,.011193],[-.965926,.258819,.899519,-.433013,.058013,-.804164,.580889,-.1253,.013707],[-.961262,.275637,.886036,-.458924,.065797,-.77868,.61105,-.141427,.016556],[-.956305,.292372,.871778,-.484275,.074029,-.75194,.639639,-.158301,.019758],[-.951057,.309017,.856763,-.509037,.082698,-.724012,.666583,-.175868,.023329],[-.945519,.325568,.841008,-.533178,.091794,-.694969,.691816,-.194075,.027281],[-.939693,.34202,.824533,-.55667,.101306,-.664885,.715274,-.212865,.03163],[-.93358,.358368,.807359,-.579484,.111222,-.633837,.736898,-.23218,.036385],[-.927184,.374607,.789505,-.601592,.121529,-.601904,.756637,-.25196,.041559],[-.920505,.390731,.770994,-.622967,.132217,-.569169,.774442,-.272143,.04716],[-.913545,.406737,.751848,-.643582,.143271,-.535715,.79027,-.292666,.053196],[-.906308,.422618,.732091,-.663414,.154678,-.501627,.804083,-.313464,.059674],[-.898794,.438371,.711746,-.682437,.166423,-.466993,.81585,-.334472,.066599],[-.891007,.45399,.690839,-.700629,.178494,-.431899,.825544,-.355623,.073974],[-.882948,.469472,.669395,-.717968,.190875,-.396436,.833145,-.376851,.081803],[-.87462,.48481,.647439,-.734431,.203551,-.360692,.838638,-.398086,.090085],[-.866025,.5,.625,-.75,.216506,-.32476,.842012,-.419263,.098821],[-.857167,.515038,.602104,-.764655,.229726,-.288728,.843265,-.440311,.108009],[-.848048,.529919,.578778,-.778378,.243192,-.252688,.842399,-.461164,.117644],[-.838671,.544639,.555052,-.791154,.256891,-.21673,.839422,-.481753,.127722],[-.829038,.559193,.530955,-.802965,.270803,-.180944,.834347,-.502011,.138237],[-.819152,.573576,.506515,-.813798,.284914,-.14542,.827194,-.521871,.149181],[-.809017,.587785,.481763,-.823639,.299204,-.110246,.817987,-.541266,.160545],[-.798636,.601815,.456728,-.832477,.313658,-.075508,.806757,-.560132,.172317],[-.788011,.615661,.431441,-.840301,.328257,-.041294,.793541,-.578405,.184487],[-.777146,.62932,.405934,-.847101,.342984,-.007686,.778379,-.596021,.19704],[-.766044,.642788,.380236,-.852869,.357821,.025233,.761319,-.612921,.209963],[-.75471,.656059,.35438,-.857597,.372749,.057383,.742412,-.629044,.223238],[-.743145,.669131,.328396,-.861281,.387751,.088686,.721714,-.644334,.23685],[-.731354,.681998,.302317,-.863916,.402807,.119068,.699288,-.658734,.250778],[-.71934,.694658,.276175,-.865498,.417901,.148454,.675199,-.67219,.265005],[-.707107,.707107,.25,-.866025,.433013,.176777,.649519,-.684653,.279508],[-.694658,.71934,.223825,-.865498,.448125,.203969,.622322,-.696073,.294267],[-.681998,.731354,.197683,-.863916,.463218,.229967,.593688,-.706405,.309259],[-.669131,.743145,.171604,-.861281,.478275,.254712,.5637,-.715605,.324459],[-.656059,.75471,.14562,-.857597,.493276,.278147,.532443,-.723633,.339844],[-.642788,.766044,.119764,-.852869,.508205,.300221,.500009,-.730451,.355387],[-.62932,.777146,.094066,-.847101,.523041,.320884,.46649,-.736025,.371063],[-.615661,.788011,.068559,-.840301,.537768,.340093,.431982,-.740324,.386845],[-.601815,.798636,.043272,-.832477,.552367,.357807,.396584,-.74332,.402704],[-.587785,.809017,.018237,-.823639,.566821,.373991,.360397,-.744989,.418613],[-.573576,.819152,-.006515,-.813798,.581112,.388612,.323524,-.745308,.434544],[-.559193,.829038,-.030955,-.802965,.595222,.401645,.286069,-.744262,.450467],[-.544639,.838671,-.055052,-.791154,.609135,.413066,.24814,-.741835,.466352],[-.529919,.848048,-.078778,-.778378,.622833,.422856,.209843,-.738017,.482171],[-.515038,.857167,-.102104,-.764655,.6363,.431004,.171288,-.732801,.497894],[-.5,.866025,-.125,-.75,.649519,.4375,.132583,-.726184,.51349],[-.48481,.87462,-.147439,-.734431,.662474,.44234,.093837,-.718167,.528929],[-.469472,.882948,-.169395,-.717968,.67515,.445524,.05516,-.708753,.544183],[-.45399,.891007,-.190839,-.700629,.687531,.447059,.016662,-.69795,.55922],[-.438371,.898794,-.211746,-.682437,.699602,.446953,-.02155,-.685769,.574011],[-.422618,.906308,-.232091,-.663414,.711348,.445222,-.059368,-.672226,.588528],[-.406737,.913545,-.251848,-.643582,.722755,.441884,-.096684,-.657339,.602741],[-.390731,.920505,-.270994,-.622967,.733809,.436964,-.133395,-.64113,.616621],[-.374607,.927184,-.289505,-.601592,.744496,.430488,-.169397,-.623624,.630141],[-.358368,.93358,-.307359,-.579484,.754804,.422491,-.204589,-.604851,.643273],[-.34202,.939693,-.324533,-.55667,.76472,.413008,-.238872,-.584843,.65599],[-.325568,.945519,-.341008,-.533178,.774231,.402081,-.27215,-.563635,.668267],[-.309017,.951057,-.356763,-.509037,.783327,.389754,-.304329,-.541266,.680078],[-.292372,.956305,-.371778,-.484275,.791997,.376077,-.335319,-.517778,.691399],[-.275637,.961262,-.386036,-.458924,.800228,.361102,-.365034,-.493216,.702207],[-.258819,.965926,-.399519,-.433013,.808013,.344885,-.393389,-.467627,.712478],[-.241922,.970296,-.412211,-.406574,.81534,.327486,-.420306,-.441061,.722191],[-.224951,.97437,-.424096,-.379641,.822202,.308969,-.445709,-.413572,.731327],[-.207912,.978148,-.435159,-.352244,.828589,.289399,-.469527,-.385215,.739866],[-.190809,.981627,-.445388,-.324419,.834495,.268846,-.491693,-.356047,.74779],[-.173648,.984808,-.454769,-.296198,.839912,.247382,-.512145,-.326129,.755082],[-.156434,.987688,-.463292,-.267617,.844832,.225081,-.530827,-.295521,.761728],[-.139173,.990268,-.470946,-.238709,.849251,.20202,-.547684,-.264287,.767712],[-.121869,.992546,-.477722,-.209511,.853163,.178279,-.562672,-.232494,.773023],[-.104528,.994522,-.483611,-.180057,.856563,.153937,-.575747,-.200207,.777648],[-.087156,.996195,-.488606,-.150384,.859447,.129078,-.586872,-.167494,.781579],[-.069756,.997564,-.492701,-.120527,.861811,.103786,-.596018,-.134426,.784806],[-.052336,.99863,-.495891,-.090524,.863653,.078146,-.603158,-.101071,.787324],[-.034899,.999391,-.498173,-.060411,.864971,.052243,-.608272,-.0675,.789126],[-.017452,.999848,-.499543,-.030224,.865762,.026165,-.611347,-.033786,.790208],[0,1,-.5,0,.866025,-0,-.612372,0,.790569],[.017452,.999848,-.499543,.030224,.865762,-.026165,-.611347,.033786,.790208],[.034899,.999391,-.498173,.060411,.864971,-.052243,-.608272,.0675,.789126],[.052336,.99863,-.495891,.090524,.863653,-.078146,-.603158,.101071,.787324],[.069756,.997564,-.492701,.120527,.861811,-.103786,-.596018,.134426,.784806],[.087156,.996195,-.488606,.150384,.859447,-.129078,-.586872,.167494,.781579],[.104528,.994522,-.483611,.180057,.856563,-.153937,-.575747,.200207,.777648],[.121869,.992546,-.477722,.209511,.853163,-.178279,-.562672,.232494,.773023],[.139173,.990268,-.470946,.238709,.849251,-.20202,-.547684,.264287,.767712],[.156434,.987688,-.463292,.267617,.844832,-.225081,-.530827,.295521,.761728],[.173648,.984808,-.454769,.296198,.839912,-.247382,-.512145,.326129,.755082],[.190809,.981627,-.445388,.324419,.834495,-.268846,-.491693,.356047,.74779],[.207912,.978148,-.435159,.352244,.828589,-.289399,-.469527,.385215,.739866],[.224951,.97437,-.424096,.379641,.822202,-.308969,-.445709,.413572,.731327],[.241922,.970296,-.412211,.406574,.81534,-.327486,-.420306,.441061,.722191],[.258819,.965926,-.399519,.433013,.808013,-.344885,-.393389,.467627,.712478],[.275637,.961262,-.386036,.458924,.800228,-.361102,-.365034,.493216,.702207],[.292372,.956305,-.371778,.484275,.791997,-.376077,-.335319,.517778,.691399],[.309017,.951057,-.356763,.509037,.783327,-.389754,-.304329,.541266,.680078],[.325568,.945519,-.341008,.533178,.774231,-.402081,-.27215,.563635,.668267],[.34202,.939693,-.324533,.55667,.76472,-.413008,-.238872,.584843,.65599],[.358368,.93358,-.307359,.579484,.754804,-.422491,-.204589,.604851,.643273],[.374607,.927184,-.289505,.601592,.744496,-.430488,-.169397,.623624,.630141],[.390731,.920505,-.270994,.622967,.733809,-.436964,-.133395,.64113,.616621],[.406737,.913545,-.251848,.643582,.722755,-.441884,-.096684,.657339,.602741],[.422618,.906308,-.232091,.663414,.711348,-.445222,-.059368,.672226,.588528],[.438371,.898794,-.211746,.682437,.699602,-.446953,-.02155,.685769,.574011],[.45399,.891007,-.190839,.700629,.687531,-.447059,.016662,.69795,.55922],[.469472,.882948,-.169395,.717968,.67515,-.445524,.05516,.708753,.544183],[.48481,.87462,-.147439,.734431,.662474,-.44234,.093837,.718167,.528929],[.5,.866025,-.125,.75,.649519,-.4375,.132583,.726184,.51349],[.515038,.857167,-.102104,.764655,.6363,-.431004,.171288,.732801,.497894],[.529919,.848048,-.078778,.778378,.622833,-.422856,.209843,.738017,.482171],[.544639,.838671,-.055052,.791154,.609135,-.413066,.24814,.741835,.466352],[.559193,.829038,-.030955,.802965,.595222,-.401645,.286069,.744262,.450467],[.573576,.819152,-.006515,.813798,.581112,-.388612,.323524,.745308,.434544],[.587785,.809017,.018237,.823639,.566821,-.373991,.360397,.744989,.418613],[.601815,.798636,.043272,.832477,.552367,-.357807,.396584,.74332,.402704],[.615661,.788011,.068559,.840301,.537768,-.340093,.431982,.740324,.386845],[.62932,.777146,.094066,.847101,.523041,-.320884,.46649,.736025,.371063],[.642788,.766044,.119764,.852869,.508205,-.300221,.500009,.730451,.355387],[.656059,.75471,.14562,.857597,.493276,-.278147,.532443,.723633,.339844],[.669131,.743145,.171604,.861281,.478275,-.254712,.5637,.715605,.324459],[.681998,.731354,.197683,.863916,.463218,-.229967,.593688,.706405,.309259],[.694658,.71934,.223825,.865498,.448125,-.203969,.622322,.696073,.294267],[.707107,.707107,.25,.866025,.433013,-.176777,.649519,.684653,.279508],[.71934,.694658,.276175,.865498,.417901,-.148454,.675199,.67219,.265005],[.731354,.681998,.302317,.863916,.402807,-.119068,.699288,.658734,.250778],[.743145,.669131,.328396,.861281,.387751,-.088686,.721714,.644334,.23685],[.75471,.656059,.35438,.857597,.372749,-.057383,.742412,.629044,.223238],[.766044,.642788,.380236,.852869,.357821,-.025233,.761319,.612921,.209963],[.777146,.62932,.405934,.847101,.342984,.007686,.778379,.596021,.19704],[.788011,.615661,.431441,.840301,.328257,.041294,.793541,.578405,.184487],[.798636,.601815,.456728,.832477,.313658,.075508,.806757,.560132,.172317],[.809017,.587785,.481763,.823639,.299204,.110246,.817987,.541266,.160545],[.819152,.573576,.506515,.813798,.284914,.14542,.827194,.521871,.149181],[.829038,.559193,.530955,.802965,.270803,.180944,.834347,.502011,.138237],[.838671,.544639,.555052,.791154,.256891,.21673,.839422,.481753,.127722],[.848048,.529919,.578778,.778378,.243192,.252688,.842399,.461164,.117644],[.857167,.515038,.602104,.764655,.229726,.288728,.843265,.440311,.108009],[.866025,.5,.625,.75,.216506,.32476,.842012,.419263,.098821],[.87462,.48481,.647439,.734431,.203551,.360692,.838638,.398086,.090085],[.882948,.469472,.669395,.717968,.190875,.396436,.833145,.376851,.081803],[.891007,.45399,.690839,.700629,.178494,.431899,.825544,.355623,.073974],[.898794,.438371,.711746,.682437,.166423,.466993,.81585,.334472,.066599],[.906308,.422618,.732091,.663414,.154678,.501627,.804083,.313464,.059674],[.913545,.406737,.751848,.643582,.143271,.535715,.79027,.292666,.053196],[.920505,.390731,.770994,.622967,.132217,.569169,.774442,.272143,.04716],[.927184,.374607,.789505,.601592,.121529,.601904,.756637,.25196,.041559],[.93358,.358368,.807359,.579484,.111222,.633837,.736898,.23218,.036385],[.939693,.34202,.824533,.55667,.101306,.664885,.715274,.212865,.03163],[.945519,.325568,.841008,.533178,.091794,.694969,.691816,.194075,.027281],[.951057,.309017,.856763,.509037,.082698,.724012,.666583,.175868,.023329],[.956305,.292372,.871778,.484275,.074029,.75194,.639639,.158301,.019758],[.961262,.275637,.886036,.458924,.065797,.77868,.61105,.141427,.016556],[.965926,.258819,.899519,.433013,.058013,.804164,.580889,.1253,.013707],[.970296,.241922,.912211,.406574,.050685,.828326,.549233,.109969,.011193],[.97437,.224951,.924096,.379641,.043823,.851105,.516162,.095481,.008999],[.978148,.207912,.935159,.352244,.037436,.872441,.481759,.08188,.007105],[.981627,.190809,.945388,.324419,.03153,.892279,.446114,.069209,.005492],[.984808,.173648,.954769,.296198,.026114,.910569,.409317,.057505,.00414],[.987688,.156434,.963292,.267617,.021193,.927262,.371463,.046806,.003026],[.990268,.139173,.970946,.238709,.016774,.942316,.332649,.037143,.002131],[.992546,.121869,.977722,.209511,.012862,.955693,.292976,.028547,.001431],[.994522,.104528,.983611,.180057,.009462,.967356,.252544,.021043,903e-6],[.996195,.087156,.988606,.150384,.006578,.977277,.21146,.014654,523e-6],[.997564,.069756,.992701,.120527,.004214,.985429,.169828,.0094,268e-6],[.99863,.052336,.995891,.090524,.002372,.991791,.127757,.005297,113e-6],[.999391,.034899,.998173,.060411,.001055,.996348,.085356,.002357,34e-6],[.999848,.017452,.999543,.030224,264e-6,.999086,.042733,59e-5,4e-6],[1,-0,1,-0,0,1,-0,0,-0]]],pn=(fn[0].length,fn[1].length,fn[0][0].length/2),gn=[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1.003236,1.002156,.999152,.990038],[1.03237,1.021194,.990433,.898572],[1.062694,1.040231,.979161,.799806],[1.093999,1.058954,.964976,.693603],[1.126003,1.077006,.947526,.57989],[1.158345,1.093982,.926474,.45869],[1.19059,1.109437,.901512,.330158],[1.222228,1.12289,.87237,.194621],[1.252684,1.133837,.838839,.052614],[1.281987,1.142358,.801199,0],[1.312073,1.150207,.760839,0],[1.343011,1.157424,.717799,0],[1.374649,1.163859,.671999,0],[1.406809,1.169354,.623371,0],[1.439286,1.173739,.571868,0],[1.471846,1.176837,.517465,0],[1.504226,1.178465,.460174,0],[1.536133,1.178438,.400043,0],[1.567253,1.176573,.337165,0],[1.597247,1.172695,.271688,0],[1.625766,1.166645,.203815,0],[1.652455,1.158285,.133806,0],[1.676966,1.147506,.061983,0],[1.699006,1.134261,0,0],[1.720224,1.119789,0,0],[1.741631,1.10481,0,0],[1.763183,1.08933,0,0],[1.784837,1.073356,0,0],[1.806548,1.056898,0,0],[1.828269,1.039968,0,0],[1.849952,1.02258,0,0],[1.871552,1.004752,0,0],[1.893018,.986504,0,0],[1.914305,.967857,0,0],[1.935366,.948837,0,0],[1.956154,.929471,0,0],[1.976625,.90979,0,0],[1.996736,.889823,0,0],[2.016448,.869607,0,0],[2.035721,.849175,0,0],[2.054522,.828565,0,0],[2.072818,.807816,0,0],[2.090581,.786964,0,0],[2.107785,.766051,0,0],[2.124411,.745115,0,0],[2.140439,.724196,0,0],[2.155856,.703332,0,0],[2.170653,.682561,0,0],[2.184823,.661921,0,0],[2.198364,.641445,0,0],[2.211275,.621169,0,0],[2.223562,.601125,0,0],[2.23523,.581341,0,0],[2.246289,.561847,0,0],[2.256751,.542667,0,0],[2.266631,.523826,0,0],[2.275943,.505344,0,0],[2.284707,.487239,0,0],[2.292939,.469528,0,0],[2.300661,.452225,0,0],[2.307892,.435342,0,0],[2.314654,.418888,0,0],[2.320969,.40287,0,0],[2.326858,.387294,0,0],[2.332343,.372164,0,0],[2.337445,.357481,0,0],[2.342186,.343246,0,0],[2.346585,.329458,0,0],[2.350664,.316113,0,0],[2.354442,.303208,0,0],[2.357937,.290738,0,0],[2.361168,.278698,0,0],[2.364152,.26708,0,0],[2.366906,.255878,0,0],[2.369446,.245082,0,0],[2.371786,.234685,0,0],[2.37394,.224677,0,0],[2.375923,.215048,0,0],[2.377745,.20579,0,0],[2.379421,.196891,0,0],[2.380959,.188342,0,0],[2.382372,.180132,0,0],[2.383667,.172251,0,0],[2.384856,.164689,0,0],[2.385945,.157435,0,0],[2.386943,.150479,0,0],[2.387857,.143811,0,0],[2.388694,.137421,0,0],[2.38946,.131299,0,0],[2.39016,.125435,0,0],[2.390801,.11982,0,0],[2.391386,.114445,0,0],[2.391921,.1093,0,0],[2.39241,.104376,0,0],[2.392857,.099666,0,0],[2.393265,.09516,0,0],[2.393637,.090851,0,0],[2.393977,.086731,0,0],[2.394288,.082791,0,0],[2.394571,.079025,0,0],[2.394829,.075426,0,0],[2.395064,.071986,0,0],[2.395279,.068699,0,0],[2.395475,.065558,0,0],[2.395653,.062558,0,0],[2.395816,.059693,0,0],[2.395964,.056955,0,0],[2.396099,.054341,0,0],[2.396222,.051845,0,0],[2.396334,.049462,0,0],[2.396436,.047186,0,0],[2.396529,.045013,0,0],[2.396613,.042939,0,0],[2.396691,.040959,0,0],[2.396761,.039069,0,0],[2.396825,.037266,0,0],[2.396883,.035544,0,0],[2.396936,.033901,0,0],[2.396984,.032334,0,0],[2.397028,.030838,0,0],[2.397068,.02941,0,0],[2.397104,.028048,0,0],[2.397137,.026749,0,0],[2.397167,.025509,0,0],[2.397194,.024326,0,0],[2.397219,.023198,0,0],[2.397242,.022122,0,0],[2.397262,.021095,0,0],[2.397281,.020116,0,0],[2.397298,.019181,0,0],[2.397314,.01829,0,0],[2.397328,.017441,0,0],[2.397341,.01663,0,0],[2.397352,.015857,0,0],[2.397363,.015119,0,0],[2.397372,.014416,0,0],[2.397381,.013745,0,0],[2.397389,.013106,0,0],[2.397396,.012496,0,0],[2.397403,.011914,0,0],[2.397409,.01136,0,0],[2.397414,.010831,0,0],[2.397419,.010326,0,0],[2.397424,.009845,0,0],[2.397428,.009387,0,0],[2.397432,.008949,0,0],[2.397435,.008532,0,0],[2.397438,.008135,0,0],[2.397441,.007755,0,0],[2.397443,.007394,0,0],[2.397446,.007049,0,0],[2.397448,.006721,0,0],[2.39745,.006407,0,0],[2.397451,.006108,0,0],[2.397453,.005824,0,0],[2.397454,.005552,0,0],[2.397456,.005293,0,0],[2.397457,.005046,0,0],[2.397458,.004811,0,0],[2.397459,.004586,0,0],[2.39746,.004372,0,0],[2.397461,.004168,0,0],[2.397461,.003974,0,0],[2.397462,.003788,0,0],[2.397463,.003611,0,0],[2.397463,.003443,0,0],[2.397464,.003282,0,0],[2.397464,.003129,0,0],[2.397465,.002983,0,0],[2.397465,.002844,0,0],[2.397465,.002711,0,0],[2.397466,.002584,0,0],[2.397466,.002464,0,0],[2.397466,.002349,0,0],[2.397466,.002239,0,0],[2.397467,.002135,0,0],[2.397467,.002035,0,0],[2.397467,.00194,0,0],[2.397467,.001849,0,0],[2.397467,.001763,0,0],[2.397467,.001681,0,0],[2.397468,.001602,0,0],[2.397468,.001527,0,0],[2.397468,.001456,0,0],[2.397468,.001388,0,0],[2.397468,.001323,0,0],[2.397468,.001261,0,0],[2.397468,.001202,0,0],[2.397468,.001146,0,0],[2.397468,.001093,0,0],[2.397468,.001042,0,0],[2.397468,993e-6,0,0],[2.397468,947e-6,0,0],[2.397468,902e-6,0,0],[2.397468,86e-5,0,0],[2.397468,82e-5,0,0],[2.397469,782e-6,0,0],[2.397469,745e-6,0,0],[2.397469,71e-5,0,0],[2.397469,677e-6,0,0],[2.397469,646e-6,0,0],[2.397469,616e-6,0,0],[2.397469,587e-6,0,0],[2.397469,559e-6,0,0],[2.397469,533e-6,0,0],[2.397469,508e-6,0,0],[2.397469,485e-6,0,0],[2.397469,462e-6,0,0],[2.397469,44e-5,0,0],[2.397469,42e-5,0,0],[2.397469,4e-4,0,0],[2.397469,381e-6,0,0],[2.397469,364e-6,0,0],[2.397469,347e-6,0,0],[2.397469,33e-5,0,0],[2.397469,315e-6,0,0],[2.397469,3e-4,0,0],[2.397469,286e-6,0,0],[2.397469,273e-6,0,0],[2.397469,26e-5,0,0],[2.397469,248e-6,0,0],[2.397469,236e-6,0,0],[2.397469,225e-6,0,0],[2.397469,215e-6,0,0],[2.397469,205e-6,0,0],[2.397469,195e-6,0,0],[2.397469,186e-6,0,0],[2.397469,177e-6,0,0],[2.397469,169e-6,0,0],[2.397469,161e-6,0,0],[2.397469,154e-6,0,0],[2.397469,147e-6,0,0],[2.397469,14e-5,0,0],[2.397469,133e-6,0,0],[2.397469,127e-6,0,0],[2.397469,121e-6,0,0],[2.397469,115e-6,0,0],[2.397469,11e-5,0,0],[2.397469,105e-6,0,0],[2.397469,1e-4,0,0],[2.397469,95e-6,0,0],[2.397469,91e-6,0,0],[2.397469,87e-6,0,0],[2.397469,83e-6,0,0],[2.397469,79e-6,0,0],[2.397469,75e-6,0,0],[2.397469,71e-6,0,0],[2.397469,68e-6,0,0],[2.397469,65e-6,0,0],[2.397469,62e-6,0,0],[2.397469,59e-6,0,0],[2.397469,56e-6,0,0],[2.397469,54e-6,0,0],[2.397469,51e-6,0,0],[2.397469,49e-6,0,0],[2.397469,46e-6,0,0],[2.397469,44e-6,0,0],[2.397469,42e-6,0,0],[2.397469,4e-5,0,0],[2.397469,38e-6,0,0],[2.397469,37e-6,0,0],[2.397469,35e-6,0,0],[2.397469,33e-6,0,0],[2.397469,32e-6,0,0],[2.397469,3e-5,0,0],[2.397469,29e-6,0,0],[2.397469,27e-6,0,0],[2.397469,26e-6,0,0],[2.397469,25e-6,0,0],[2.397469,24e-6,0,0],[2.397469,23e-6,0,0],[2.397469,22e-6,0,0],[2.397469,21e-6,0,0],[2.397469,2e-5,0,0],[2.397469,19e-6,0,0],[2.397469,18e-6,0,0],[2.397469,17e-6,0,0],[2.397469,16e-6,0,0],[2.397469,15e-6,0,0],[2.397469,15e-6,0,0],[2.397469,14e-6,0,0],[2.397469,13e-6,0,0],[2.397469,13e-6,0,0],[2.397469,12e-6,0,0],[2.397469,12e-6,0,0],[2.397469,11e-6,0,0],[2.397469,11e-6,0,0],[2.397469,1e-5,0,0],[2.397469,1e-5,0,0],[2.397469,9e-6,0,0],[2.397469,9e-6,0,0],[2.397469,8e-6,0,0],[2.397469,8e-6,0,0],[2.397469,8e-6,0,0],[2.397469,7e-6,0,0],[2.397469,7e-6,0,0],[2.397469,7e-6,0,0],[2.397469,6e-6,0,0],[2.397469,6e-6,0,0],[2.397469,6e-6,0,0],[2.397469,5e-6,0,0],[2.397469,5e-6,0,0],[2.397469,5e-6,0,0],[2.397469,5e-6,0,0],[2.397469,4e-6,0,0],[2.397469,4e-6,0,0],[2.397469,4e-6,0,0],[2.397469,4e-6,0,0],[2.397469,4e-6,0,0],[2.397469,4e-6,0,0],[2.397469,3e-6,0,0],[2.397469,3e-6,0,0],[2.397469,3e-6,0,0],[2.397469,3e-6,0,0],[2.397469,3e-6,0,0],[2.397469,3e-6,0,0],[2.397469,3e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,2e-6,0,0],[2.397469,1e-6,0,0],[2.397469,1e-6,0,0],[2.397469,1e-6,0,0]];var vn,wn,mn;!function(t){t.Logarithmic="logarithmic",t.Linear="linear",t.None="none"}(vn||(vn={})),function(t){t.Width="width",t.Height="height",t.Depth="depth"}(wn||(wn={})),function(t){t.Left="left",t.Right="right",t.Front="front",t.Back="back",t.Down="down",t.Up="up"}(mn||(mn={}));const Dn=((yn=Je())[0]=0,yn[1]=0,yn[2]=0,yn);var yn;const bn=Ke(Je(),0,0,-1),Pn=Ke(Je(),0,1,0),Cn=(Ke(Je(),1,0,0),343),En=vn.Logarithmic,In="ambisonic",Bn={[mn.Left]:0,[mn.Right]:0,[mn.Front]:0,[mn.Back]:0,[mn.Down]:0,[mn.Up]:0},_n={[wn.Width]:0,[wn.Height]:0,[wn.Depth]:0},Mn=[31.25,62.5,125,250,500,1e3,2e3,4e3,8e3],xn=Mn.length,Sn=new Float32Array(xn);var On;!function(t){t.Transparent="transparent",t.AcousticCeilingTiles="acoustic-ceiling-tiles",t.BrickBare="brick-bare",t.BrickPainted="brick-painted",t.ConcreteBlockCoarse="concrete-block-coarse",t.ConcreteBlockPainted="concrete-block-painted",t.CurtainHeavy="curtain-heavy",t.FiberGlassInsulation="fiber-glass-insulation",t.GlassThin="glass-thin",t.GlassThick="glass-thick",t.Grass="grass",t.LinoleumOnConcrete="linoleum-on-concrete",t.Marble="marble",t.Metal="metal",t.ParquetOnConcrete="parquet-on-concrete",t.PlasterRough="plaster-rough",t.PlasterSmooth="plaster-smooth",t.PlywoodPanel="plywood-panel",t.PolishedConcreteOrTile="polished-concrete-or-tile",t.Sheetrock="sheetrock",t.WaterOrIceSurface="water-or-ice-surface",t.WoodCeiling="wood-ceiling",t.WoodPanel="wood-panel",t.Uniform="uniform"}(On||(On={}));const Qn={[On.Transparent]:[1,1,1,1,1,1,1,1,1],[On.AcousticCeilingTiles]:[.672,.675,.7,.66,.72,.92,.88,.75,1],[On.BrickBare]:[.03,.03,.03,.03,.03,.04,.05,.07,.14],[On.BrickPainted]:[.006,.007,.01,.01,.02,.02,.02,.03,.06],[On.ConcreteBlockCoarse]:[.36,.36,.36,.44,.31,.29,.39,.25,.5],[On.ConcreteBlockPainted]:[.092,.09,.1,.05,.06,.07,.09,.08,.16],[On.CurtainHeavy]:[.073,.106,.14,.35,.55,.72,.7,.65,1],[On.FiberGlassInsulation]:[.193,.22,.22,.82,.99,.99,.99,.99,1],[On.GlassThin]:[.18,.169,.18,.06,.04,.03,.02,.02,.04],[On.GlassThick]:[.35,.35,.35,.25,.18,.12,.07,.04,.08],[On.Grass]:[.05,.05,.15,.25,.4,.55,.6,.6,.6],[On.LinoleumOnConcrete]:[.02,.02,.02,.03,.03,.03,.03,.02,.04],[On.Marble]:[.01,.01,.01,.01,.01,.01,.02,.02,.04],[On.Metal]:[.03,.035,.04,.04,.05,.05,.05,.07,.09],[On.ParquetOnConcrete]:[.028,.03,.04,.04,.07,.06,.06,.07,.14],[On.PlasterRough]:[.017,.018,.02,.03,.04,.05,.04,.03,.06],[On.PlasterSmooth]:[.011,.012,.013,.015,.02,.03,.04,.05,.1],[On.PlywoodPanel]:[.4,.34,.28,.22,.17,.09,.1,.11,.22],[On.PolishedConcreteOrTile]:[.008,.008,.01,.01,.015,.02,.02,.02,.04],[On.Sheetrock]:[.29,.279,.29,.1,.05,.04,.07,.09,.18],[On.WaterOrIceSurface]:[.006,.006,.008,.008,.013,.015,.02,.025,.05],[On.WoodCeiling]:[.15,.147,.15,.11,.1,.07,.06,.07,.14],[On.WoodPanel]:[.28,.28,.28,.22,.17,.09,.1,.11,.22],[On.Uniform]:[.5,.5,.5,.5,.5,.5,.5,.5,.5]},kn={[mn.Left]:On.Transparent,[mn.Right]:On.Transparent,[mn.Front]:On.Transparent,[mn.Back]:On.Transparent,[mn.Down]:On.Transparent,[mn.Up]:On.Transparent},Tn=[6e-4,6e-4,7e-4,8e-4,.001,.0015,.0026,.006,.0207],Ln=6.28318530717959,Rn=57.29577951308232,Un=1e-8,jn=function(...t){window.console.log.apply(window.console,["%c[ResonanceAudio]%c "+t.join(" ")+" %c(@"+performance.now().toFixed(2)+"ms)","background: #BBDEFB; color: #FF5722; font-weight: 700","font-weight: 400","color: #AAA"])},Fn={[mn.Left]:wn.Width,[mn.Right]:wn.Width,[mn.Front]:wn.Depth,[mn.Back]:wn.Depth,[mn.Up]:wn.Height,[mn.Down]:wn.Height},Nn={[mn.Left]:0,[mn.Right]:0,[mn.Front]:2,[mn.Back]:2,[mn.Up]:1,[mn.Down]:1},Hn={[mn.Left]:1,[mn.Right]:-1,[mn.Front]:1,[mn.Back]:-1,[mn.Up]:-1,[mn.Down]:1};class zn{constructor(t,e){this.channelGain=new Array,this.merger=null,e=Object.assign({ambisonicOrder:1,azimuth:0,elevation:0,sourceWidth:0},e),this.context=t,this.input=t.createGain(),this.output=t.createGain(),this.setAmbisonicOrder(e.ambisonicOrder),this.azimuth=e.azimuth,this.elevation=e.elevation,this.setSourceWidth(e.sourceWidth)}static validateAmbisonicOrder(t){return isNaN(t)||null==t?(jn("Error: Invalid ambisonic order",t,"\nUsing ambisonicOrder=1 instead."),t=1):t<1?(jn("Error: Unable to render ambisonic order",t,"(Min order is 1)","\nUsing min order instead."),t=1):t>pn&&(jn("Error: Unable to render ambisonic order",t,"(Max order is",pn,")\nUsing max order instead."),t=pn),t}setAmbisonicOrder(t){this.ambisonicOrder=zn.validateAmbisonicOrder(t),this.input.disconnect();for(let t=0;t<this.channelGain.length;t++)this.channelGain[t].disconnect();null!=this.merger&&this.merger.disconnect();let e=(this.ambisonicOrder+1)*(this.ambisonicOrder+1);this.merger=this.context.createChannelMerger(e),this.channelGain=new Array(e);for(let t=0;t<e;t++)this.channelGain[t]=this.context.createGain(),this.input.connect(this.channelGain[t]),this.channelGain[t].connect(this.merger,0,t);this.merger.connect(this.output)}dispose(){this.merger.disconnect(this.output);let t=(this.ambisonicOrder+1)*(this.ambisonicOrder+1);for(let e=0;e<t;++e)this.channelGain[e].disconnect(this.merger,0,e),this.input.disconnect(this.channelGain[e])}setDirection(t,e){(null==t||isNaN(t))&&(t=0),(null==e||isNaN(e))&&(e=0),this.azimuth=t,this.elevation=e,(t=Math.round(t%360))<0&&(t+=360),e=Math.round(Math.min(90,Math.max(-90,e)))+90,this.channelGain[0].gain.value=gn[this.spreadIndex][0];for(let n=1;n<=this.ambisonicOrder;n++){let i=gn[this.spreadIndex][n];for(let s=-n;s<=n;s++){const r=n*n+n+s,o=n*(n+1)/2+Math.abs(s)-1;let a=fn[1][e][o];if(0!=s){let e=pn+s-1;s<0&&(e=pn+s),a*=fn[0][t][e]}this.channelGain[r].gain.value=a*i}}}setSourceWidth(t){this.spreadIndex=Math.min(359,Math.max(0,Math.round(t))),this.setDirection(this.azimuth,this.elevation)}}function Gn(...t){const e=`[Omnitone] ${t.join(" ")}`;window.console.log(e)}var Xn;!function(t){t.BASE64="base64",t.URL="url"}(Xn||(Xn={}));class Yn{constructor(t,e,n){this._context=t,this._options=Object.assign({},{dataType:Xn.BASE64,verbose:!1},n),this._bufferData=this._options.dataType===Xn.BASE64?e:e.slice(0)}async load(){try{const t=this._bufferData.map((async t=>{try{return await this._launchAsyncLoadTask(t)}catch(e){const n='BufferList: error while loading "'+t+'". ('+e.message+")";throw new Error(n)}}));return await Promise.all(t)}catch(t){const e='BufferList: error while loading ". ('+t.message+")";throw new Error(e)}}async _launchAsyncLoadTask(t){const e=await this._fetch(t);return await this._context.decodeAudioData(e)}async _fetch(t){if(this._options.dataType===Xn.BASE64)return function(t){const e=window.atob(t),n=new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=e.charCodeAt(t);return n.buffer}(t);{const e=await fetch(t);return await e.arrayBuffer()}}}class Wn{constructor(t,e){this._context=t,this._active=!1,this._isBufferLoaded=!1,this._buildAudioGraph(),e&&this.setHRIRBufferList(e),this.enable()}_buildAudioGraph(){this._splitterWYZX=this._context.createChannelSplitter(4),this._mergerWY=this._context.createChannelMerger(2),this._mergerZX=this._context.createChannelMerger(2),this._convolverWY=this._context.createConvolver(),this._convolverZX=this._context.createConvolver(),this._splitterWY=this._context.createChannelSplitter(2),this._splitterZX=this._context.createChannelSplitter(2),this._inverter=this._context.createGain(),this._mergerBinaural=this._context.createChannelMerger(2),this._summingBus=this._context.createGain(),this._splitterWYZX.connect(this._mergerWY,0,0),this._splitterWYZX.connect(this._mergerWY,1,1),this._splitterWYZX.connect(this._mergerZX,2,0),this._splitterWYZX.connect(this._mergerZX,3,1),this._mergerWY.connect(this._convolverWY),this._mergerZX.connect(this._convolverZX),this._convolverWY.connect(this._splitterWY),this._convolverZX.connect(this._splitterZX),this._splitterWY.connect(this._mergerBinaural,0,0),this._splitterWY.connect(this._mergerBinaural,0,1),this._splitterWY.connect(this._mergerBinaural,1,0),this._splitterWY.connect(this._inverter,1,0),this._inverter.connect(this._mergerBinaural,0,1),this._splitterZX.connect(this._mergerBinaural,0,0),this._splitterZX.connect(this._mergerBinaural,0,1),this._splitterZX.connect(this._mergerBinaural,1,0),this._splitterZX.connect(this._mergerBinaural,1,1),this._convolverWY.normalize=!1,this._convolverZX.normalize=!1,this._inverter.gain.value=-1,this.input=this._splitterWYZX,this.output=this._summingBus}dispose(){this._active&&this.disable(),this._splitterWYZX.disconnect(this._mergerWY,0,0),this._splitterWYZX.disconnect(this._mergerWY,1,1),this._splitterWYZX.disconnect(this._mergerZX,2,0),this._splitterWYZX.disconnect(this._mergerZX,3,1),this._mergerWY.disconnect(this._convolverWY),this._mergerZX.disconnect(this._convolverZX),this._convolverWY.disconnect(this._splitterWY),this._convolverZX.disconnect(this._splitterZX),this._splitterWY.disconnect(this._mergerBinaural,0,0),this._splitterWY.disconnect(this._mergerBinaural,0,1),this._splitterWY.disconnect(this._mergerBinaural,1,0),this._splitterWY.disconnect(this._inverter,1,0),this._inverter.disconnect(this._mergerBinaural,0,1),this._splitterZX.disconnect(this._mergerBinaural,0,0),this._splitterZX.disconnect(this._mergerBinaural,0,1),this._splitterZX.disconnect(this._mergerBinaural,1,0),this._splitterZX.disconnect(this._mergerBinaural,1,1)}setHRIRBufferList(t){this._isBufferLoaded||(this._convolverWY.buffer=t[0],this._convolverZX.buffer=t[1],this._isBufferLoaded=!0)}enable(){this._mergerBinaural.connect(this._summingBus),this._active=!0}disable(){this._mergerBinaural.disconnect(),this._active=!1}}class Zn{constructor(t){this._context=t,this._splitter=this._context.createChannelSplitter(4),this._inX=this._context.createGain(),this._inY=this._context.createGain(),this._inZ=this._context.createGain(),this._m0=this._context.createGain(),this._m1=this._context.createGain(),this._m2=this._context.createGain(),this._m3=this._context.createGain(),this._m4=this._context.createGain(),this._m5=this._context.createGain(),this._m6=this._context.createGain(),this._m7=this._context.createGain(),this._m8=this._context.createGain(),this._outX=this._context.createGain(),this._outY=this._context.createGain(),this._outZ=this._context.createGain(),this._merger=this._context.createChannelMerger(4),this._splitter.connect(this._inX,1),this._splitter.connect(this._inY,2),this._splitter.connect(this._inZ,3),this._inX.gain.value=-1,this._inY.gain.value=-1,this._inZ.gain.value=-1,this._inX.connect(this._m0),this._inX.connect(this._m1),this._inX.connect(this._m2),this._inY.connect(this._m3),this._inY.connect(this._m4),this._inY.connect(this._m5),this._inZ.connect(this._m6),this._inZ.connect(this._m7),this._inZ.connect(this._m8),this._m0.connect(this._outX),this._m1.connect(this._outY),this._m2.connect(this._outZ),this._m3.connect(this._outX),this._m4.connect(this._outY),this._m5.connect(this._outZ),this._m6.connect(this._outX),this._m7.connect(this._outY),this._m8.connect(this._outZ),this._splitter.connect(this._merger,0,0),this._outX.connect(this._merger,0,1),this._outY.connect(this._merger,0,2),this._outZ.connect(this._merger,0,3),this._outX.gain.value=-1,this._outY.gain.value=-1,this._outZ.gain.value=-1,this.setRotationMatrix3(Ye(Ge())),this.input=this._splitter,this.output=this._merger}dispose(){this._splitter.disconnect(this._inX,1),this._splitter.disconnect(this._inY,2),this._splitter.disconnect(this._inZ,3),this._inX.disconnect(this._m0),this._inX.disconnect(this._m1),this._inX.disconnect(this._m2),this._inY.disconnect(this._m3),this._inY.disconnect(this._m4),this._inY.disconnect(this._m5),this._inZ.disconnect(this._m6),this._inZ.disconnect(this._m7),this._inZ.disconnect(this._m8),this._m0.disconnect(this._outX),this._m1.disconnect(this._outY),this._m2.disconnect(this._outZ),this._m3.disconnect(this._outX),this._m4.disconnect(this._outY),this._m5.disconnect(this._outZ),this._m6.disconnect(this._outX),this._m7.disconnect(this._outY),this._m8.disconnect(this._outZ),this._splitter.disconnect(this._merger,0,0),this._outX.disconnect(this._merger,0,1),this._outY.disconnect(this._merger,0,2),this._outZ.disconnect(this._merger,0,3)}setRotationMatrix3(t){this._m0.gain.value=t[0],this._m1.gain.value=t[1],this._m2.gain.value=t[2],this._m3.gain.value=t[3],this._m4.gain.value=t[4],this._m5.gain.value=t[5],this._m6.gain.value=t[6],this._m7.gain.value=t[7],this._m8.gain.value=t[8]}setRotationMatrix4(t){this._m0.gain.value=t[0],this._m1.gain.value=t[1],this._m2.gain.value=t[2],this._m3.gain.value=t[4],this._m4.gain.value=t[5],this._m5.gain.value=t[6],this._m6.gain.value=t[8],this._m7.gain.value=t[9],this._m8.gain.value=t[10]}getRotationMatrix3(){return Xe(Jn,this._m0.gain.value,this._m1.gain.value,this._m2.gain.value,this._m3.gain.value,this._m4.gain.value,this._m5.gain.value,this._m6.gain.value,this._m7.gain.value,this._m8.gain.value),Jn}getRotationMatrix4(){return Ze(Vn,this._m0.gain.value,this._m1.gain.value,this._m2.gain.value,0,this._m3.gain.value,this._m4.gain.value,this._m5.gain.value,0,this._m6.gain.value,this._m7.gain.value,this._m8.gain.value,0,0,0,0,1),Vn}}const Jn=Ge(),Vn=We();var qn;!function(t){t[t.Default=0]="Default",t[t.Safari=1]="Safari",t[t.FUMA=2]="FUMA"}(qn||(qn={}));const Kn={[qn.Default]:[0,1,2,3],[qn.Safari]:[2,0,1,3],[qn.FUMA]:[0,3,1,2]};class $n{constructor(t,e){this._context=t,this._splitter=this._context.createChannelSplitter(4),this._merger=this._context.createChannelMerger(4),this.input=this._splitter,this.output=this._merger,this.setChannelMap(e||qn.Default)}setChannelMap(t){this._channelMap=t instanceof Array?t:Kn[t],this._splitter.disconnect(),this._splitter.connect(this._merger,0,this._channelMap[0]),this._splitter.connect(this._merger,1,this._channelMap[1]),this._splitter.connect(this._merger,2,this._channelMap[2]),this._splitter.connect(this._merger,3,this._channelMap[3])}dispose(){this._splitter.disconnect(this._merger,0,this._channelMap[0]),this._splitter.disconnect(this._merger,1,this._channelMap[1]),this._splitter.disconnect(this._merger,2,this._channelMap[2]),this._splitter.disconnect(this._merger,3,this._channelMap[3])}}var ti=["UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD+/wIA9v8QAPv/CwD+/wcA/v8MAP//AQD7/wEACAAEAPj/+v8YABAA7v/n//v/9P/M/8D//f34/R38EvzxAfEBtA2lDTcBJQFJ9T71FP0D/cD1tfVo/Wv9uPTO9PPmOufc/U/+agL3Aisc/RxuGKEZBv3j/iYMzQ2gAzsEQQUABiQFrASzA5cB2QmyCy0AtgR4AeYGtfgAA2j5OQHP+scArPsMBJgEggIEBtz6+QVq/pj/aPg8BPP3gQEi+jEAof0fA1v9+/7S+8IBjvwd/xD4IADL/Pf9zvs+/l3+wgB7/+L+7fzFADH9kf6A+n3+DP6+/TP9xP68/pn+w/26/i39YgA0/u790Pt9/kD+7v1s/Wb+8f4C/1P+pf/x/cT+6/3p/Xz9ff5F/0f9G/4r/6v/4P5L/sL+ff7c/pj+Ov7X/UT+9P5G/oz+6v6A/2D+9/6P/8r/bP7m/ij+C//e/tj/Gf4e/9v+FwDP/lz/sP7F/2H+rv/G/s7/Hf7y/4P+NAD9/k0AK/6w/zP/hACh/sX/gf44AOP+dgCm/iUAk/5qAOD+PwC+/jEAWP4CAAr/bQBw/vv/zf5iACD/OgCS/uD/Cv9oAAb/CgDK/kwA//5tACH/TgCg/h4AHP9aABP/JADP/hEAYv9gAAj/3f8m/ysAYv8gACX/8/8k/ysAXv8bABH//v8j/ygAa/8qAAD/9f9g/1YAWf8JACH/AgB2/z4AXP/w/z3/FgB2/ykAX//9/z//EwCV/zUAS//n/1T/GACK/x4ATv/0/4P/QQB4//v/WP/2/3X/HAB8//P/V//3/2f/AQBh/9v/Tf/x/5P/IwCI/wMAf/8hAKP/JACZ/xUAiv8nAK//HgCr/yMAm/8uAMz/OACi/yQAqf87AMT/MwCY/yUAtP9FAMH/KgCu/ycAyP85AMv/IwCz/xoA1f8qAMn/FgC8/xQA4/8nAMX/CwDJ/xQA4f8ZAMH/BgDO/xQA4f8WAMP/BwDU/xQA4P8QAMH/AQDb/xQA3P8JAMP/AgDh/xIA2v8EAMj/AgDk/w0A1f/+/8v/AwDm/wwA0v/+/9H/BgDl/wkAzv/8/9T/BwDk/wcAzv/8/9r/CQDi/wQAzf/8/9//CADf////0P/9/+L/BwDd//7/0////+T/BgDb//z/1f8AAOf/BQDZ//v/2v8CAOb/AwDY//v/3v8EAOb/AgDY//3/4f8FAOX/AQDZ//7/5P8GAOP/AADb/wAA5/8GAOH////d/wIA5/8FAOD////f/wMA6P8FAOD////h/wQA6P8EAN7////h/wUA4v8DANv/AQDd/wQA3P8CANn/AgDb/wMA2/8CANv/AgDd/wIA3v8CAOH/AQDj/wEA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAAAA/f8CAP//AQD//wEA//8BAP3/AAACAP7/+f8AAAIA/P8FAAQA8/8AABoA+f/V/wQAHQDO/xoAQQBO/ocA0Px1/ucHW/4UCm8HLO6kAjv8/fCRDdAAYfPiBIgFXveUCM0GBvh6/nz7rf0J/QcQSRVdBgoBSgFR62r9NP8m+LoEAvriBVAAiAPmABEGMf2l+SwBjva6/G4A//8P/CYDMgXm/R0CKAE6/fcBBwAtAND+kQA0A5UDhwFs/8IB8fydAEP/A/8v/e7/mP8j/2YBIwE3Av0AYv+uAOD8lgAg/wwAIf/L/n0Ae//OAJMB3P/XAF//XwCM/08AB/8NAEf/rf4jAT3/lgAJAP4AHgDpAO8AUf9L/07/Qf8KAOD/x/+D/3sATQCDAMoA0f79/+L/EQDt/7EAqv+S/7IAuv/o/wgAc//X//H/SwCm/+3/Yf/B/yoAAADI/7X/AwBg/5EATgCX/xYA/P+q/00AVACY/6v/BADD/zwALQCN/8z/KQDu/ygAEgCZ/6f/VQDC//T/KQCs/7P/UgAfAO7/NgC8/57/awAZAPP/+P/V/8z/bQBBAL//DgD0/+T/TABBAMz/CwAxAPz/SQBqALn/BgALAPz/EAA7AIz/3/8iAAUA//8kALf/y/9VABQA+v81AOj/0P9cAB4A+f8WAOr/vv83ABgAw/8JAOj/4f8nACIAsf/y/w4A3v8gACQAxP/n/ycA7P8WAC0Ayf/U/ycA9v/7/yUA0P/P/zUABADc/xUA5P/J/zcACwDS/xUA9P/m/zAACQDX/+3/9v/2/yQACgDZ/+P/AwAKABYA///b/9j/EQALABkADgD6/+7/GwD4/w4A8P/w//j/EgAEAAUA9f/1/wQAGgD4/wAA5////wAAGQD1////7f8FAAUAFQDv/wAA6v8LAAcAFQDs/wEA9P8SAAYACwDr//7/AQASAAYABQDv/wIAAwAWAAIAAgDv/wAABgATAAEA/f/u/wQABgAQAPr/+P/z/wUACQALAPj/9//4/wgABwAKAPT/+f/5/w4ABwAIAPT/+//9/w4AAwADAPH//f///w8A//8BAPP///8BAA0A/f/+//X/AgACAA0A+//8//b/BAADAAoA+f/7//n/BgADAAcA+P/7//v/BwABAAQA+P/8//3/CQABAAIA9//9////CQD/////+P///wAACAD9//7/+f8AAAAABwD8//3/+v8CAAAABgD7//z//P8EAAAABAD6//3//P8FAP//AgD6//7//v8FAP7/AQD7//////8GAP7/AAD7/wEA//8EAP3/AAD9/wEA/v8DAP3/AAD9/wIA/v8CAP3/AQD9/wIA/v8CAP7/AQD+/wEA"];class ei{constructor(t,e){if(this.context=t,this.config=Object.assign({channelMap:qn.Default,renderingMode:dn.Ambisonic},e),this.config.channelMap instanceof Array&&4!==this.config.channelMap.length)throw new Error("FOARenderer: Invalid channel map. (got "+this.config.channelMap+")");if(this.config.hrirPathList&&2!==this.config.hrirPathList.length)throw new Error("FOARenderer: Invalid HRIR URLs. It must be an array with 2 URLs to HRIR files. (got "+this.config.hrirPathList+")");this.buildAudioGraph()}buildAudioGraph(){this.input=this.context.createGain(),this.output=this.context.createGain(),this.bypass=this.context.createGain(),this.router=new $n(this.context,this.config.channelMap),this.rotator=new Zn(this.context),this.convolver=new Wn(this.context),this.input.connect(this.router.input),this.input.connect(this.bypass),this.router.output.connect(this.rotator.input),this.rotator.output.connect(this.convolver.input),this.convolver.output.connect(this.output),this.input.channelCount=4,this.input.channelCountMode="explicit",this.input.channelInterpretation="discrete"}dispose(){this.getRenderingMode()===dn.Bypass&&this.bypass.connect(this.output),this.input.disconnect(this.router.input),this.input.disconnect(this.bypass),this.router.output.disconnect(this.rotator.input),this.rotator.output.disconnect(this.convolver.input),this.convolver.output.disconnect(this.output),this.convolver.dispose(),this.rotator.dispose(),this.router.dispose()}async initialize(){const t=this.config.hrirPathList?new Yn(this.context,this.config.hrirPathList,{dataType:Xn.URL}):new Yn(this.context,ti,{dataType:Xn.BASE64});try{const e=await t.load();this.convolver.setHRIRBufferList(e),this.setRenderingMode(this.config.renderingMode)}catch(t){const e=`FOARenderer: HRIR loading/decoding (mode: ${this.config.renderingMode}) failed. Reason: ${t.message}`;throw new Error(e)}}setChannelMap(t){t.toString()!==this.config.channelMap.toString()&&(Gn("Remapping channels (["+this.config.channelMap.toString()+"] -> ["+t.toString()+"])."),this.config.channelMap=t instanceof Array?t.slice():t,this.router.setChannelMap(this.config.channelMap))}setRotationMatrix3(t){this.rotator.setRotationMatrix3(t)}setRotationMatrix4(t){this.rotator.setRotationMatrix4(t)}getRenderingMode(){return this.config.renderingMode}setRenderingMode(t){if(t!==this.config.renderingMode){switch(t){case dn.Ambisonic:this.convolver.enable(),this.bypass.disconnect();break;case dn.Bypass:this.convolver.disable(),this.bypass.connect(this.output);break;case dn.None:this.convolver.disable(),this.bypass.disconnect();break;default:A(t)}this.config.renderingMode=t}}}class ni{constructor(t,e,n){this._active=!1,this._isBufferLoaded=!1,this._context=t,this._ambisonicOrder=e,this._numberOfChannels=(this._ambisonicOrder+1)*(this._ambisonicOrder+1),this._buildAudioGraph(),n&&this.setHRIRBufferList(n),this.enable()}_buildAudioGraph(){const t=Math.ceil(this._numberOfChannels/2);this._inputSplitter=this._context.createChannelSplitter(this._numberOfChannels),this._stereoMergers=[],this._convolvers=[],this._stereoSplitters=[],this._positiveIndexSphericalHarmonics=this._context.createGain(),this._negativeIndexSphericalHarmonics=this._context.createGain(),this._inverter=this._context.createGain(),this._binauralMerger=this._context.createChannelMerger(2),this._outputGain=this._context.createGain();for(let e=0;e<t;++e)this._stereoMergers[e]=this._context.createChannelMerger(2),this._convolvers[e]=this._context.createConvolver(),this._stereoSplitters[e]=this._context.createChannelSplitter(2),this._convolvers[e].normalize=!1;for(let t=0;t<=this._ambisonicOrder;++t)for(let e=-t;e<=t;e++){const n=t*t+t+e,i=Math.floor(n/2);this._inputSplitter.connect(this._stereoMergers[i],n,n%2),this._stereoMergers[i].connect(this._convolvers[i]),this._convolvers[i].connect(this._stereoSplitters[i]),e>=0?this._stereoSplitters[i].connect(this._positiveIndexSphericalHarmonics,n%2):this._stereoSplitters[i].connect(this._negativeIndexSphericalHarmonics,n%2)}this._positiveIndexSphericalHarmonics.connect(this._binauralMerger,0,0),this._positiveIndexSphericalHarmonics.connect(this._binauralMerger,0,1),this._negativeIndexSphericalHarmonics.connect(this._binauralMerger,0,0),this._negativeIndexSphericalHarmonics.connect(this._inverter),this._inverter.connect(this._binauralMerger,0,1),this._inverter.gain.value=-1,this.input=this._inputSplitter,this.output=this._outputGain}dispose(){this._active&&this.disable();for(let t=0;t<=this._ambisonicOrder;++t)for(let e=-t;e<=t;e++){const n=t*t+t+e,i=Math.floor(n/2);this._inputSplitter.disconnect(this._stereoMergers[i],n,n%2),this._stereoMergers[i].disconnect(this._convolvers[i]),this._convolvers[i].disconnect(this._stereoSplitters[i]),e>=0?this._stereoSplitters[i].disconnect(this._positiveIndexSphericalHarmonics,n%2):this._stereoSplitters[i].disconnect(this._negativeIndexSphericalHarmonics,n%2)}this._positiveIndexSphericalHarmonics.disconnect(this._binauralMerger,0,0),this._positiveIndexSphericalHarmonics.disconnect(this._binauralMerger,0,1),this._negativeIndexSphericalHarmonics.disconnect(this._binauralMerger,0,0),this._negativeIndexSphericalHarmonics.disconnect(this._inverter),this._inverter.disconnect(this._binauralMerger,0,1)}setHRIRBufferList(t){if(!this._isBufferLoaded){for(let e=0;e<t.length;++e)this._convolvers[e].buffer=t[e];this._isBufferLoaded=!0}}enable(){this._binauralMerger.connect(this._outputGain),this._active=!0}disable(){this._binauralMerger.disconnect(),this._active=!1}}function ii(t,e){return t===e?1:0}function si(t,e,n){return(n+t)*(2*t+1)+(e+t)}function ri(t,e,n,i,s){const r=si(e,n,i);t[e-1][r].gain.value=s}function oi(t,e,n,i){const s=si(e,n,i);return t[e-1][s].gain.value}function ai(t,e,n,i,s){return i===s?oi(t,1,e,1)*oi(t,s-1,n,s-1)-oi(t,1,e,-1)*oi(t,s-1,n,1-s):i===-s?oi(t,1,e,1)*oi(t,s-1,n,1-s)+oi(t,1,e,-1)*oi(t,s-1,n,s-1):oi(t,1,e,0)*oi(t,s-1,n,i)}function Ai(t,e,n,i){return ai(t,0,e,n,i)}function ci(t,e,n,i){if(0===e)return ai(t,1,1,n,i)+ai(t,-1,-1,n,i);if(e>0){const s=ii(e,1);return ai(t,1,e-1,n,i)*Math.sqrt(1+s)-ai(t,-1,1-e,n,i)*(1-s)}{const s=ii(e,-1);return ai(t,1,e+1,n,i)*(1-s)+ai(t,-1,-e-1,n,i)*Math.sqrt(1+s)}}function hi(t,e,n,i){return 0===e?0:e>0?ai(t,1,e+1,n,i)+ai(t,-1,-e-1,n,i):ai(t,1,e-1,n,i)-ai(t,-1,1-e,n,i)}function ui(t,e,n){const i=ii(t,0),s=Math.abs(e)===n?1/(2*n*(2*n-1)):1/((n+e)*(n-e));return Ke(li,Math.sqrt((n+t)*(n-t)*s),.5*(1-2*i)*Math.sqrt((1+i)*(n+Math.abs(t)-1)*(n+Math.abs(t))*s),-.5*(1-i)*Math.sqrt((n-Math.abs(t)-1)*(n-Math.abs(t)))*s),li}const li=Je();function di(t,e){for(let n=-e;n<=e;n++)for(let i=-e;i<=e;i++){const s=ui(n,i,e);Math.abs(s[0])>0&&(s[0]*=Ai(t,n,i,e)),Math.abs(s[1])>0&&(s[1]*=ci(t,n,i,e)),Math.abs(s[2])>0&&(s[2]*=hi(t,n,i,e)),ri(t,e,n,i,s[0]+s[1]+s[2])}}function fi(t){for(let e=2;e<=t.length;e++)di(t,e)}class pi{constructor(t,e){this._context=t,this._ambisonicOrder=e;const n=(e+1)*(e+1);this._splitter=this._context.createChannelSplitter(n),this._merger=this._context.createChannelMerger(n),this._gainNodeMatrix=[];for(let t=1;t<=e;t++){const e=t*t,n=2*t+1;this._gainNodeMatrix[t-1]=[];for(let i=0;i<n;i++){const s=e+i;for(let r=0;r<n;r++){const o=e+r,a=i*n+r;this._gainNodeMatrix[t-1][a]=this._context.createGain(),this._splitter.connect(this._gainNodeMatrix[t-1][a],s),this._gainNodeMatrix[t-1][a].connect(this._merger,0,o)}}}this._splitter.connect(this._merger,0,0),this.setRotationMatrix3(Ye(Ge())),this.input=this._splitter,this.output=this._merger}dispose(){for(let t=1;t<=this._ambisonicOrder;t++){const e=t*t,n=2*t+1;for(let i=0;i<n;i++){const s=e+i;for(let r=0;r<n;r++){const o=e+r,a=i*n+r;this._splitter.disconnect(this._gainNodeMatrix[t-1][a],s),this._gainNodeMatrix[t-1][a].disconnect(this._merger,0,o)}}}this._splitter.disconnect(this._merger,0,0)}setRotationMatrix3(t){this._gainNodeMatrix[0][0].gain.value=t[0],this._gainNodeMatrix[0][1].gain.value=t[1],this._gainNodeMatrix[0][2].gain.value=t[2],this._gainNodeMatrix[0][3].gain.value=t[3],this._gainNodeMatrix[0][4].gain.value=t[4],this._gainNodeMatrix[0][5].gain.value=t[5],this._gainNodeMatrix[0][6].gain.value=t[6],this._gainNodeMatrix[0][7].gain.value=t[7],this._gainNodeMatrix[0][8].gain.value=t[8],fi(this._gainNodeMatrix)}setRotationMatrix4(t){this._gainNodeMatrix[0][0].gain.value=t[0],this._gainNodeMatrix[0][1].gain.value=t[1],this._gainNodeMatrix[0][2].gain.value=t[2],this._gainNodeMatrix[0][3].gain.value=t[4],this._gainNodeMatrix[0][4].gain.value=t[5],this._gainNodeMatrix[0][5].gain.value=t[6],this._gainNodeMatrix[0][6].gain.value=t[8],this._gainNodeMatrix[0][7].gain.value=t[9],this._gainNodeMatrix[0][8].gain.value=t[10],fi(this._gainNodeMatrix)}getRotationMatrix3(){return Xe(gi,this._gainNodeMatrix[0][0].gain.value,this._gainNodeMatrix[0][1].gain.value,this._gainNodeMatrix[0][2].gain.value,this._gainNodeMatrix[0][3].gain.value,this._gainNodeMatrix[0][4].gain.value,this._gainNodeMatrix[0][5].gain.value,this._gainNodeMatrix[0][6].gain.value,this._gainNodeMatrix[0][7].gain.value,this._gainNodeMatrix[0][8].gain.value),gi}getRotationMatrix4(){return Ze(vi,this._gainNodeMatrix[0][0].gain.value,this._gainNodeMatrix[0][1].gain.value,this._gainNodeMatrix[0][2].gain.value,0,this._gainNodeMatrix[0][3].gain.value,this._gainNodeMatrix[0][4].gain.value,this._gainNodeMatrix[0][5].gain.value,0,this._gainNodeMatrix[0][6].gain.value,this._gainNodeMatrix[0][7].gain.value,this._gainNodeMatrix[0][8].gain.value,0,0,0,0,1),vi}getAmbisonicOrder(){return this._ambisonicOrder}}const gi=Ge(),vi=We();var wi=["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/P////v//P8CAAQA+//+//3//f8CAAUA+v/9//////8AAAQA+v/8////AAD//wIA+//8/wAAAQD+/wEA+//8/wAAAgD9/////P/9/wEAAgD8//7//f/9/wAAAgD8//3//v/+////AQD8//z/////////AAD8//3///8AAP7/AAD9//7///8AAP7////+//////8AAP7////+////////////////////","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD//////v8AAP///////wAAAAAAAP7/AQABAAAABwD///X/BQAjAPL/CQDb/9D/GAAb/7sAYwCW/z0BcP/X/7T/2QDW+wH8yANCCCUJ5QT++UXmhPwhA78FuAxH+p78ifudBlAG9vmu/lAK2fdlB///cfjoCa0E7Akn9Yb/zvba+AkAHPywBGEBFwUNAL8AXAAGA20DFvmR/kz+F/06Ag/+GwHl/5EEKgJd/q0AP/ym/9n6EfxY/2H+/QFtAC4C6QBDAaMCo/20/+3/3f/p/fL9rv9V/6cBhQHuAX4AcwJYAaH/IP/P/gsApP0LAe7/sQBuAI0AAgGDAE4BzACe/5X//v+v/+f+Zf+gAOv/5QBhAOIApAANASYAuP+h/8b/HQBr/9//bACWAGEAFAB5AD0AWQDU/+D/Yf/p//D/s/+R/4QAMQBvABEAkQBfABQAJgDW/wwA8/8XALz/vf8zAFAAKwD1/zEAPwDJ/x0A7/8LAOX/FwDR//H/EQAdAO//6P8QAFEA2f8WABEAMgDy/xIA+f/s/xAALgDv////HQAvAPT/+f8iAAYAEgAFABoAGgD//w0A+f/0/xsAHgDx/9f/GAACAPH/8f8JAPf/GwALABEA7/8cAPT/CgD2//j/BQD8/+3/OgAgAAYA9f8PAN7/DgD9/9r/1//3/+3/9//1//b/8//5//f/AgAJAOf/+v8OAAMACwD9/+7/5f8eAAEA9//q//7/8P8WAP7/+//4/wIA+f8TAAIA9f/5/wcA+P8iAAgA9v/n/xoA//8gAAUABwDj/wAA9v8BAAUAFQDn/wMA7v8QABAAEQDm/wwA8f8aAAAABwDu/wcACgASAAEA7//w//f/BgARAAkA6P/3/wcADgAKAAYA4f/4/wYADgAAAPr/8P/9/xQACgAHAPn/7//9/xEAAgD+//L/8v/8/xUAAwDw//H/9f8CAAsA/v/q//L/+f8FAAYA/P/r//j///8GAAkA+//o//j/AQAIAP//+v/o//v/CAAIAPv/+P/w/wEACQAHAPj/+f/0/wIACwAFAPb/+f/4/wQACwACAPP/+f/+/wYACAD///L/+/8BAAYABQD9//P//P8FAAUAAgD7//T//f8HAAQA///7//f///8IAAMA/P/6//r/AQAIAAEA+v/6//3/AgAHAAAA+f/7/wAAAwAFAP7/+P/8/wIAAgACAP3/+f/9/wMAAwAAAPz/+v/+/wQAAgD+//z/+/8AAAQAAQD8//z//f8BAAQAAAD7//3///8BAAMA///7//3/AAACAAEA/v/7//7/AQABAAAA/v/9////AQAAAP///v/+////AAD/////////////////////////////","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD////////+//////8AAAAA/v/+/wAAAQD8//3/CQAJAP3/+v8PAAcApABlABkBkwCO/i//lfqa/HQAcf/3BdkCzwJcBCMC0wMN/9/9wgI7AaECYfxV/Tf83vhn/xrt8Owx/8n7cgHABYb43QcZDh4WugNrA7P74gHu/9z/zv0t/acCiQHY/iv4qQOl/ysCE/0//XT9Sf4O//j9xfupAn394gHO+rsCXAFIAxQC9wIXBgcD2AQuAnb/9gJh/6wAVfxEAI4Bvf7oAFv/bALsAMQBe/88/joAT/4dAH39/v9LAXn/gwDI//QBdABcAA0A7f4lAMn///+9/tv/iABp/13/pP/dALv/w/8MAHv//f+y/6////7U/5AAZP+Z/8r/nQDR/5r/DwDr/xAA4v+s/3z/+P9uAOv/t/82AGcAHgCb/yQAFQBGAM7/CgD3/xoAegAaAOz/CgBHAA8Adv8/AAAABQC2/xIAAAA7ABQAKgCj/z4AAQAXAJz/JAADAAcA8f/1/2AAAQAlAPD/NgDx/1wA7v/4/wMAZADv//3/HQAkAFoA8P9FAPv/FgBIAPf/WQAHAEUACQD0/xIAQwDu/wMAwP9VALn/XwCw/yEA5f8sAPj/FgDD/1YAyv8rAOX/HQDo//j/IQAQACAAHwD9/yQAHQBAABgABQAiAAUAKAD3/wkACwAKAAMABwAJAPb/+f8GAOr/JQAHABMA6P8TAA4AGgD//woA8/8ZAP//GADu/w0A9v8SAAMABwD4/wQA5P8XAAQACgDq/wUA+/8VAAcACADs/xIAAAATAPH/+v/1//T/7f///+z/+v/y/+//9/8KAAcACgAJAPT/BAAKAAAABgAIAPL/9v8KAAMABAACAPr/9v8OAAIA+P/x//v/+f8MAPb/+P/w/wQA9f8MAPn////7/woA/v8PAAEAAgD1/xAAAQAPAP//AwD//xQABwALAAAABgADABAAAgAHAAAACAABAA8ABQAFAAMABwAEAA4ABwADAAEACQAFAAoAAwD//wAACQADAAUAAQD/////CAABAAMAAAD/////BwACAAEAAAD/////BwACAP7///8BAAAABgABAP7///8CAAAABAAAAP7///8DAAAAAwAAAP3///8DAAAAAQAAAP3//v8EAAAAAAD+//////8EAP/////+/wAA/v8EAP/////+/wEA/v8EAP///v/+/wIA//8DAP///v/+/wIA//8BAP///v/+/wMA//8BAP/////+/wMA//8AAP//AAD+/wQA//8AAP7/AQD//wIA////////AQD//wIA////////AQAAAAEAAAAAAP//AQD//wEAAAAAAP//AQAAAAEAAAAAAAAA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD+/wAA+v8AAPz/AAD//wAA/f8AAAEAAAD+/wAACQAAAAQAAAAZAAAAtgAAAFsBAABW/gAAH/oAAGcBAABoBwAAlAAAAO3/AAARAQAA+wIAAEoEAACe/gAAiv4AALD0AADJ8wAAkQQAAF34AABi8QAAPQAAAAH2AAD19AAADAMAAJwGAACTEAAA0AwAAJkHAACOBwAAuQEAANcDAAC6AgAAHwUAAHEFAAB0AwAAbgEAADz+AADYAQAAGAAAAJwCAADgAAAA//0AAMn+AAAT/AAAwP8AAOn9AAAJAAAAewEAAOn+AACN/wAAOv0AAO3+AADN/gAAcP8AACj/AACq/gAA+f4AAML9AACa/wAA/f4AAN7/AABo/wAA6/4AAE//AAAC/wAAEQAAAHX/AAB0AAAA5f8AAEwAAAB3AAAA5/8AAMIAAABCAAAAzgAAAE8AAAB3AAAAKAAAADMAAACqAAAALwAAAK4AAAASAAAAVgAAACgAAAAtAAAATAAAAP3/AAA7AAAA2/8AACQAAADw/wAALQAAADEAAAAlAAAAbAAAADMAAABUAAAAEAAAACgAAAD1/wAA9v8AAPr/AADu/wAALgAAABIAAABUAAAARAAAAGUAAABGAAAAOAAAAGAAAAAuAAAARQAAACEAAAAfAAAAAAAAAAkAAAAQAAAAAwAAABIAAADs/wAAEAAAAAYAAAASAAAAIgAAABEAAAADAAAABAAAAA8AAAD4/wAAHQAAAAsAAAAIAAAADgAAAP//AAAcAAAADwAAAAYAAAASAAAAFwAAAAMAAAAYAAAAEgAAAPr/AAAQAAAADQAAAAoAAAD3/wAABgAAAPb/AADf/wAA/v8AAPL/AAD6/wAAFAAAAAQAAAAEAAAAGwAAAAEAAAAMAAAAIAAAAAIAAAAdAAAAGAAAAAIAAAAcAAAAEgAAAAcAAAAeAAAADwAAAAQAAAAeAAAABAAAAAYAAAAZAAAAAQAAAA4AAAATAAAA/v8AAAoAAAAOAAAA+/8AAAsAAAAJAAAA+f8AAAsAAAABAAAA+f8AAAoAAAD9/wAA+v8AAAcAAAD5/wAA+v8AAAUAAAD3/wAA/f8AAAQAAAD2/wAAAAAAAAEAAAD3/wAAAgAAAAAAAAD4/wAAAwAAAP7/AAD6/wAABAAAAP3/AAD8/wAABAAAAPv/AAD+/wAAAwAAAPv/AAD//wAAAQAAAPv/AAAAAAAAAAAAAPv/AAACAAAA//8AAPz/AAACAAAA/v8AAP3/AAACAAAA/f8AAP7/AAABAAAA/f8AAP//AAABAAAA/f8AAAAAAAAAAAAA/v8AAAEAAAAAAAAA//8AAAAAAAAAAAAAAAAAAAAAAAAAAAAA"],mi=["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AAD7/wEAAgD7//7/AQD8/wAAAwD8//3/AwD9/wAAAgD9//z/AwD/////AgD+//z/AwAAAP7/AQD///3/AgABAP3/AAAAAP3/AgACAPz///8BAP3/AQACAP3//v8BAP7/AAABAP3//v8CAP7///8BAP7//f8CAP////8AAAAA/v8CAAAAAAAAAAAA/v8BAAAAAAD//wAA//8AAP//AAD//wAA//8AAP//","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAP//AAD//wAA//8AAAAA/////wAAAQD+////AAAGAP3/OAABAIIAAwBv//f/E/0QAK0ADQCzA/7/8P4u/0cBDQCJA6ABbQDg/w7/z/9o+Vn/SPnL/1//Ef+2+jr9RfZgA5QFZwILDFj+PAb2/nEFKgKk/R0Dlv6b/FUDsP6YAoj9SgAT/iL/tAPwAv8A0P6zAr7/dwAnAf39uP22/skA2v///2YCoP4UAUsAZgF2AJH+4P70/rz9+f+U/Xv/8v7CAcb+TACS/kwAv/+x/tX9oP71/oL/1f8nAEUAZwGtAAgAIgC/AD4BaP8GAGH/dQDF/64Arf8nAakAhAH9/+kAQQD3AFb/q/8p/yIAR/8FAPD/ZAA/AIYA3v8tADQADQBp/3f/CwABAP3/Wf8OANj/WwDH/xoAe/8DAKz/zv96/z8A3f/J/5X/IAD5//j/q//c/+//RADq//D/vv8pADUAFQDI/y8ACAAbANb/OwD3/+3/9f/e/wcAIAAeAMH/8/8xAC0AEADW/+3/HAADAPv/8P8DAOL/OwD3/xcACQAHAM//5f8XAAcAz//T/9D/HgD9////yf/e//v/AgD//9H/6/////H/+/8hAAIA9//7/w0AFgAQAPL/2v/8/xsAGQABANz/9P8YAAQA/v/y/wMA5v8YAAkAAAAAAAMA7/8KABgADwDs//j/BwATABsA8P/1//z/BAAMAAAA9P/s/xAA/v8GAAkA/v/p/wMACwALAP7/9P/p/wcADQAFAPb/7//4/w0ACAD8//b//v/1/wMACwD1//T/8P/8/wAACQDz/+f/5P8GAAkABQD5//D/+v8FAA0AAwD///T/AgACABAA/v8CAPD/+/8FAAoA9f/3//f//v8GAP7/9v/t//z/+f8AAPj/+v/3/wEA+v8HAPr//P/5/wQA//8DAPr/+P/3/wYA///+//X/+//5/wQA/f/7//X/+//4/wMA/f/8//j//v/9/wYA///8//f/AgAAAAUA/f/6//n/AwACAAIA/f/7//z/AwACAAAA/f/6//3/AgADAP7//f/7/wAAAwAFAPz////8/wMAAgAEAPv//v/+/wMAAgADAPv//v///wMAAQABAPv//f8AAAIAAAD///v//f8BAAIA///+//z//v8CAAIA/v/9//3///8CAAEA/v/9//7/AAACAAAA/v/9////AAABAAAA/f/9/wAAAQABAP///f/+/wEAAQAAAP///v/+/wEAAQD///7//v///wEAAQD///7//v///wEAAAD+//7///8AAAAAAAD+//7///8AAAAA///+//7///8AAAAA////////AAAAAP////////////8AAP//////////","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAAAAAAABAAAAAAD//////////////v////3/////////+//8////AQD9//z/9f8BAAIA+f8dACgAWQBxAJX/qv+Y/uz9aP9k/7UDUQQBAiQA4Pgi/AkB0gKaBsD/+fxp/vz9CQSp/I/+ywDO+vMD0fzK/PABcgBeBfoBv/+uAuH9Sf5gAy39awMmBWUBuP9fA9/9fgDj/2/+EACaACcCSv9Z/2j/rv7hAA0AWf55/7L84P7E/SIAT/67AMv/tf+FAA7/1v+7/gv/IP+E/sQA+P5aAXz/tP9XAFX/tP8o/4r/j//e/yQAMv9mAJT/rgCr/9X/EwCb//H/9f7F/6D/EAAoAK3//v+e/zsAh/+B/7r/if/C/2r/4P/z/6//HwCy/0IA7/9ZALT/y/80ACgA9v/J/9//DgA5ADUALQARADIACwAfAOf/NgArACMACQBBAEcAGAAjAC4AWQBUAHcAAAAfACEAIAAcAPj/CADk/yQA7v89AEEAFwD5/xYA6f8aAOX/AADF/zQADwAUAOT/BQDr/yUA6P8XAOf/HADR/0AA8P8nAAgACQDt/ycAKAAHAPH/IQDz/xsACADn//n/DgADAA4A8P///8z/GgDN/yMA/f8QANj/MwACAC0ACwAOAO3/JgAZAAUACgAAAA4AIgAaAAkADwACAAAAHQATAAUABQACAAgACwAjAO////8AAA8ABQAPAPL//f8GAAsABgAGAPD/8v8GAPz/CAD6//H/6v8PAAgABgD4//3/9v8aAAgABwD1//7//v8QAAoACAD//wUA9v8QAAoABAAFAAgAAgAJAAoAAwD//w0AAgD//wcA/v8DAAoABQAFABUABAAKAAYABwAHAA8ACgAGAAwADwAMAAkAEAAJAAgADwAMAAgADgAJAAUACQAPAAUACwAHAAEABgAIAAEABAAGAP//AgAJAAAAAgAEAP7///8IAAIA//8GAAEAAQAJAAIA/v8EAAMA//8JAAEA/v8DAAMA/v8HAAMA/f8BAAUA/v8FAAMA/v8BAAcA//8DAAMA/v8BAAYA//8CAAMA/////wcAAAAAAAMAAAD//wYAAQD+/wMAAQD//wUAAQD+/wIAAgD//wQAAgD+/wEAAwD//wMAAwD+/wEAAwD//wIAAwD//wEABAAAAAEABAD//wAABAABAAAAAwAAAAAABAABAP//AwABAAAAAwACAP//AgACAAAAAwACAP//AgACAAAAAgACAAAAAQADAAAAAQACAAAAAQADAAAAAQACAAAAAAACAAEAAAACAAEAAAACAAEAAAABAAEAAAABAAEAAAABAAEAAAABAAEAAAABAAEAAAABAAEAAAAAAAAAAAAAAAAA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAP//AAD//wAA//8AAAAA//8AAP//AAACAAAA+f8BAAYA///4/wIA//8AAA8A/v/V/wEAEwA9AAEBRwA2AF7/kfog/3gBwv99CDYBU/qtAUX/AP7OAfkAX/o9B38FSfwaAuT14/60BAr8CQAI/tfyIQTzAXP+egdUBBwBof7TBMT8bAWi/5EEWwBRAAAKyfxE/8b88vp6ACP+PAF4/qD8MQNM/ygCJ/2XAPD9kP5gAVT/iP9I/lEB4P8qAD0BFAGa/+7/DgB2AOP98gFm/u/+Vv5/AG8ASP9gAM//qv9w//oAcv+2/jIBHgA7/6D/oAAGAKH/lADT/wAAggC8AAYAkP9yAEcAkf8BAOD/RAAr/zUANwDt/xQAJQAkAMT/zwA/AOH/xv9zAGsANQBTAIcALAAvACIATACy/xMADADg/xcAWABvAJL/7f9VAPb/EgDt/wcA4f8kAPP/5P+h/wgACQDy//r/LgAQAMn/8/9CAOX/5v/S/9//3P8pABYAuP/s/w8AFgDt/+3/7v/w/9j/5/8GAOf/2P/2//P//v8kABMAuf/m/xoADADZ/+r/3P8KAAUAKwDe/wsA3P8VAAAADgAfAB0ACAAMAF4AGgAhAPL/MwDz/0kABAAKAPX/LwAbAAkA9v/s/+3/8/8CABAAAADm//n/BQALAAUAAQDj//n/JQAVAPX/9v/+/wIAEQABAPP/8P/1/wAABgD6/+3/7//o//j/DAD8/+b/8P8IAAkABgD4//D/8P8UAAoAAwD4/wAA+f8OAAcAAAAFAPX/9v8TAAkA8v8EAPb/9/8dAA0A7/8CAPn/+f8SAAQA8/8CAOf/+v8DAAgA9P////H//P8IAAUA8//0/wIAAQAGAAgA9//7/wAA+/8EAP//+P/+////AgACAAsA8v/+/wIABQD7/wgA9v/7/wMABAD5/wAA/P/3/wEAAQD7//7//P/1/wQA///3//r////3/wMAAwD1//r/AwD6////AgD4//n/AwD8//7/AgD4//n/AwD+//3/AQD4//n/BQD///n/AAD6//j/BAABAPj/AAD9//v/AwADAPj//v/+//z/AwAEAPj//v8BAP7/AQADAPj//f8CAP////8EAPr//P8DAAAA/v8CAPv//P8DAAEA/f8BAP3//f8DAAIA/P8AAP7//f8DAAIA/P///wAA/f8BAAIA+//+/wEA//8AAAEA+//+/wEA/////wEA/P/+/wEA///+/wAA/f/9/wEAAAD9/wAA/f/+/wEAAQD8/////v/+/wAAAQD8////////////AQD9////AAD/////AAD+////AAAAAP//AAD///////8AAP//AAD//wAA//8AAP//"];const Di=[2,3];class yi{constructor(t,e){if(this.context=t,this.config=Object.assign({ambisonicOrder:3,renderingMode:dn.Ambisonic},e),Di.includes(this.config.ambisonicOrder)||(Gn("HOARenderer: Invalid ambisonic order. (got "+this.config.ambisonicOrder+") Fallbacks to 3rd-order ambisonic."),this.config.ambisonicOrder=Math.max(2,Math.min(3,this.config.ambisonicOrder))),this.config.numberOfChannels=(this.config.ambisonicOrder+1)*(this.config.ambisonicOrder+1),this.config.numberOfStereoChannels=Math.ceil(this.config.numberOfChannels/2),this.config.hrirPathList.length!==this.config.numberOfStereoChannels)throw new Error("HOARenderer: Invalid HRIR URLs. It must be an array with "+this.config.numberOfStereoChannels+" URLs to HRIR files. (got "+e.hrirPathList+")");this._buildAudioGraph()}_buildAudioGraph(){this.input=this.context.createGain(),this.output=this.context.createGain(),this.bypass=this.context.createGain(),this.rotator=new pi(this.context,this.config.ambisonicOrder),this.convolver=new ni(this.context,this.config.ambisonicOrder),this.input.connect(this.rotator.input),this.input.connect(this.bypass),this.rotator.output.connect(this.convolver.input),this.convolver.output.connect(this.output),this.input.channelCount=this.config.numberOfChannels,this.input.channelCountMode="explicit",this.input.channelInterpretation="discrete"}dispose(){this.getRenderingMode()===dn.Bypass&&this.bypass.connect(this.output),this.input.disconnect(this.rotator.input),this.input.disconnect(this.bypass),this.rotator.output.disconnect(this.convolver.input),this.convolver.output.disconnect(this.output),this.rotator.dispose(),this.convolver.dispose()}async initialize(){let t;t=this.config.hrirPathList?new Yn(this.context,this.config.hrirPathList,{dataType:Xn.URL}):2===this.config.ambisonicOrder?new Yn(this.context,wi):new Yn(this.context,mi);try{const e=await t.load();this.convolver.setHRIRBufferList(e),this.setRenderingMode(this.config.renderingMode)}catch(t){const e=`HOARenderer: HRIR loading/decoding (mode: ${this.config.renderingMode}) failed. Reason: ${t.message}`;throw new Error(e)}}setRotationMatrix3(t){this.rotator.setRotationMatrix3(t)}setRotationMatrix4(t){this.rotator.setRotationMatrix4(t)}getRenderingMode(){return this.config.renderingMode}setRenderingMode(t){if(t!==this.config.renderingMode){switch(t){case dn.Ambisonic:this.convolver.enable(),this.bypass.disconnect();break;case dn.Bypass:this.convolver.disable(),this.bypass.connect(this.output);break;case dn.None:this.convolver.disable(),this.bypass.disconnect();break;default:A(t)}this.config.renderingMode=t}}}class bi{constructor(t,e){e=Object.assign({ambisonicOrder:1,position:qe(Je(),Dn),forward:qe(Je(),bn),up:qe(Je(),Pn),renderingMode:In},e),this.position=Je(),this.tempMatrix3=Ge(),this.ambisonicOrder=zn.validateAmbisonicOrder(e.ambisonicOrder),1==this.ambisonicOrder?this.renderer=function(t,e){return new ei(t,e)}(t,{renderingMode:e.renderingMode}):this.ambisonicOrder>1&&(this.renderer=function(t,e){return new yi(t,e)}(t,{ambisonicOrder:this.ambisonicOrder,renderingMode:e.renderingMode})),this.input=t.createGain(),this.output=t.createGain(),this.ambisonicOutput=t.createGain(),this.renderer.initialize().then((()=>{this.input.connect(this.renderer.input),this.renderer.rotator.output.connect(this.ambisonicOutput),this.renderer.output.connect(this.output)})),this.setOrientation(e.forward,e.up)}getRenderingMode(){return this.renderer.getRenderingMode()}setRenderingMode(t){this.renderer.setRenderingMode(t)}dispose(){this.input.disconnect(this.renderer.input),this.renderer.rotator.output.disconnect(this.ambisonicOutput),this.renderer.output.disconnect(this.output),this.renderer.dispose()}setOrientation(t,e){qe(Pi,t),qe(Ci,e),sn(Ei,Pi,Ci),Xe(this.tempMatrix3,Ei[0],Ei[1],Ei[2],Ci[0],Ci[1],Ci[2],-Pi[0],-Pi[1],-Pi[2]),this.renderer.setRotationMatrix3(this.tempMatrix3)}}const Pi=Je(),Ci=Je(),Ei=Je();class Ii{constructor(t,e){this.listenerPosition=qe(Je(),Dn),this.speedOfSound=Cn,this.coefficients={left:Bn.left,right:Bn.right,front:Bn.front,back:Bn.back,up:Bn.up,down:Bn.down},this.halfDimensions={width:.5*_n.width,height:.5*_n.height,depth:.5*_n.depth},e&&(c(e?.speedOfSound)&&(this.speedOfSound=e.speedOfSound),e?.listenerPosition instanceof Array&&3===e.listenerPosition.length&&c(e.listenerPosition[0])&&c(e.listenerPosition[1])&&c(e.listenerPosition[2])&&(this.listenerPosition[0]=e.listenerPosition[0],this.listenerPosition[1]=e.listenerPosition[1],this.listenerPosition[2]=e.listenerPosition[2])),this.input=t.createGain(),this.output=t.createGain(),this.lowpass=t.createBiquadFilter(),this.merger=t.createChannelMerger(4),this.delays={left:t.createDelay(2),right:t.createDelay(2),front:t.createDelay(2),back:t.createDelay(2),up:t.createDelay(2),down:t.createDelay(2)},this.gains={left:t.createGain(),right:t.createGain(),front:t.createGain(),back:t.createGain(),up:t.createGain(),down:t.createGain()},this.inverters={right:t.createGain(),back:t.createGain(),down:t.createGain()};for(const t of Object.values(mn)){const e=this.delays[t],n=this.gains[t];e.delayTime.value=0,n.gain.value=0,this.delays[t]=e,this.gains[t]=n,this.lowpass.connect(e),e.connect(n),n.connect(this.merger,0,0),t!==mn.Right&&t!=mn.Back&&t!==mn.Down||(this.inverters[t].gain.value=-1)}this.input.connect(this.lowpass),this.lowpass.type="lowpass",this.lowpass.frequency.value=6400,this.lowpass.Q.value=0,this.gains.left.connect(this.merger,0,1),this.gains.right.connect(this.inverters.right),this.inverters.right.connect(this.merger,0,1),this.gains.up.connect(this.merger,0,2),this.gains.down.connect(this.inverters.down),this.inverters.down.connect(this.merger,0,2),this.gains.front.connect(this.merger,0,3),this.gains.back.connect(this.inverters.back),this.inverters.back.connect(this.merger,0,3),this.merger.connect(this.output),this.setRoomProperties(e?.dimensions,e?.coefficients)}setRoomProperties(t,e){null==t&&(t={width:_n.width,height:_n.height,depth:_n.depth}),c(t.width)&&c(t.height)&&c(t.depth)&&(this.halfDimensions.width=.5*t.width,this.halfDimensions.height=.5*t.height,this.halfDimensions.depth=.5*t.depth),null==e&&(e={left:Bn.left,right:Bn.right,front:Bn.front,back:Bn.back,up:Bn.up,down:Bn.down}),c(e.left)&&c(e.right)&&c(e.front)&&c(e.back)&&c(e.up)&&c(e.down)&&(this.coefficients.left=e.left,this.coefficients.right=e.right,this.coefficients.front=e.front,this.coefficients.back=e.back,this.coefficients.up=e.up,this.coefficients.down=e.down),this.setListenerPosition(this.listenerPosition)}dispose(){this.input.disconnect(this.lowpass);for(const t of Object.values(mn)){const e=this.delays[t],n=this.gains[t];this.lowpass.disconnect(e),e.disconnect(n),n.disconnect(this.merger,0,0)}this.gains.left.disconnect(this.merger,0,1),this.gains.right.disconnect(this.inverters.right),this.inverters.right.disconnect(this.merger,0,1),this.gains.up.disconnect(this.merger,0,2),this.gains.down.disconnect(this.inverters.down),this.inverters.down.disconnect(this.merger,0,2),this.gains.front.disconnect(this.merger,0,3),this.gains.back.disconnect(this.inverters.back),this.inverters.back.disconnect(this.merger,0,3),this.merger.disconnect(this.output)}setListenerPosition(t){qe(this.listenerPosition,t);for(const t of Object.values(mn)){const e=this.halfDimensions[Fn[t]],n=this.listenerPosition[Nn[t]],i=Hn[t],s=1*Math.max(0,e+i*n)+1,r=s/this.speedOfSound;this.delays[t].delayTime.value=r;const o=this.coefficients[t]/s;this.gains[t].gain.value=o}}}class Bi{constructor(t,e){const n=(e=Object.assign({durations:Sn.slice(),predelay:1.5,gain:.01,bandwidth:1,tailonset:3.8},e)).predelay/1e3;this.bandwidthCoeff=.346573590279973*e.bandwidth,this.tailonsetSamples=e.tailonset/1e3,this.context=t,this.input=t.createGain(),this.predelay=t.createDelay(n),this.convolver=t.createConvolver(),this.output=t.createGain(),this.output.gain.value=e.gain,this.convolver.normalize=!1,this.input.connect(this.predelay),this.predelay.connect(this.convolver),this.convolver.connect(this.output),this.setDurations(e.durations)}dispose(){this.input.disconnect(this.predelay),this.predelay.disconnect(this.convolver),this.convolver.disconnect(this.output)}setDurations(t){if(t.length!==xn)return void jn("Warning: invalid number of RT60 values provided to reverb.");const e=new Float32Array(xn),n=this.context.sampleRate;for(let i=0;i<t.length;i++)t[i]=Math.max(0,Math.min(3,t[i])),e[i]=Math.round(t[i]*n*1);let i=0;for(let t=0;t<e.length;t++)e[t]>i&&(i=e[t]);i<1&&(i=1);const s=this.context.createBuffer(1,i,n),r=s.getChannelData(0),o=new Float32Array(i);for(let t=0;t<i;t++)o[t]=2*Math.random()-1;for(let t=0;t<xn;t++){const i=-6.90775527898214/e[t],s=Ln*Mn[t]/n,a=Math.sin(s),A=a*Math.sinh(this.bandwidthCoeff*s/a),c=1/(1+A),h=A*c,u=-2*Math.cos(s)*c,l=(1-A)*c;let d=0,f=0;for(let n=0;n<e[t];n++){const t=o[n]*Math.exp(i*n)-u*d-l*f;r[n]+=h*(t-f),f=d,d=t}}const a=Math.round(this.tailonsetSamples);for(let t=0;t<Math.min(r.length,a);t++){const e=.5*(1-Math.cos(Ln*t/(2*a-1)));r[t]*=e}this.convolver.buffer=s}}function _i(t){const e={[mn.Left]:null,[mn.Right]:null,[mn.Front]:null,[mn.Back]:null,[mn.Up]:null,[mn.Down]:null};for(const t of Object.values(mn)){const n=kn[t];e[t]=Qn[n]}null==t&&(t=Object.assign({},t,kn));for(const n of Object.values(mn))t[n]in Qn?e[n]=Qn[t[n]]:jn('Material "'+t[n]+'" on wall "'+n+'" not found. Using "'+kn[n]+'".');return e}function Mi(t){if(null==t)t={width:_n.width,height:_n.height,depth:_n.depth};else for(const e of Object.values(wn))t.hasOwnProperty(e)||(t[e]=_n[e]);return t}function xi(t,e,n){const i=new Float32Array(xn);t=Mi(t),e=function(t){null==t&&(t={[mn.Left]:null,[mn.Right]:null,[mn.Front]:null,[mn.Back]:null,[mn.Up]:null,[mn.Down]:null});for(const e of Object.values(mn))t.hasOwnProperty(e)||(t[e]=Qn[kn[e]]);return t}(e),null==n&&(n=Cn);const s=55.2620422318571/n,r=t.width*t.height*t.depth;if(r<1e-4)return i;const o=t.width*t.height,a=t.width*t.depth,A=t.depth*t.height,c=2*(o+a+A);for(let t=0;t<xn;t++){const n=((e.left[t]+e.right[t])*o+(e.down[t]+e.up[t])*a+(e.front[t]+e.back[t])*A)/c;i[t]=1.38*s*r/(-c*Math.log(1-n)+4*Tn[t]*r)}return i}function Si(t){const e={[mn.Left]:0,[mn.Right]:0,[mn.Front]:0,[mn.Back]:0,[mn.Up]:0,[mn.Down]:0};for(const n of Object.values(mn))if(Bn.hasOwnProperty(n)){e[n]=0;for(let i=0;i<3;i++){const s=i+4;e[n]+=t[n][s]}e[n]/=3,e[n]=Math.sqrt(1-e[n])}return e}class Oi{constructor(t,e){(e=Object.assign({listenerPosition:qe(Je(),Dn),dimensions:Object.assign({},e.dimensions,_n),materials:Object.assign({},e.materials,kn),speedOfSound:Cn},e)).dimensions=Mi(e.dimensions);const n=_i(e.materials),i=Si(n),s=xi(e.dimensions,n,e.speedOfSound);this.early=new Ii(t,{dimensions:e.dimensions,coefficients:i,speedOfSound:e.speedOfSound,listenerPosition:e.listenerPosition}),this.late=new Bi(t,{durations:s}),this.speedOfSound=e.speedOfSound,this.output=t.createGain(),this.early.output.connect(this.output),this._merger=t.createChannelMerger(4),this.late.output.connect(this._merger,0,0),this._merger.connect(this.output)}dispose(){this.early.output.disconnect(this.output),this.late.output.disconnect(this._merger,0,0),this._merger.disconnect(this.output)}setProperties(t,e){const n=_i(e),i=xi(t,n,this.speedOfSound);this.late.setDurations(i),this.early.speedOfSound=this.speedOfSound;const s=Si(n);this.early.setRoomProperties(t,s)}setListenerPosition(t){this.early.speedOfSound=this.speedOfSound,this.early.setListenerPosition(t);const e=this.getDistanceOutsideRoom(t);let n=1;e>Un&&(n=1-e/1,n=Math.max(0,Math.min(1,n))),this.output.gain.value=n}getDistanceOutsideRoom(t){const e=Math.max(0,-this.early.halfDimensions.width-t[0],t[0]-this.early.halfDimensions.width),n=Math.max(0,-this.early.halfDimensions.height-t[1],t[1]-this.early.halfDimensions.height),i=Math.max(0,-this.early.halfDimensions.depth-t[2],t[2]-this.early.halfDimensions.depth);return Math.sqrt(e*e+n*n+i*i)}}class Qi{constructor(t,e){this.minDistance=1,this.maxDistance=1e3,this.rolloff=En,e&&(c(e.minDistance)&&(this.minDistance=e.minDistance),c(e.maxDistance)&&(this.maxDistance=e.maxDistance),e.rolloff&&(this.rolloff=e.rolloff)),this.setRolloff(this.rolloff),this.gainNode=t.createGain(),this.setDistance(this.maxDistance),this.input=this.gainNode,this.output=this.gainNode}setDistance(t){let e=1;if("logarithmic"==this.rolloff){if(t>this.maxDistance)e=0;else if(t>this.minDistance){let n=this.maxDistance-this.minDistance;if(n>Un){let i=1/(n+1);e=(1/(t-this.minDistance+1)-i)/(1-i)}}}else if("linear"==this.rolloff)if(t>this.maxDistance)e=0;else if(t>this.minDistance){let n=this.maxDistance-this.minDistance;n>Un&&(e=(this.maxDistance-t)/n)}this.gainNode.gain.value=e}setRolloff(t){null==t&&(t=En),this.rolloff=t}}const ki=Je(),Ti=Je();class Li{constructor(t,e){this.cosTheta=0,e=Object.assign({alpha:0,sharpness:1},e),this.context=t,this.lowpass=t.createBiquadFilter(),this.lowpass.type="lowpass",this.lowpass.Q.value=0,this.lowpass.frequency.value=.5*t.sampleRate,this.setPattern(e.alpha,e.sharpness),this.input=this.lowpass,this.output=this.lowpass}computeAngle(t,e){nn(ki,t),nn(Ti,e);let n=1;if(this.alpha>Un){let t=(s=Ti,(i=ki)[0]*s[0]+i[1]*s[1]+i[2]*s[2]);n=1-this.alpha+this.alpha*t,n=Math.pow(Math.abs(n),this.sharpness)}var i,s;this.lowpass.frequency.value=.5*this.context.sampleRate*n}setPattern(t,e){this.alpha=Math.min(1,Math.max(0,t)),this.sharpness=Math.max(1,e),this.computeAngle(Ke(ki,this.cosTheta*this.cosTheta,0,0),Ke(Ti,1,0,0))}}class Ri{constructor(t,e){e=Object.assign({position:qe(Je(),Dn),forward:qe(Je(),bn),up:qe(Je(),Pn),minDistance:1,maxDistance:1e3,rolloff:En,gain:1,alpha:0,sharpness:1,sourceWidth:0},e),this.scene=t,this.position=e.position,this.forward=e.forward,this.up=e.up,this.dx=Je(),this.right=Je(),sn(this.right,this.forward,this.up);let n=t.context;this.input=n.createGain(),this.directivity=new Li(n,{alpha:e.alpha,sharpness:e.sharpness}),this.toEarly=n.createGain(),this.toLate=n.createGain(),this.attenuation=new Qi(n,{minDistance:e.minDistance,maxDistance:e.maxDistance,rolloff:e.rolloff}),this.encoder=new zn(n,{ambisonicOrder:t.ambisonicOrder,sourceWidth:e.sourceWidth}),this.input.connect(this.toLate),this.toLate.connect(t.room.late.input),this.input.connect(this.attenuation.input),this.attenuation.output.connect(this.toEarly),this.toEarly.connect(t.room.early.input),this.attenuation.output.connect(this.directivity.input),this.directivity.output.connect(this.encoder.input),this.encoder.output.connect(t.listener.input),this.setPosition(e.position),this.input.gain.value=e.gain}dispose(){this.encoder.output.disconnect(this.scene.listener.input),this.directivity.output.disconnect(this.encoder.input),this.attenuation.output.disconnect(this.directivity.input),this.toEarly.disconnect(this.scene.room.early.input),this.attenuation.output.disconnect(this.toEarly),this.input.disconnect(this.attenuation.input),this.toLate.disconnect(this.scene.room.late.input),this.input.disconnect(this.toLate),this.encoder.dispose()}update(){tn(this.dx,this.position,this.scene.listener.position);const t=Ve(this.dx);nn(this.dx,this.dx);const e=Rn*Math.atan2(-this.dx[0],this.dx[2]),n=Rn*Math.atan2(this.dx[1],Math.sqrt(this.dx[0]*this.dx[0]+this.dx[2]*this.dx[2]));this.attenuation.setDistance(t),this.directivity.computeAngle(this.forward,this.dx),this.encoder.setDirection(e,n)}setRolloff(t){this.attenuation.setRolloff(t)}setMinDistance(t){this.attenuation.minDistance=t}setMaxDistance(t){this.attenuation.maxDistance=t}setGain(t){this.input.gain.value=t}setPosition(t){qe(this.position,t);let e=function(t){let e=1;return t>Un&&(e=1-t/1,e=Math.max(0,Math.min(1,e))),e}(this.scene.room.getDistanceOutsideRoom(this.position));this.toLate.gain.value=e,this.toEarly.gain.value=e,this.update()}setOrientation(t,e){qe(this.forward,t),qe(this.up,e),sn(this.right,this.forward,this.up)}setSourceWidth(t){this.encoder.setSourceWidth(t),this.setPosition(this.position)}setDirectivityPattern(t,e){this.directivity.setPattern(t,e),this.setPosition(this.position)}}class Ui{constructor(t,e){e=Object.assign({ambisonicOrder:1,listenerPosition:qe(Je(),Dn),listenerForward:qe(Je(),bn),listenerUp:qe(Je(),Pn),dimensions:Object.assign({},e.dimensions,_n),materials:Object.assign({},e.materials,kn),speedOfSound:Cn,renderingMode:In},e),this.ambisonicOrder=zn.validateAmbisonicOrder(e.ambisonicOrder),this._sources=new Array,this.room=new Oi(t,{listenerPosition:e.listenerPosition,dimensions:e.dimensions,materials:e.materials,speedOfSound:e.speedOfSound}),this.listener=new bi(t,{ambisonicOrder:e.ambisonicOrder,position:e.listenerPosition,forward:e.listenerForward,up:e.listenerUp,renderingMode:e.renderingMode}),this.context=t,this.output=t.createGain(),this.ambisonicOutput=t.createGain(),this.ambisonicInput=this.listener.input,this.room.output.connect(this.listener.input),this.listener.output.connect(this.output),this.listener.ambisonicOutput.connect(this.ambisonicOutput)}getRenderingMode(){return this.listener.getRenderingMode()}setRenderingMode(t){this.listener.setRenderingMode(t)}dispose(){this.room.output.disconnect(this.listener.input),this.listener.output.disconnect(this.output),this.listener.ambisonicOutput.disconnect(this.ambisonicOutput)}createSource(t){let e=new Ri(this,t);return this._sources[this._sources.length]=e,e}removeSource(t){const e=this._sources.findIndex((e=>e===t));e>-1&&(this._sources.splice(e,1),t.dispose())}setAmbisonicOrder(t){this.ambisonicOrder=zn.validateAmbisonicOrder(t)}setRoomProperties(t,e){this.room.setProperties(t,e)}setListenerPosition(t){qe(this.listener.position,t),this.room.setListenerPosition(t),this._sources.forEach((function(t){t.update()}))}setListenerOrientation(t,e){this.listener.setOrientation(t,e)}setSpeedOfSound(t){this.room.speedOfSound=t}}class ji extends je{constructor(t,e,n,i){super(t,e,n),this.node=i,this.gain.connect(this.node)}dispose(){this.node&&(this.node.disconnect(),this.node=null),super.dispose()}}class Fi extends ji{constructor(t,e,n,i){const s=i.createSource(void 0);super(t,e,n,s.input),this.resScene=i,this.resNode=s,Object.seal(this)}update(t,e){const{p:n,f:i,u:s}=t;this.resNode.setPosition(n),this.resNode.setOrientation(i,s)}setAudioProperties(t,e,n,i,s){super.setAudioProperties(t,e,n,i,s),this.resNode.setMinDistance(this.minDistance),this.resNode.setMaxDistance(this.maxDistance),this.resNode.setGain(1/this.rolloff),this.resNode.setRolloff(this.algorithm)}dispose(){this.resScene.removeSource(this.resNode),this.resNode=null,super.dispose()}}class Ni extends je{constructor(t,e,n,i){super(t,e,n),this.gain.connect(i),Object.seal(this)}update(t,e){}}class Hi extends Ue{constructor(t,e){super(t),this.gain.connect(e)}createSpatializer(t,e,n,i){if(n)throw new Error("Can't spatialize with the base listener.");return new Ni(t,e,i,this.gain)}}class zi extends Hi{constructor(t,e){super(t,e),this.scene=new Ui(t,{ambisonicOrder:1,renderingMode:dn.Bypass}),this.scene.output.connect(this.gain),this.scene.setRoomProperties({width:10,height:5,depth:10},{[mn.Left]:On.Transparent,[mn.Right]:On.Transparent,[mn.Front]:On.Transparent,[mn.Back]:On.Transparent,[mn.Down]:On.Grass,[mn.Up]:On.Transparent}),Object.seal(this)}update(t,e){const{p:n,f:i,u:s}=t;this.scene.setListenerPosition(n),this.scene.setListenerOrientation(i,s)}createSpatializer(t,e,n,i){return n?new Fi(t,e,i,this.scene):super.createSpatializer(t,e,n,i)}}const Gi=Je();class Xi extends je{constructor(t,e,n,i,s){super(t,e,n),this.listener=s,this.gain.connect(i),Object.seal(this)}update(t,e){const n=this.listener.pose.p;an(Gi,n,t.p);let i=Qe(An(Ve(Gi),this.minDistance,this.maxDistance),0,1);"logarithmic"===this.algorithm&&(i=Math.sqrt(i));const s=1-i;this.gain.gain.setValueAtTime(s,e)}}class Yi extends Hi{constructor(t,e){super(t,e),this.pose=null,this.gain.gain.value=.25,Object.seal(this)}update(t,e){this.pose=t}createSpatializer(t,e,n,i){return n?new Xi(t,e,i,this.gain,this):super.createSpatializer(t,e,n,i)}}class Wi extends ji{constructor(t,e,n,i){const s=n.createPanner();super(t,e,n,s),this.node.panningModel="HRTF",this.node.distanceModel="inverse",this.node.coneInnerAngle=360,this.node.coneOuterAngle=0,this.node.coneOuterGain=0,this.node.connect(i)}setAudioProperties(t,e,n,i,s){super.setAudioProperties(t,e,n,i,s),this.node.refDistance=this.minDistance,"logarithmic"===this.algorithm&&(i="inverse"),this.node.distanceModel=i,this.node.rolloffFactor=this.rolloff}}class Zi extends Wi{constructor(t,e,n,i){super(t,e,n,i),Object.seal(this)}update(t,e){const{p:n,f:i}=t;this.node.positionX.setValueAtTime(n[0],e),this.node.positionY.setValueAtTime(n[1],e),this.node.positionZ.setValueAtTime(n[2],e),this.node.orientationX.setValueAtTime(-i[0],e),this.node.orientationY.setValueAtTime(-i[1],e),this.node.orientationZ.setValueAtTime(-i[2],e)}}class Ji extends Hi{constructor(t,e){super(t,e),this.node=t.listener,this.volume=.75}dispose(){this.node=null,super.dispose()}}class Vi extends Ji{constructor(t,e){super(t,e),Object.seal(this)}update(t,e){const{p:n,f:i,u:s}=t;this.node.positionX.setValueAtTime(n[0],e),this.node.positionY.setValueAtTime(n[1],e),this.node.positionZ.setValueAtTime(n[2],e),this.node.forwardX.setValueAtTime(i[0],e),this.node.forwardY.setValueAtTime(i[1],e),this.node.forwardZ.setValueAtTime(i[2],e),this.node.upX.setValueAtTime(s[0],e),this.node.upY.setValueAtTime(s[1],e),this.node.upZ.setValueAtTime(s[2],e)}createSpatializer(t,e,n,i){return n?new Zi(t,e,i,this.gain):super.createSpatializer(t,e,n,i)}}class qi extends Wi{constructor(t,e,n,i){super(t,e,n,i),Object.seal(this)}update(t,e){const{p:n,f:i}=t;this.node.setPosition(n[0],n[1],n[2]),this.node.setOrientation(i[0],i[1],i[2])}}class Ki extends Ji{constructor(t,e){super(t,e),Object.seal(this)}update(t,e){const{p:n,f:i,u:s}=t;this.node.setPosition(n[0],n[1],n[2]),this.node.setOrientation(i[0],i[1],i[2],s[0],s[1],s[2])}createSpatializer(t,e,n,i){return n?new qi(t,e,i,this.gain):super.createSpatializer(t,e,n,i)}}!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext),!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);const $i=new ke,ts=new ce("audioReady"),es=Ce(),ns="createMediaStreamTrackSource"in AudioContext.prototype,is=!ns&&!("createMediaStreamSource"in AudioContext.prototype),ss=new Map([["wav",["audio/wav","audio/vnd.wave","audio/wave","audio/x-wav"]],["mp3",["audio/mpeg"]],["m4a",["audio/mp4"]],["m4b",["audio/mp4"]],["3gp",["audio/mp4"]],["3g2",["audio/mp4"]],["aac",["audio/aac","audio/aacp"]],["oga",["audio/ogg"]],["ogg",["audio/ogg"]],["spx",["audio/ogg"]],["webm",["audio/webm"]],["flac",["audio/flac"]]]);let rs="AudioContext"in globalThis,os="AudioListener"in globalThis,as=os&&"setPosition"in AudioListener.prototype,As=os&&"positionX"in AudioListener.prototype,cs=os;var hs;!function(t){t.Low="volumescale",t.Medium="webaudiopanner",t.High="resonance"}(hs||(hs={}));class us extends he{constructor(t,e){super(),this.minDistance=1,this.maxDistance=10,this.rolloff=1,this._algorithm="logarithmic",this.transitionTime=.5,this._offsetRadius=0,this.clips=new Map,this.users=new Map,this.analysers=new Map,this.sortedUserIDs=new Array,this.localUserID=null,this.listener=null,this.audioContext=null,this.element=null,this.destination=null,this._audioOutputDeviceID=null,this.fetcher=t||new Ie,this.type=e||hs.Medium,this.onAudioActivity=t=>{$i.id=t.id,$i.isActive=t.isActive,this.dispatchEvent($i)},this.createContext(),Object.seal(this)}get offsetRadius(){return this._offsetRadius}set offsetRadius(t){this._offsetRadius=t,this.updateUserOffsets()}get algorithm(){return this._algorithm}addEventListener(t,e,n=null){t===ts.type&&this.ready?e(ts):super.addEventListener(t,e,n)}get ready(){return this.audioContext&&"running"===this.audioContext.state}async start(){await this.audioContext.resume(),await this.setAudioOutputDeviceID(this._audioOutputDeviceID),this.element&&await this.element.play()}update(){if(this.audioContext){const t=this.currentTime;for(const e of this.clips.values())e.update(t);for(const e of this.users.values())e.update(t);for(const t of this.analysers.values())t.update()}}createContext(){if(!this.audioContext){if(this.audioContext=new AudioContext,u?(this.destination=this.audioContext.createMediaStreamDestination(),this.element=Ce(ve,ge,we(this.destination.stream),De(ye("none"))),document.body.appendChild(this.element)):this.destination=this.audioContext.destination,this.type===hs.High)if(rs&&os&&cs)try{this.listener=new zi(this.audioContext,this.destination)}catch(t){cs=!1,this.type=hs.Medium,console.warn("Resonance Audio API not available!",t)}else this.type=hs.Medium;if(this.type===hs.Medium)if(rs&&os){if(As)try{this.listener=new Vi(this.audioContext,this.destination)}catch(t){As=!1,console.warn("No AudioListener.positionX property!",t)}if(!As&&as)try{this.listener=new Ki(this.audioContext,this.destination)}catch(t){as=!1,console.warn("No WebAudio API!",t)}As||as||(this.type=hs.Low,os=!1)}else this.type=hs.Low;if(this.type===hs.Low&&(this.listener=new Yi(this.audioContext,this.destination)),null===this.listener)throw new Error("Calla requires a functioning WebAudio system.");this.ready?(this.start(),this.dispatchEvent(ts)):function(t,e){const n=h(e)?xe:e,i=async e=>{if(e.isTrusted&&await n()){for(const t of Me)window.removeEventListener(t,i);t()}};for(const t of Me)window.addEventListener(t,i)}((()=>this.dispatchEvent(ts)),(async()=>(await this.start(),this.ready)))}}getAudioOutputDeviceID(){return this.element?.sinkId}async setAudioOutputDeviceID(t){this._audioOutputDeviceID=t||"",this.element&&this._audioOutputDeviceID!==this.element.sinkId&&await this.element.setSinkId(this._audioOutputDeviceID)}createSpatializer(t,e,n){if(!this.listener)throw new Error("Audio context isn't ready");return this.listener.createSpatializer(t,e,n,this.audioContext)}get currentTime(){return this.audioContext.currentTime}createUser(t){let e=this.users.get(t);return e||(e=new ln(t),this.users.set(t,e),_e(this.sortedUserIDs,t),this.updateUserOffsets()),e}createLocalUser(t){this.localUserID=t;let e=null,n=null;for(const t of this.users.entries())if(t[1].spatializer===this.listener){[e,n]=t;break}return n?(this.users.delete(e),Be(this.sortedUserIDs,e),this.users.set(t,n),_e(this.sortedUserIDs,t),this.updateUserOffsets()):(n=this.createUser(t),n.spatializer=this.listener),n}async createClip(t,e,n,i,s,r,o){if(null==r||0===r.length)throw new Error("No clip source path provided");let a=null;if(function(t){const e=t.lastIndexOf(".");if(e>-1){const n=t.substring(e+1);if(ss.has(n)){for(const t of ss.get(n))if(es.canPlayType(t))return!0;return!1}}return!0}(r)){const t=await this.fetcher.getBlob(r,o);es.canPlayType(t.type)&&(a=t)}else o&&o(1,1,"skip");if(!a)throw new Error("Cannot play file: "+r);const A=await a.arrayBuffer(),c=await this.audioContext.decodeAudioData(A),h=this.audioContext.createBufferSource();h.buffer=c,h.loop=e;const u=new ln("audio-clip-"+t);return u.spatializer=this.createSpatializer(t,h,i),u.spatializer.volume=s,n&&u.spatializer.play(),this.clips.set(t,u),u}hasClip(t){return this.clips.has(t)}async playClip(t){if(this.ready&&this.hasClip(t)){const e=this.clips.get(t);await e.spatializer.play()}}stopClip(t){if(this.ready&&this.hasClip(t)){this.clips.get(t).spatializer.stop()}}getSource(t,e){return t.get(e)||null}getUser(t){return this.getSource(this.users,t)}getClip(t){return this.getSource(this.clips,t)}removeSource(t,e){t.has(e)&&Oe(t.get(e),(n=>{n.spatializer&&n.spatializer.stop(),t.delete(e)}))}removeUser(t){this.removeSource(this.users,t),Be(this.sortedUserIDs,t),this.updateUserOffsets()}removeClip(t){this.removeSource(this.clips,t)}createSourceFromStream(t){if(ns){const e=t.getAudioTracks().map((t=>this.audioContext.createMediaStreamTrackSource(t)));if(0===e.length)throw new Error("No audio tracks!");if(1===e.length)return e[0];{const t=this.audioContext.createChannelMerger(e.length);for(const n of e)n.connect(t);return t}}{const e=Ce(ve(!0),ge(!0),new pe("muted",!is,"audio","video"),function(t){return new pe("controls",t,"audio","video")}(!1),De(ye("none")),we(t));return document.body.appendChild(e),e.play(),is?this.audioContext.createMediaElementSource(e):this.audioContext.createMediaStreamSource(t)}}async setUserStream(t,e){if(this.users.has(t)){this.analysers.has(t)&&Oe(this.analysers.get(t),(e=>{this.analysers.delete(t),e.removeEventListener("audioActivity",this.onAudioActivity)}));const n=this.users.get(t);if(n.spatializer=null,e){await xt((()=>e.active));const i=this.createSourceFromStream(e);n.spatializer=this.createSpatializer(t,i,!0),n.spatializer.setAudioProperties(this.minDistance,this.maxDistance,this.rolloff,this.algorithm,this.transitionTime);const s=new He(n,this.audioContext,1024);s.addEventListener("audioActivity",this.onAudioActivity),this.analysers.set(t,s)}}}updateUserOffsets(){if(this.offsetRadius>0){const t=this.sortedUserIDs.indexOf(this.localUserID),e=2*Math.PI/this.sortedUserIDs.length,n=(t+1)*e,i=this.offsetRadius*Math.sin(n),s=this.offsetRadius*(Math.cos(n)-1);for(let t=0;t<this.sortedUserIDs.length;++t){const n=this.sortedUserIDs[t],r=(t+1)*e,o=this.offsetRadius*Math.sin(r)-i,a=this.offsetRadius*(Math.cos(r)-1)-s;this.setUserOffset(n,o,0,a)}}}setAudioProperties(t,e,n,i,s){this.minDistance=t,this.maxDistance=e,this.transitionTime=s,this.rolloff=n,this._algorithm=i;for(const t of this.users.values())t.spatializer&&t.spatializer.setAudioProperties(this.minDistance,this.maxDistance,this.rolloff,this.algorithm,this.transitionTime)}withPose(t,e,n,i){if(t.has(e)){const s=t.get(e).pose;return null==n&&(n=this.transitionTime),i(s,n)}return null}withUser(t,e,n){return this.withPose(this.users,t,e,n)}setUserOffset(t,e,n,i){this.withUser(t,null,(t=>{t.setOffset(e,n,i)}))}getUserOffset(t){return this.withUser(t,null,(t=>t.offset))}setUserPose(t,e,n,i,s,r,o,a,A,c,h=null){this.withUser(t,h,((t,h)=>{t.setTarget(e,n,i,s,r,o,a,A,c,this.currentTime,h)}))}withClip(t,e,n){return this.withPose(this.clips,t,e,n)}setClipPosition(t,e,n,i,s=null){this.withClip(t,s,((t,s)=>{t.setTargetPosition(e,n,i,this.currentTime,s)}))}setClipOrientation(t,e,n,i,s,r,o,a=null){this.withClip(t,a,((t,a)=>{t.setTargetOrientation(e,n,i,s,r,o,this.currentTime,a)}))}setClipPose(t,e,n,i,s,r,o,a,A,c,h=null){this.withClip(t,h,((t,h)=>{t.setTarget(e,n,i,s,r,o,a,A,c,this.currentTime,h)}))}}function ls(t,e){t.addEventListener(e,((...t)=>{vs&&console.log(">== CALLA ==<",e,...t)}))}const ds="calla:preferredAudioOutputID",fs="calla:preferredAudioInputID",ps="calla:preferredVideoInputID",gs="local-user";let vs="localhost"===window.location.hostname||/\bdebug\b/.test(window.location.search);class ws extends he{constructor(t,e){super(),this.localUserID=null,this.localUserName=null,this.roomName=null,this._prepared=!1,this._connectionState=_t.Disconnected,this._conferenceState=_t.Disconnected,this.hasAudioPermission=!1,this.hasVideoPermission=!1,this.fetcher=t||new Ie,this.audio=e||new us(t,fe?hs.High:hs.Medium),this.addEventListener("serverConnected",this.setConnectionState.bind(this,_t.Connected)),this.addEventListener("serverFailed",this.setConnectionState.bind(this,_t.Disconnected)),this.addEventListener("serverDisconnected",this.setConnectionState.bind(this,_t.Disconnected)),this.addEventListener("conferenceJoined",this.setConferenceState.bind(this,_t.Connected)),this.addEventListener("conferenceFailed",this.setConferenceState.bind(this,_t.Disconnected)),this.addEventListener("conferenceRestored",this.setConferenceState.bind(this,_t.Connected)),this.addEventListener("conferenceLeft",this.setConferenceState.bind(this,_t.Disconnected))}toggleLogging(){vs=!vs}get connectionState(){return this._connectionState}setConnectionState(t){this._connectionState=t}get conferenceState(){return this._conferenceState}setConferenceState(t){this._conferenceState=t}dispatchEvent(t){return t instanceof Lt&&(null==t.id||"local"===t.id)&&(this.localUserID===gs?t.id=null:t.id=this.localUserID),super.dispatchEvent(t)}async getNext(t,e){return new Promise((n=>{const i=s=>{s instanceof Lt&&s.id===e&&(this.removeEventListener(t,i),n(s))};this.addEventListener(t,i)}))}get preferredAudioInputID(){return localStorage.getItem(fs)}set preferredAudioInputID(t){localStorage.setItem(fs,t)}get preferredVideoInputID(){return localStorage.getItem(ps)}set preferredVideoInputID(t){localStorage.setItem(ps,t)}async setPreferredDevices(){await this.setPreferredAudioInput(!0),await this.setPreferredVideoInput(!1),await this.setPreferredAudioOutput(!0)}async getPreferredAudioInput(t){return le(await this.getAudioInputDevices(),(t=>t.deviceId===this.preferredAudioInputID),(t=>"communications"===t.deviceId),(t=>"default"===t.deviceId),(e=>t&&e.deviceId.length>0))}async setPreferredAudioInput(t){const e=await this.getPreferredAudioInput(t);e&&await this.setAudioInputDevice(e)}async getPreferredVideoInput(t){return le(await this.getVideoInputDevices(),(t=>t.deviceId===this.preferredVideoInputID),(e=>t&&e&&/front/i.test(e.label)),(e=>t&&e.deviceId.length>0))}async setPreferredVideoInput(t){const e=await this.getPreferredVideoInput(t);e&&await this.setVideoInputDevice(e)}async getDevices(){let t=null;for(let e=0;e<3;++e){t=await navigator.mediaDevices.enumerateDevices();for(const e of t)e.deviceId.length>0&&(this.hasAudioPermission=this.hasAudioPermission||"audioinput"===e.kind&&e.label.length>0,this.hasVideoPermission=this.hasVideoPermission||"videoinput"===e.kind&&e.label.length>0);if(this.hasAudioPermission)break;try{await navigator.mediaDevices.getUserMedia({audio:!this.hasAudioPermission,video:!this.hasVideoPermission})}catch(t){console.warn(t)}}return t||[]}async getMediaPermissions(){return await this.getDevices(),{audio:this.hasAudioPermission,video:this.hasVideoPermission}}async getAvailableDevices(t=!1){let e=await this.getDevices();return t&&(e=function(t){const e=[];for(let n=0;n<t.length;++n){const i=t[n];let s=!1;for(let t=0;t<e.length&&!s;++t){const n=e[t];s=i.kind===n.kind&&n.label.indexOf(i.label)>0}s||e.push(i)}return e}(e)),{audioOutput:u?e.filter((t=>"audiooutput"===t.kind)):[],audioInput:e.filter((t=>"audioinput"===t.kind)),videoInput:e.filter((t=>"videoinput"===t.kind))}}async getAudioInputDevices(t=!1){const e=await this.getAvailableDevices(t);return e&&e.audioInput||[]}async getVideoInputDevices(t=!1){const e=await this.getAvailableDevices(t);return e&&e.videoInput||[]}async setAudioOutputDevice(t){u&&(this.preferredAudioOutputID=t&&t.deviceId||null)}async getAudioOutputDevices(t=!1){if(!u)return[];const e=await this.getAvailableDevices(t);return e&&e.audioOutput||[]}async getCurrentAudioOutputDevice(){if(!u)return null;const t=this.audio.getAudioOutputDeviceID(),e=(await this.getAudioOutputDevices()).filter((e=>null!=t&&e.deviceId===t||null==t&&e.deviceId===this.preferredAudioOutputID));return 0===e.length?null:e[0]}get preferredAudioOutputID(){return localStorage.getItem(ds)}set preferredAudioOutputID(t){localStorage.setItem(ds,t)}async getPreferredAudioOutput(t){return le(await this.getAudioOutputDevices(),(t=>t.deviceId===this.preferredAudioOutputID),(t=>"communications"===t.deviceId),(t=>"default"===t.deviceId),(e=>t&&e.deviceId.length>0))}async setPreferredAudioOutput(t){const e=await this.getPreferredAudioOutput(t);e&&await this.setAudioOutputDevice(e)}async setAudioInputDevice(t){this.preferredAudioInputID=t&&t.deviceId||null}async setVideoInputDevice(t){this.preferredVideoInputID=t&&t.deviceId||null}async connect(){this.setConnectionState(_t.Connecting)}async join(t,e){this.setConferenceState(_t.Connecting)}async leave(){this.setConferenceState(_t.Disconnecting)}async disconnect(){this.setConnectionState(_t.Disconnecting)}}const ms="Calla";class Ds extends ue{constructor(t){super(250),this.tele=t,this._status=_t.Disconnected,this.remoteUserIDs=new Array,this.tele.addEventListener("participantJoined",(t=>{_e(this.remoteUserIDs,t.id,!1)})),this.tele.addEventListener("participantLeft",(t=>{Be(this.remoteUserIDs,t.id)}))}get metadataState(){return this._status}async connect(){}async join(t){this._status=_t.Connecting,this.tele.conference.addEventListener(JitsiMeetJS.events.conference.ENDPOINT_MESSAGE_RECEIVED,((t,e)=>{if(e.hax===ms){const n=t.getId(),i=e.command,s=e.values;switch(i){case"avatarChanged":this.dispatchEvent(new oe(n,s[0]));break;case"emote":this.dispatchEvent(new se(n,s[0]));break;case"setAvatarEmoji":this.dispatchEvent(new re(n,s[0]));break;case"userPosed":this.dispatchEvent(new ee(n,s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8]));break;case"userPointer":this.dispatchEvent(new ne(n,s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9]));break;case"chat":this.dispatchEvent(new ae(n,s[0]));break;default:A(i)}}})),await Re(this.tele.conference,JitsiMeetJS.events.conference.DATA_CHANNEL_OPENED),this._status=_t.Connected}async leave(){this._status=_t.Disconnected}async identify(t){}async disconnect(){}sendJitsiHax(t,e,...n){this.tele.conference.sendMessage({hax:ms,command:e,values:n},t)}callInternal(t,...e){for(const n of this.remoteUserIDs)this.sendJitsiHax(n,t,...e);return Promise.resolve()}async stopInternal(){this._status=_t.Disconnecting,await xt((()=>this.metadataState===_t.Disconnected))}}function ys(t){try{return decodeURIComponent(t)}catch(e){return t}}class bs extends ws{constructor(t,e){super(t,e),this.usingDefaultMetadataClient=!1,this.host=null,this.bridgeHost=null,this.bridgeMUC=null,this.connection=null,this.conference=null,this.tracks=new Map,this.listenersForObjs=new Map}_on(t,e,n){let i=this.listenersForObjs.get(t);i||this.listenersForObjs.set(t,i=new Map);let s=i.get(e);s||i.set(e,s=new Array),s.push(n),t.addEventListener(e,n)}_off(t){const e=this.listenersForObjs.get(t);if(e){this.listenersForObjs.delete(t);for(const[n,i]of e.entries()){for(const e of i)t.removeEventListener(n,e);Te(i)}e.clear()}}getDefaultMetadataClient(){return this.usingDefaultMetadataClient=!0,new Ds(this)}async prepare(t,e,n,i){if(!this._prepared){this.host=t,this.bridgeHost=e,this.bridgeMUC=n,console.info("Connecting to:",this.host);const s=function(t,e){let n;if(r(e)){n=new Array(e);for(let t=0;t<n.length;++t)n[t]=1/e}else n=e;let i=0;for(let t=0;t<n.length;++t)i+=n[t];const s=new Array(n.length),o=new Array(n.length),a=performance.now(),A=(e,r,o,A)=>{if(t){s[e]=r/o;let c=0;for(let t=0;t<n.length;++t)c+=s[t]*n[t];const h=performance.now();t(c,i,A,a-h+(h-a)*i/c)}};for(let t=0;t<n.length;++t)s[t]=0,o[t]=(e,n,i)=>A(t,e,n,i);return o}(i,2);await this.fetcher.loadScript("https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js",(()=>"jQuery"in globalThis),s.shift()),await this.fetcher.loadScript(`https://${this.host}/libs/lib-jitsi-meet.min.js`,(()=>"JitsiMeetJS"in globalThis),s.shift()),JitsiMeetJS.setLogLevel(JitsiMeetJS.logLevels.ERROR),JitsiMeetJS.init(),this._prepared=!0}}async connect(){await super.connect();const t=JitsiMeetJS.events.connection;this.connection=new JitsiMeetJS.JitsiConnection(null,null,{hosts:{domain:this.bridgeHost,muc:this.bridgeMUC},serviceUrl:`https://${this.host}/http-bind`});for(const e of Object.values(t))ls(this.connection,e);const e=()=>{this.connection&&(this._off(this.connection),this.connection=null)},n=(t,e,n)=>{this._on(this.connection,t,(()=>{this.dispatchEvent(new e),n&&n()}))};n(t.CONNECTION_ESTABLISHED,Qt),n(t.CONNECTION_DISCONNECTED,kt,e),n(t.CONNECTION_FAILED,Tt,e);const i=Re(this.connection,t.CONNECTION_ESTABLISHED);this.connection.connect(),await i}async join(t,e){await super.join(t,e);const n=t.toLocaleLowerCase();if(n!==this.roomName){this.conference&&await this.leave(),this.roomName=n,this.conference=this.connection.initJitsiConference(this.roomName,{openBridgeChannel:this.usingDefaultMetadataClient,p2p:{enabled:!1},startVideoMuted:!0});const i=JitsiMeetJS.events.conference;for(const t of Object.values(i))"conference.audioLevelsChanged"!==t&&ls(this.conference,t);const s=(t,e,n)=>{this._on(this.conference,t,(()=>{this.dispatchEvent(new e),n&&n(t)}))},r=async e=>{if(this.localUserID=gs,this.tracks.size>0){console.warn("><> CALLA <>< ---- there are leftover conference tracks");for(const t of this.tracks.keys())await this.tryRemoveTrack(t,It.Video),await this.tryRemoveTrack(t,It.Audio),this.dispatchEvent(new Ht(t))}this.dispatchEvent(new jt(this.localUserID)),this.conference&&(this._off(this.conference),this.conference=null),console.info(`Left room '${t}'. Reason: ${e}.`)};s(i.CONFERENCE_ERROR,Ft,r),s(i.CONFERENCE_FAILED,Ft,r),s(i.CONNECTION_INTERRUPTED,Ft,r),this._on(this.conference,i.CONFERENCE_JOINED,(async()=>{const t=this.conference.myUserId();t&&(this.localUserID=t,this.dispatchEvent(new Ut(t,null)))})),this._on(this.conference,i.CONFERENCE_LEFT,(()=>r(i.CONFERENCE_LEFT))),this._on(this.conference,i.USER_JOINED,((t,e)=>{this.dispatchEvent(new Nt(t,ys(e.getDisplayName()),null))})),this._on(this.conference,i.USER_LEFT,(t=>{this.dispatchEvent(new Ht(t))})),this._on(this.conference,i.DISPLAY_NAME_CHANGED,((t,e)=>{this.dispatchEvent(new zt(t,ys(e)))}));const o=(t,e)=>{const n=t.getParticipantId()||this.localUserID,i=t.getType()===It.Audio?new Xt(n,e):new Yt(n,e);this.dispatchEvent(i)};this._on(this.conference,i.TRACK_ADDED,(t=>{const e=t.getParticipantId()||this.localUserID,n=t.getType(),i=n===It.Audio?new Vt(e,t.stream):new Kt(e,t.stream);let s=this.tracks.get(e);s||(s=new Map,this.tracks.set(e,s));const r=s.get(n);if(r){const t=It.Audio?new qt(e,r.stream):new $t(e,r.stream);this.dispatchEvent(t),r.dispose()}s.set(n,t),this.dispatchEvent(i),t.addEventListener(JitsiMeetJS.events.track.TRACK_MUTE_CHANGED,(t=>{o(t,t.isMuted())})),o(t,!1)})),this._on(this.conference,i.TRACK_REMOVED,(t=>{Oe(t,(e=>{const n=t.getParticipantId()||this.localUserID,i=t.getType(),s=It.Audio?new qt(n,t.stream):new $t(n,t.stream);o(t,!0),this.dispatchEvent(s);const r=this.tracks.get(n);if(r){const e=r.get(i);e&&(r.delete(i),0===r.size&&this.tracks.delete(n),e!==t&&e.dispose())}}))}));const a=Re(this,"conferenceJoined");this.conference.join(e),await a}}async identify(t){this.localUserName=t,this.conference.setDisplayName(function(t){try{return encodeURIComponent(t)}catch(e){return t}}(t))}async tryRemoveTrack(t,e){const n=this.tracks.get(t),i=e===It.Video?$t:qt;if(n){const s=n.get(e);if(s){this.dispatchEvent(new i(t,s.stream)),n.delete(e);try{this.conference&&s.isLocal&&this.conference.removeTrack(s)}catch(t){console.warn(t)}finally{s.dispose()}}0===n.size&&this.tracks.delete(t)}}async leave(){await super.leave();try{await this.tryRemoveTrack(this.localUserID,It.Video),await this.tryRemoveTrack(this.localUserID,It.Audio);const t=Re(this,"conferenceLeft");this.conference.leave(),await t}catch(t){console.warn("><> CALLA <>< ---- Failed to leave teleconference.",t)}}async disconnect(){await super.disconnect(),this.conferenceState===_t.Connected&&await this.leave();const t=Re(this,"serverDisconnected");this.connection.disconnect(),await t}userExists(t){return this.conference&&this.conference.participants&&t in this.conference.participants}getUserNames(){return this.conference?Object.keys(this.conference.participants).map((t=>[t,ys(this.conference.participants[t].getDisplayName())])):[]}getCurrentMediaTrack(t){if(this.localUserID===gs)return null;const e=this.tracks.get(this.localUserID);return e?e.get(t):null}async setAudioInputDevice(t){await super.setAudioInputDevice(t);const e=this.getCurrentMediaTrack(It.Audio);if(e){const t=this.getNext("audioRemoved",this.localUserID);this.conference.removeTrack(e),await t}if(this.conference&&this.preferredAudioInputID){const t=this.getNext("audioAdded",this.localUserID),e=await JitsiMeetJS.createLocalTracks({devices:["audio"],micDeviceId:this.preferredAudioInputID,constraints:{autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0}});for(const t of e)this.conference.addTrack(t);await t}}async setVideoInputDevice(t){await super.setVideoInputDevice(t);const e=this.getCurrentMediaTrack(It.Video);if(e){const t=this.getNext("videoRemoved",this.localUserID);this.conference.removeTrack(e),await t}if(this.conference&&this.preferredVideoInputID){const t=this.getNext("videoAdded",this.localUserID),e=await JitsiMeetJS.createLocalTracks({devices:["video"],cameraDeviceId:this.preferredVideoInputID});for(const t of e)this.conference.addTrack(t);await t}}async getCurrentAudioInputDevice(){const t=this.getCurrentMediaTrack(It.Audio),e=(await this.getAudioInputDevices()).filter((e=>null!=t&&e.deviceId===t.getDeviceId()||null==t&&e.deviceId===this.preferredAudioInputID));return 0===e.length?null:e[0]}async getCurrentVideoInputDevice(){const t=this.getCurrentMediaTrack(It.Video),e=(await this.getVideoInputDevices()).filter((e=>null!=t&&e.deviceId===t.getDeviceId()||null==t&&e.deviceId===this.preferredVideoInputID));return 0===e.length?null:e[0]}async toggleAudioMuted(){const t=this.getNext("audioMuteStatusChanged",this.localUserID),e=this.getCurrentMediaTrack(It.Audio);if(e){e.isMuted()?await e.unmute():await e.mute()}else await this.setPreferredAudioInput(!0);return(await t).muted}async toggleVideoMuted(){const t=this.getNext("videoMuteStatusChanged",this.localUserID);this.getCurrentMediaTrack(It.Video)?await this.setVideoInputDevice(null):await this.setPreferredVideoInput(!0);return(await t).muted}isMediaMuted(t){const e=this.getCurrentMediaTrack(t);return null==e||e.isMuted()}async getAudioMuted(){return this.isMediaMuted(It.Audio)}async getVideoMuted(){return this.isMediaMuted(It.Video)}}var Ps;!function(t){t.InConference="in-conference",t.JoiningConference="joining-conference",t.Connected="connected",t.Connecting="connecting",t.Prepaired="prepaired",t.Prepairing="prepairing",t.Unprepared="unprepaired"}(Ps||(Ps={}));const Cs=new ke;var Es="1.0.0";return console.info("Calla v1.0.0."),t.BaseMetadataClient=ue,t.BaseTeleconferenceClient=ws,t.Client=class extends he{constructor(t,e,n,i){super(),this.isAudioMuted=null,this.isVideoMuted=null,h(n)&&(n=bs),this.tele=new n(t,e),h(i)?this.meta=this.tele.getDefaultMetadataClient():this.meta=new i(this.tele);const s=this.dispatchEvent.bind(this);this.tele.addEventListener("serverConnected",s),this.tele.addEventListener("serverDisconnected",s),this.tele.addEventListener("serverFailed",s),this.tele.addEventListener("conferenceFailed",s),this.tele.addEventListener("conferenceRestored",s),this.tele.addEventListener("audioMuteStatusChanged",s),this.tele.addEventListener("videoMuteStatusChanged",s),this.tele.addEventListener("conferenceJoined",(async t=>{const e=this.audio.createLocalUser(t.id);t.pose=e.pose,this.dispatchEvent(t),await this.setPreferredDevices()})),this.tele.addEventListener("conferenceLeft",(t=>{this.audio.createLocalUser(t.id),this.dispatchEvent(t)})),this.tele.addEventListener("participantJoined",(async t=>{t.source=this.audio.createUser(t.id),this.dispatchEvent(t)})),this.tele.addEventListener("participantLeft",(t=>{this.dispatchEvent(t),this.audio.removeUser(t.id)})),this.tele.addEventListener("userNameChanged",s),this.tele.addEventListener("videoAdded",s),this.tele.addEventListener("videoRemoved",s),this.tele.addEventListener("audioAdded",(t=>{const e=this.audio.getUser(t.id);if(e){let n=e.streams.get(t.kind);n&&e.streams.delete(t.kind),n=t.stream,e.streams.set(t.kind,n),t.id!==this.tele.localUserID&&this.audio.setUserStream(t.id,n),this.dispatchEvent(t)}})),this.tele.addEventListener("audioRemoved",(t=>{const e=this.audio.getUser(t.id);e&&e.streams.has(t.kind)&&e.streams.delete(t.kind),t.id!==this.tele.localUserID&&this.audio.setUserStream(t.id,null),this.dispatchEvent(t)})),this.meta.addEventListener("avatarChanged",s),this.meta.addEventListener("chat",s),this.meta.addEventListener("emote",s),this.meta.addEventListener("setAvatarEmoji",s);const r=t=>{const e=this.audio.getUserOffset(t.id);e&&(t.px+=e[0],t.py+=e[1],t.pz+=e[2]),this.dispatchEvent(t)};this.meta.addEventListener("userPointer",r),this.meta.addEventListener("userPosed",(t=>{this.audio.setUserPose(t.id,t.px,t.py,t.pz,t.fx,t.fy,t.fz,t.ux,t.uy,t.uz),r(t)})),this.audio.addEventListener("audioActivity",(t=>{Cs.id=t.id,Cs.isActive=t.isActive,this.dispatchEvent(Cs)}));const o=this.dispose.bind(this);window.addEventListener("beforeunload",o),window.addEventListener("unload",o),window.addEventListener("pagehide",o),Object.seal(this)}get connectionState(){return this.tele.connectionState}get conferenceState(){return this.tele.conferenceState}get audio(){return this.tele.audio}get preferredAudioOutputID(){return this.tele.preferredAudioOutputID}set preferredAudioOutputID(t){this.tele.preferredAudioOutputID=t}get preferredAudioInputID(){return this.tele.preferredAudioInputID}set preferredAudioInputID(t){this.tele.preferredAudioInputID=t}get preferredVideoInputID(){return this.tele.preferredVideoInputID}set preferredVideoInputID(t){this.tele.preferredVideoInputID=t}async getCurrentAudioOutputDevice(){return await this.tele.getCurrentAudioOutputDevice()}async getMediaPermissions(){return await this.tele.getMediaPermissions()}async getAudioOutputDevices(t){return await this.tele.getAudioOutputDevices(t)}async getAudioInputDevices(t){return await this.tele.getAudioInputDevices(t)}async getVideoInputDevices(t){return await this.tele.getVideoInputDevices(t)}dispose(){this.leave(),this.disconnect()}get offsetRadius(){return this.audio.offsetRadius}set offsetRadius(t){this.audio.offsetRadius=t}setLocalPose(t,e,n,i,s,r,o,a,A){this.audio.setUserPose(this.localUserID,t,e,n,i,s,r,o,a,A,0),this.meta.setLocalPose(t,e,n,i,s,r,o,a,A)}setLocalPoseImmediate(t,e,n,i,s,r,o,a,A){this.audio.setUserPose(this.localUserID,t,e,n,i,s,r,o,a,A,0),this.meta.setLocalPoseImmediate(t,e,n,i,s,r,o,a,A)}setLocalPointer(t,e,n,i,s,r,o,a,A,c){this.meta.setLocalPointer(t,e,n,i,s,r,o,a,A,c)}setAvatarEmoji(t){this.meta.setAvatarEmoji(t)}setAvatarURL(t){this.meta.setAvatarURL(t)}emote(t){this.meta.emote(t)}chat(t){this.meta.chat(t)}async setPreferredDevices(){await this.tele.setPreferredDevices()}async setAudioInputDevice(t){await this.tele.setAudioInputDevice(t)}async setVideoInputDevice(t){await this.tele.setVideoInputDevice(t)}async getCurrentAudioInputDevice(){return await this.tele.getCurrentAudioInputDevice()}async getCurrentVideoInputDevice(){return await this.tele.getCurrentVideoInputDevice()}async toggleAudioMuted(){return await this.tele.toggleAudioMuted()}async toggleVideoMuted(){return await this.tele.toggleVideoMuted()}async getAudioMuted(){return await this.tele.getAudioMuted()}async getVideoMuted(){return await this.tele.getVideoMuted()}get metadataState(){return this.meta.metadataState}get localUserID(){return this.tele.localUserID}get localUserName(){return this.tele.localUserName}get roomName(){return this.tele.roomName}userExists(t){return this.tele.userExists(t)}getUserNames(){return this.tele.getUserNames()}async prepare(t,e,n,i){await this.tele.prepare(t,e,n,i)}async connect(){await this.tele.connect(),this.tele.connectionState===_t.Connected&&await this.meta.connect()}async join(t){await this.tele.join(t),this.tele.conferenceState===_t.Connected&&await this.meta.join(t)}async identify(t){await this.tele.identify(t),await this.meta.identify(this.localUserID)}async leave(){await this.meta.leave(),await this.tele.leave()}async disconnect(){await this.meta.disconnect(),await this.tele.disconnect()}update(){this.audio.update()}async setAudioOutputDevice(t){this.tele.setAudioOutputDevice(t),u&&await this.audio.setAudioOutputDeviceID(this.tele.preferredAudioOutputID)}async setAudioMuted(t){let e=this.isAudioMuted;return t!==e&&(e=await this.toggleAudioMuted()),e}async setVideoMuted(t){let e=this.isVideoMuted;return t!==e&&(e=await this.toggleVideoMuted()),e}},t.DEFAULT_LOCAL_USER_ID=gs,t.SignalRMetadataClient=class extends ue{constructor(){super(50),this.lastRoom=null,this.lastUserID=null,this.currentRoom=null,this.currentUserID=null,this.hub=(new Mt).withUrl("/calla",$.WebSockets).build(),this.hub.onclose((()=>{this.lastRoom=null,this.lastUserID=null})),this.hub.on("userPosed",((t,e,n,i,s,r,o,a,A,c)=>{this.dispatchEvent(new ee(t,e,n,i,s,r,o,a,A,c))})),this.hub.on("userPointer",((t,e,n,i,s,r,o,a,A,c,h)=>{this.dispatchEvent(new ne(t,e,n,i,s,r,o,a,A,c,h))})),this.hub.on("avatarChanged",((t,e)=>{this.dispatchEvent(new oe(t,e))})),this.hub.on("emote",((t,e)=>{this.dispatchEvent(new se(t,e))})),this.hub.on("setAvatarEmoji",((t,e)=>{this.dispatchEvent(new re(t,e))})),this.hub.on("chat",((t,e)=>{this.dispatchEvent(new ae(t,e))}))}get metadataState(){switch(this.hub.state){case J.Connected:return _t.Connected;case J.Connecting:case J.Reconnecting:return _t.Connecting;case J.Disconnected:return _t.Disconnected;case J.Disconnecting:return _t.Disconnecting;default:A(this.hub.state)}}async maybeStart(){this.metadataState===_t.Connecting?await xt((()=>this.metadataState===_t.Connected)):(this.metadataState===_t.Disconnecting&&await xt((()=>this.metadataState===_t.Disconnected)),this.metadataState===_t.Disconnected&&await this.hub.start())}async maybeJoin(){await this.maybeStart(),this.currentRoom!==this.lastRoom&&(await this.maybeLeave(),this.currentRoom&&this.isConnected&&(this.lastRoom=this.currentRoom,await this.hub.invoke("join",this.currentRoom)))}async maybeIdentify(){await this.maybeJoin(),this.currentUserID&&this.currentUserID!==this.lastUserID&&this.isConnected&&(this.lastUserID=this.currentUserID,await this.hub.invoke("identify",this.currentUserID))}async maybeLeave(){this.isConnected&&await this.hub.invoke("leave")}async maybeDisconnect(){this.metadataState===_t.Disconnecting?await xt((()=>this.metadataState===_t.Disconnected)):(this.metadataState===_t.Connecting&&await xt((()=>this.metadataState===_t.Connected)),this.metadataState===_t.Connected&&await this.hub.stop())}async connect(){await this.maybeStart()}async join(t){this.currentRoom=t,await this.maybeJoin()}async identify(t){this.currentUserID=t,await this.maybeJoin(),await this.maybeIdentify()}async leave(){await this.maybeLeave(),this.currentUserID=this.lastUserID=this.currentRoom=this.lastRoom=null}async disconnect(){await this.maybeDisconnect(),this.currentUserID=this.lastUserID=this.currentRoom=this.lastRoom=null}async callInternal(t,e,...n){await this.maybeIdentify(),this.isConnected&&await this.hub.invoke(t,e,...n)}},t.addLogger=ls,t.canChangeAudioOutput=u,t.version=Es,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=calla.min.js.map
